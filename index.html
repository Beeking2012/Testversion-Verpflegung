<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feldk√ºche ‚Äì DRK Intelligente Rezeptempfehlung</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
    /* =============================================
       DRK DESIGN SYSTEM
       ============================================= */
    
    :root {
        /* DRK Farbpalette */
        --drk-red: #b30000;
        --drk-red-dark: #990000;
        --drk-red-light: #cc0000;
        --drk-white: #ffffff;
        --drk-gray-light: #f5f5f5;
        --drk-gray: #666666;
        --drk-success: #4CAF50;
        --drk-warning: #ff9800;
        --drk-info: #2196F3;
        
        /* Abst√§nde */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        
        /* Border Radius */
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
    }
    
    /* =============================================
       BASIS-STYLES & RESET
       ============================================= */
    
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        background-color: var(--drk-gray-light);
        color: #333;
        line-height: 1.6;
    }
    
    /* =============================================
       LAYOUT KOMPONENTEN
       ============================================= */
    
    /* Header */
    .drk-header {
        background-color: var(--drk-white);
        border-bottom: 3px solid var(--drk-red);
        padding: var(--space-lg) 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .drk-header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        padding: 0 var(--space-lg);
    }
    
    .drk-logo {
        display: flex;
        align-items: center;
        margin-right: var(--space-lg);
    }
    
    .drk-logo-icon {
        width: 50px;
        height: 50px;
        background-color: var(--drk-red);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 24px;
        margin-right: var(--space-md);
    }
    
    /* Haupt-Container */
    .container {
        max-width: 1200px;
        margin: var(--space-lg) auto;
        background: var(--drk-white);
        padding: var(--space-xl);
        border-radius: var(--radius-md);
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border-top: 4px solid var(--drk-red);
    }
    
    /* Footer */
    .drk-footer {
        background-color: var(--drk-white);
        border-top: 3px solid var(--drk-red);
        padding: var(--space-lg) 0;
        margin-top: var(--space-xl);
        text-align: center;
        color: var(--drk-gray);
        font-size: 0.9em;
    }
    
    /* =============================================
       HAUPT-NAVIGATION (4 REITER)
       ============================================= */
    
    .main-tabs {
        display: flex;
        margin: var(--space-xl) 0;
        border-bottom: 2px solid var(--drk-red);
        flex-wrap: wrap;
        background: #f8f9fa;
        border-radius: var(--radius-md) var(--radius-md) 0 0;
    }
    
    .main-tab {
        flex: 1;
        min-width: 150px;
        padding: var(--space-md) var(--space-lg);
        cursor: pointer;
        background: #f8f9fa;
        text-align: center;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        border-bottom: 3px solid transparent;
    }
    
    .main-tab:hover {
        background: #e9ecef;
        border-bottom: 3px solid var(--drk-red-light);
    }
    
    .main-tab.active {
        background: var(--drk-white);
        color: var(--drk-red);
        border-bottom: 3px solid var(--drk-red);
    }
    
    .main-tab-content {
        display: none;
        padding: var(--space-xl) 0;
        animation: fadeIn 0.5s ease;
    }
    
    .main-tab-content.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    /* =============================================
       TYPOGRAPHIE
       ============================================= */
    
    .drk-title {
        color: var(--drk-red);
        margin: 0;
        font-size: 24px;
        font-weight: 600;
    }
    
    .drk-subtitle {
        color: var(--drk-gray);
        margin: 0;
        font-size: 14px;
        font-weight: normal;
    }
    
    h1 {
        color: var(--drk-red);
        text-align: center;
        margin-bottom: var(--space-xl);
        font-weight: 600;
        border-bottom: 1px solid #eee;
        padding-bottom: var(--space-md);
    }
    
    h2 {
        color: var(--drk-red);
        font-weight: 600;
        margin-top: var(--space-xl);
        margin-bottom: var(--space-md);
        border-bottom: 1px solid #eee;
        padding-bottom: var(--space-sm);
    }
    
    h3 {
        color: var(--drk-red);
        font-weight: 600;
        margin-top: var(--space-lg);
        margin-bottom: var(--space-sm);
    }
    
    /* =============================================
       FORMULAR ELEMENTE
       ============================================= */
    
    label {
        display: block;
        margin: var(--space-sm) 0 var(--space-xs) 0;
        font-weight: 600;
        color: #444;
    }
    
    input, select, button {
        width: 100%;
        padding: var(--space-sm);
        margin: var(--space-xs) 0;
        border: 1px solid #ddd;
        border-radius: var(--radius-sm);
        box-sizing: border-box;
        font-family: inherit;
        font-size: 16px;
    }
    
    input:focus, select:focus {
        outline: none;
        border-color: var(--drk-red);
        box-shadow: 0 0 0 2px rgba(179, 0, 0, 0.1);
    }
    
    /* =============================================
       BUTTON SYSTEM
       ============================================= */
    
    button {
        background-color: var(--drk-red);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        margin: var(--space-sm) 0;
        transition: all 0.3s ease;
        padding: var(--space-sm) var(--space-md);
    }
    
    button:hover {
        background-color: var(--drk-red-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    button.success {
        background-color: var(--drk-success);
    }
    
    button.success:hover {
        background-color: #45a049;
    }
    
    button.secondary {
        background-color: var(--drk-gray);
    }
    
    button.secondary:hover {
        background-color: #555;
    }
    
    button.pdf {
        background-color: #ff4444;
    }
    
    button.pdf:hover {
        background-color: #cc0000;
    }
    
    button.equipment {
        background-color: var(--drk-warning);
    }
    
    button.equipment:hover {
        background-color: #e68900;
    }
    
    /* =============================================
       SPEZIALISIERTE KOMPONENTEN
       ============================================= */
    
    /* Info-Boxen */
    .info-box {
        background-color: #f0f8ff;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-lg);
        border-left: 4px solid var(--drk-info);
    }
    
    .success-box {
        background-color: #e8f4e8;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-lg);
        border-left: 4px solid var(--drk-success);
    }
    
    .warning-box {
        background-color: #fff3e0;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin-bottom: var(--space-lg);
        border-left: 4px solid var(--drk-warning);
    }
    
    /* Formular Layout */
    .form-group {
        margin: var(--space-sm) 0;
    }
    
    .form-row {
        display: flex;
        gap: var(--space-md);
        flex-wrap: wrap;
        margin: var(--space-md) 0;
    }
    
    .form-row .form-group {
        flex: 1;
        min-width: 200px;
    }
    
    /* Tabellen */
    table {
        width: 100%;
        border-collapse: collapse;
        margin: var(--space-lg) 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    th, td {
        border: 1px solid #ddd;
        padding: var(--space-sm);
        text-align: left;
    }
    
    th {
        background-color: var(--drk-red);
        color: white;
        font-weight: 600;
    }
    
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    
    /* Karten-Layout */
    .card {
        background: white;
        padding: var(--space-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-md);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid var(--drk-red);
    }
    
    /* Unter-Tabs (f√ºr Equipment) */
    .sub-tabs {
        display: flex;
        margin: var(--space-lg) 0;
        border-bottom: 2px solid var(--drk-warning);
        flex-wrap: wrap;
    }
    
    .sub-tab {
        padding: var(--space-sm) var(--space-lg);
        cursor: pointer;
        background: #fff3e0;
        margin-right: var(--space-xs);
        border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 1px solid var(--drk-warning);
        border-bottom: none;
    }
    
    .sub-tab:hover {
        background: #ffe0b2;
    }
    
    .sub-tab.active {
        background: var(--drk-warning);
        color: white;
    }
    
    .sub-tab-content {
        display: none;
        padding: var(--space-lg) 0;
    }
    
    .sub-tab-content.active {
        display: block;
    }
    
    /* Lager-Items */
    .lager-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-sm);
        margin: var(--space-xs) 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: var(--radius-sm);
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    /* Cloud Status */
    .cloud-section {
        background: #e8f5e9;
        padding: var(--space-lg);
        border-radius: var(--radius-sm);
        margin: var(--space-lg) 0;
        border-left: 4px solid var(--drk-success);
    }
    
    .cloud-actions {
        display: flex;
        gap: var(--space-sm);
        margin: var(--space-md) 0;
        flex-wrap: wrap;
    }
    
    .cloud-actions button {
        flex: 1;
        min-width: 200px;
    }
    
    /* ALLERGEN-STYLES */
    .allergene-info-box {
        background: #fff3e0;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin: var(--space-md) 0;
        border-left: 4px solid var(--drk-warning);
    }
    
    .allergen-grid-compact {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 8px;
        margin: 10px 0;
    }
    
    .allergen-item-compact {
        display: flex;
        align-items: center;
        padding: 5px 8px;
        background: white;
        border-radius: 3px;
        border: 1px solid #ddd;
        font-size: 0.85em;
    }
    
    .allergen-badge {
        display: inline-block;
        padding: 2px 8px;
        margin: 2px;
        background: var(--drk-warning);
        color: white;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
    }
    
    .allergen-critical {
        background: #f44336;
    }
    
    .allergen-moderate {
        background: var(--drk-warning);
    }
    
    .allergen-mild {
        background: var(--drk-success);
    }
    
    .allergen-legend {
        background: white;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border: 1px solid #ddd;
        font-size: 0.9em;
    }
    
    /* Empfehlungs-Sektion */
    .recommendation-section {
        background: #e8f5e8;
        padding: var(--space-lg);
        border-radius: var(--radius-sm);
        margin: var(--space-lg) 0;
        border-left: 4px solid var(--drk-success);
    }
    
    .recommendation-card {
        background: white;
        padding: var(--space-lg);
        margin: var(--space-md) 0;
        border-radius: var(--radius-sm);
        border: 2px solid var(--drk-success);
        text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .best-choice {
        background: #f1f8e9;
    }
    
    .cost-saving {
        color: var(--drk-success);
        font-weight: bold;
        font-size: 1.1em;
    }
    
    .loading {
        text-align: center;
        padding: var(--space-md);
        font-size: 1.2em;
    }
    
    .recommendation-stats {
        display: flex;
        justify-content: space-around;
        margin: var(--space-md) 0;
        flex-wrap: wrap;
    }
    
    .stat-item {
        text-align: center;
        padding: var(--space-sm);
    }
    
    .stat-value {
        font-size: 1.3em;
        font-weight: bold;
        color: var(--drk-red);
    }
    
    .stat-label {
        font-size: 0.9em;
        color: var(--drk-gray);
    }
    
    /* Einkaufsmodus */
    .einkaufsmodus-selector {
        background: #fff3cd;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin: var(--space-md) 0;
        border: 1px solid #ffc107;
    }
    
    .modus-option {
        display: flex;
        align-items: center;
        margin: var(--space-sm) 0;
    }
    
    .modus-option input {
        margin-right: var(--space-sm);
        width: auto;
    }
    
    .modus-explanation {
        font-size: 0.9em;
        color: var(--drk-gray);
        margin-left: 25px;
    }
    
    .lager-verwendung {
        background-color: #e8f5e8 !important;
    }
    
    .komplett-kauf {
        background-color: #fff3e0 !important;
    }
    
    /* PDF Export Button Styles */
    .pdf-export-section {
        background: #ffe6e6;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin: var(--space-md) 0;
        border-left: 4px solid #ff4444;
    }
    
    /* EQUIPMENT-STYLES */
    .equipment-section {
        background: #fff3e0;
        padding: var(--space-lg);
        border-radius: var(--radius-sm);
        margin: var(--space-lg) 0;
        border-left: 4px solid var(--drk-warning);
    }
    
    .einsatz-optionen {
        background: #e3f2fd;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin: var(--space-md) 0;
        border-left: 4px solid var(--drk-info);
    }
    
    .einsatz-ergebnis {
        background: #e8f5e8;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin: var(--space-md) 0;
        border-left: 4px solid var(--drk-success);
    }
    
    .material-quelle {
        display: flex;
        align-items: center;
        margin: var(--space-sm) 0;
        padding: var(--space-sm);
        background: white;
        border-radius: var(--radius-sm);
        border: 1px solid #ddd;
    }
    
    .material-quelle input {
        width: auto;
        margin-right: var(--space-sm);
    }
    
    .transfer-section {
        background: #e3f2fd;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin: var(--space-md) 0;
        border-left: 4px solid var(--drk-info);
    }
    
    /* VERBESSERTE LAGER-ANZEIGE STYLES */
    .lager-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--space-md);
        margin-bottom: var(--space-lg);
    }
    
    .lager-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: var(--radius-md);
        padding: var(--space-md);
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        border-left: 4px solid var(--drk-success);
    }
    
    .lager-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    
    .lager-card-warning {
        border-left: 4px solid var(--drk-warning);
        background: #fffaf3;
    }
    
    .lager-card-expired {
        border-left: 4px solid var(--drk-red);
        background: #fff5f5;
    }
    
    /* Lager-Header */
    .lager-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-sm);
        padding-bottom: var(--space-xs);
        border-bottom: 1px solid #f0f0f0;
    }
    
    .lager-badge {
        padding: var(--space-xs) var(--space-sm);
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
    }
    
    .lager-badge-getreide { background: #8B4513; }
    .lager-badge-gemuese { background: var(--drk-success); }
    .lager-badge-fleisch { background: #DC143C; }
    .lager-badge-gewuerze { background: #FF8C00; }
    .lager-badge-milch { background: #87CEEB; }
    .lager-badge-obst { background: #FF69B4; }
    
    .lager-status {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 12px;
    }
    
    .lager-status-ok {
        background: #e8f5e8;
        color: var(--drk-success);
    }
    
    .lager-status-warning {
        background: #fff3cd;
        color: #856404;
    }
    
    .lager-status-expired {
        background: #f8d7da;
        color: #721c24;
    }
    
    /* Lager-Content */
    .lager-content h4 {
        margin: 0 0 var(--space-sm) 0;
        color: #333;
        font-size: 1.1rem;
    }
    
    .lager-details {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }
    
    .lager-detail {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
    }
    
    .detail-label {
        color: var(--drk-gray);
        font-weight: 500;
    }
    
    .detail-value {
        color: #333;
        font-weight: 600;
    }
    
    .warning-text {
        color: var(--drk-warning);
        font-weight: bold;
    }
    
    /* Lager-Actions */
    .lager-actions {
        display: flex;
        gap: var(--space-xs);
        margin-top: var(--space-md);
        padding-top: var(--space-sm);
        border-top: 1px solid #f0f0f0;
    }
    
    .btn-small {
        padding: var(--space-xs) var(--space-sm);
        font-size: 0.8rem;
        flex: 1;
        margin: 0;
    }
    
    /* Lager-Filter */
    .lager-filter {
        background: #f8f9fa;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        margin-top: var(--space-lg);
    }
    
    .lager-filter h4 {
        margin: 0 0 var(--space-sm) 0;
        color: var(--drk-gray);
    }
    
    /* NEUE STYLES F√úR KATEGORIEN-GRID */
    .kategorien-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--space-md);
        margin-bottom: var(--space-lg);
    }
    
    .kategorie-group {
        background: #f8f9fa;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        border: 1px solid #e9ecef;
        height: fit-content;
    }
    
    .kategorie-header {
        display: flex;
        align-items: center;
        margin-bottom: var(--space-sm);
    }
    
    .kategorie-header h4 {
        margin: 0;
        flex: 1;
        color: var(--drk-red);
        font-size: 1.1em;
    }
    
    .vegetarisch-checkbox {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        white-space: nowrap;
    }
    
    .vegetarisch-checkbox input {
        width: auto;
        margin: 0;
    }
    
    .vegetarisch-checkbox label {
        margin: 0;
        font-size: 0.85em;
        color: var(--drk-success);
        font-weight: 600;
    }
    
    /* Rezept-Layout mit zwei Spalten */
    .rezept-container {
        display: flex;
        gap: var(--space-lg);
        margin: var(--space-lg) 0;
    }
    
    .zutaten-tabelle {
        flex: 1;
        min-width: 0;
    }
    
    .anleitung {
        flex: 1;
        min-width: 0;
        background: #f9f9f9;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        border-left: 4px solid var(--drk-info);
    }
    
    .anleitung h3 {
        color: var(--drk-info);
        margin-top: 0;
    }
    
    .anleitung ol {
        padding-left: var(--space-lg);
    }
    
    .anleitung li {
        margin-bottom: var(--space-sm);
    }
    
    /* Info-Bl√∂cke unter Allergenen */
    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-md);
        margin: var(--space-md) 0;
    }
    
    .info-card {
        background: white;
        padding: var(--space-md);
        border-radius: var(--radius-sm);
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .info-card h4 {
        margin: 0 0 var(--space-sm) 0;
        color: var(--drk-red);
        font-size: 1.1em;
    }
    
    .info-value {
        font-size: 1.5em;
        font-weight: bold;
        color: var(--drk-red);
        margin-bottom: var(--space-xs);
    }
    
    .info-label {
        font-size: 0.9em;
        color: var(--drk-gray);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .container {
            padding: var(--space-md);
            margin: var(--space-sm);
        }
        
        .form-row {
            flex-direction: column;
        }
        
        .form-row .form-group {
            min-width: 100%;
        }
        
        .main-tabs, .sub-tabs {
            flex-direction: column;
        }
        
        .main-tab, .sub-tab {
            margin-bottom: var(--space-xs);
            border-radius: var(--radius-sm);
        }
        
        .cloud-actions {
            flex-direction: column;
        }
        
        .cloud-actions button {
            width: 100%;
        }
        
        .lager-grid {
            grid-template-columns: 1fr;
        }
        
        .lager-actions {
            flex-direction: column;
        }
        
        .lager-header {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-xs);
        }
        
        /* Responsive f√ºr Kategorien-Grid */
        .kategorien-grid {
            grid-template-columns: 1fr;
            gap: var(--space-sm);
        }
        
        .kategorie-group {
            padding: var(--space-sm);
        }
        
        .rezept-container {
            flex-direction: column;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
        
        .allergen-grid-compact {
            grid-template-columns: 1fr 1fr;
        }
    }
    
    /* F√ºr sehr gro√üe Bildschirme */
    @media (min-width: 1200px) {
        .kategorien-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    </style>
</head>
<body>
    <!-- DRK Header -->
    <header class="drk-header">
        <div class="drk-header-content">
            <div class="drk-logo">
                <div class="drk-logo-icon">DRK</div>
                <div>
                    <h1 class="drk-title">Feldk√ºche</h1>
                    <p class="drk-subtitle">Intelligente Rezeptempfehlung</p>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- HAUPT-NAVIGATION - 4 REITER -->
        <div class="main-tabs">
            <div class="main-tab active" onclick="switchMainTab('rezept')">üç≤ Rezept</div>
            <div class="main-tab" onclick="switchMainTab('einkauf')">üõí Einkauf</div>
            <div class="main-tab" onclick="switchMainTab('materiallager')">üè™ Materiallager</div>
            <div class="main-tab" onclick="switchMainTab('lebensmittellager')">ü•´ Lebensmittellager</div>
        </div>

        <!-- =============================================
             REZEPT TAB (√úBERARBEITETE VERSION)
             ============================================= -->
        <div id="rezept-tab" class="main-tab-content active">
            <h1>Rezeptempfehlung</h1>

            <!-- Intelligente Rezeptempfehlung -->
            <div class="card">
                <h2>ü§ñ Intelligente Rezeptempfehlung</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="empfohlen-personen">Personenzahl f√ºr Empfehlung:</label>
                        <input type="number" id="empfohlen-personen" placeholder="z. B. 50" min="1" value="50">
                    </div>
                </div>
                <button onclick="zeigeRezeptEmpfehlungen()" class="success">üéØ Bestes Rezept finden</button>
                
                <div id="rezept-empfehlungen"></div>
            </div>

            <!-- Manuelle Rezeptauswahl -->
            <div class="card">
                <h2>Manuelle Rezeptauswahl</h2>
                
                <!-- NEU: Kategorien als Grid nebeneinander -->
                <div class="kategorien-grid">
                    <!-- Kaltverpflegung -->
                    <div class="kategorie-group">
                        <div class="kategorie-header">
                            <h4>ü•ó Kaltverpflegung</h4>
                            <div class="vegetarisch-checkbox">
                                <input type="checkbox" id="kalt-vegetarisch" onchange="filterRezepte('kalt')">
                                <label for="kalt-vegetarisch">Vegetarisch</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="kalt-rezept">Rezept ausw√§hlen:</label>
                            <select id="kalt-rezept" onchange="updateAktivesRezept('kalt')">
                                <!-- Wird dynamisch gef√ºllt -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Warmverpflegung -->
                    <div class="kategorie-group">
                        <div class="kategorie-header">
                            <h4>üç≤ Warmverpflegung</h4>
                            <div class="vegetarisch-checkbox">
                                <input type="checkbox" id="warm-vegetarisch" onchange="filterRezepte('warm')">
                                <label for="warm-vegetarisch">Vegetarisch</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="warm-rezept">Rezept ausw√§hlen:</label>
                            <select id="warm-rezept" onchange="updateAktivesRezept('warm')">
                                <!-- Wird dynamisch gef√ºllt -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Lunchpakete -->
                    <div class="kategorie-group">
                        <div class="kategorie-header">
                            <h4>üéí Lunchpakete</h4>
                            <div class="vegetarisch-checkbox">
                                <input type="checkbox" id="lunch-vegetarisch" onchange="filterRezepte('lunch')">
                                <label for="lunch-vegetarisch">Vegetarisch</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="lunch-rezept">Rezept ausw√§hlen:</label>
                            <select id="lunch-rezept" onchange="updateAktivesRezept('lunch')">
                                <!-- Wird dynamisch gef√ºllt -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Personenzahl unter den Kategorien -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="personen">Personenzahl:</label>
                        <input type="number" id="personen" placeholder="z. B. 50" min="1" value="50">
                    </div>
                </div>
                
                <button onclick="zeigeRezept()">Rezept & Einkaufsliste anzeigen</button>
            </div>

            <!-- Rezept-Details -->
            <div id="ausgabe"></div>
            
            <!-- Allergen-Information -->
            <div id="allergene-info-box" class="allergene-info-box" style="display: none;">
                <h3>‚ö†Ô∏è Allergen-Informationen</h3>
                <div id="allergen-anzeige"></div>
            </div>

            <!-- PDF Export -->
            <div class="card">
                <h3>üìÑ PDF Export</h3>
                <p>Exportieren Sie das Rezept als PDF f√ºr den Druck oder zur Weitergabe:</p>
                <button onclick="exportRezeptAsPDF()" class="pdf">üì• Rezept als PDF exportieren</button>
            </div>
        </div>

        <!-- =============================================
             EINKAUF TAB
             ============================================= -->

		<div id="einkauf-tab" class="main-tab-content">
			<h1>Einkaufsliste</h1>
			
			<!-- Einkaufsmodus Auswahl -->
			<div class="einkaufsmodus-selector">
				<h3>üõí Einkaufsmodus ausw√§hlen</h3>
				<div class="modus-option">
					<input type="radio" id="modus-lager" name="einkaufsmodus" value="lager" checked>
					<label for="modus-lager"><strong>Nur fehlende Mengen kaufen</strong> (Lagerbestand wird ber√ºcksichtigt)</label>
				</div>
				<div class="modus-explanation">
					Beispiel: Bei 15 kg ben√∂tigt und 12 kg im Lager ‚Üí nur 3 kg kaufen
				</div>
				
				<div class="modus-option">
					<input type="radio" id="modus-komplett" name="einkaufsmodus" value="komplett">
					<label for="modus-komplett"><strong>Alles neu kaufen</strong> (Lagerbestand ignorieren)</label>
				</div>
				<div class="modus-explanation">
					Beispiel: Bei 15 kg ben√∂tigt ‚Üí komplette 15 kg kaufen (auch wenn Lager vorhanden)
				</div>
				
				<button onclick="aktualisiereEinkaufslisteTab()" class="secondary">üîÑ Einkaufsliste aktualisieren</button>
			</div>

			<!-- EINKAUFSLISTE ANZEIGE -->
			<div id="einkaufsliste-container">
				<div id="einkaufsliste">
					<div class="info-box">
						<p>‚ìò Bitte w√§hlen Sie zuerst ein Rezept im Rezept-Tab aus und klicken Sie auf "Rezept & Einkaufsliste anzeigen".</p>
					</div>
				</div>
			</div>

			<!-- PDF Export -->
			<div class="card">
				<h3>üìÑ PDF Export</h3>
				<button onclick="exportAsPDF()" class="pdf">üì• Einkaufsliste als PDF exportieren</button>
			</div>
		</div>

        <!-- =============================================
             MATERIALLAGER TAB (Equipment)
             ============================================= -->
        <div id="materiallager-tab" class="main-tab-content">
            <h1>Materiallager</h1>
            
            <!-- Unter-Tabs f√ºr Equipment -->
            <div class="sub-tabs">
                <div class="sub-tab active" onclick="switchSubTab('gw-beladung')">üöê GW-V Beladung</div>
                <div class="sub-tab" onclick="switchSubTab('kv-lager')">üè¢ KV-Lager</div>
                <div class="sub-tab" onclick="switchSubTab('einsatz')">üîÑ Einsatz</div>
            </div>

            <!-- GW-Beladung -->
            <div id="gw-beladung-subtab" class="sub-tab-content active">
                <div class="card">
                    <h3>üöê GW-Verpflegung Beladung (HIK 3.0)</h3>
                    
                    <!-- Formular -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gw-name">Bezeichnung:</label>
                            <input type="text" id="gw-name" placeholder="z.B. Kochtopf 100L">
                        </div>
                        <div class="form-group">
                            <label for="gw-menge">Menge:</label>
                            <input type="number" id="gw-menge" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="gw-kategorie">Kategorie (HIK 3.0):</label>
                            <select id="gw-kategorie">
                                <option value="Kochausr√ºstung">Kochausr√ºstung</option>
                                <option value="Geschirr">Geschirr</option>
                                <option value="Besteck">Besteck</option>
                                <option value="K√ºchenger√§te">K√ºchenger√§te</option>
                                <option value="Reinigung">Reinigung</option>
                                <option value="Schutzausr√ºstung">Schutzausr√ºstung</option>
                                <option value="Brenner & Energie">Brenner & Energie</option>
                                <option value="Wasseraufbereitung">Wasseraufbereitung</option>
                                <option value="Lebensmittelzubereitung">Lebensmittelzubereitung</option>
                                <option value="Sonstiges">Sonstiges</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gw-notizen">Notizen:</label>
                            <input type="text" id="gw-notizen" placeholder="Lagerort, Besonderheiten...">
                        </div>
                    </div>
                    <button onclick="fuegeGWEquipmentHinzu()" class="success">‚ûï Equipment hinzuf√ºgen</button>
                </div>

                <!-- Aktionsbuttons -->
                <div class="cloud-actions">
                    <button onclick="EquipmentManager.ladeHIKDefault('gw')" class="success">üìã HIK 3.0 Default laden</button>
                    <button onclick="EquipmentManager.gwLeeren()" class="secondary">üóëÔ∏è GW-Beladung leeren</button>
                </div>

                <!-- Bestandsanzeige -->
                <div id="gw-beladung"></div>
            </div>

            <!-- KV-Lager -->
            <div id="kv-lager-subtab" class="sub-tab-content">
                <h3>üè¢ KV-Lager (Kreisverband)</h3>
                
                <!-- Formular f√ºr KV-Lager -->
                <div class="card">
                    <h4>Neues Equipment zum KV-Lager hinzuf√ºgen</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="kv-lager-name">Bezeichnung:</label>
                            <input type="text" id="kv-lager-name" placeholder="z.B. Kochtopf 100L">
                        </div>
                        <div class="form-group">
                            <label for="kv-lager-menge">Menge:</label>
                            <input type="number" id="kv-lager-menge" min="1" value="1" placeholder="1">
                        </div>
                        <div class="form-group">
                            <label for="kv-lager-kategorie">Kategorie:</label>
                            <select id="kv-lager-kategorie">
                                <option value="Kochausr√ºstung">Kochausr√ºstung</option>
                                <option value="Geschirr">Geschirr</option>
                                <option value="Besteck">Besteck</option>
                                <option value="K√ºchenger√§te">K√ºchenger√§te</option>
                                <option value="Reinigung">Reinigung</option>
                                <option value="Schutzausr√ºstung">Schutzausr√ºstung</option>
                                <option value="Brenner & Energie">Brenner & Energie</option>
                                <option value="Wasseraufbereitung">Wasseraufbereitung</option>
                                <option value="Lebensmittelzubereitung">Lebensmittelzubereitung</option>
                                <option value="Sonstiges">Sonstiges</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="kv-lager-notizen">Notizen:</label>
                            <input type="text" id="kv-lager-notizen" placeholder="Lagerort, Besonderheiten...">
                        </div>
                    </div>
                    <button onclick="fuegeKVLagerHinzu()" class="success">‚ûï Equipment hinzuf√ºgen</button>
                </div>

                <!-- Aktionsbuttons f√ºr KV-Lager -->
                <div class="cloud-actions">
                    <button onclick="EquipmentManager.ladeHIKDefault('kv-lager')" class="success">üìã HIK 3.0 Default laden</button>
                    <button onclick="EquipmentManager.kvLagerLeeren()" class="secondary">üóëÔ∏è KV-Lager leeren</button>
                </div>

                <!-- Transfer-Buttons zwischen Lager und Fahrzeug -->
                <div class="transfer-section">
                    <h4>üîÑ Transfer zwischen Lager und Fahrzeug</h4>
                    <div class="cloud-actions">
                        <button onclick="EquipmentManager.transferAllToVehicle()" class="equipment">üöö Alles auf Fahrzeug laden</button>
                        <button onclick="EquipmentManager.transferAllToStorage()" class="secondary">üè¢ Alles ins Lager r√§umen</button>
                        <button onclick="EquipmentManager.syncInventory()" class="success">üîÑ Best√§nde synchronisieren</button>
                    </div>
                </div>

                <!-- KV-Lager-Anzeige -->
                <div id="kv-lager"></div>
            </div>

            <!-- Einsatz -->
            <div id="einsatz-subtab" class="sub-tab-content">
                <h3>üîÑ Einsatzmaterial-Berechnung</h3>
                
                <div class="einsatz-optionen">
                    <h4>Einsatzkonfiguration</h4>
                    <label for="einsatz-personen">Personenzahl:</label>
                    <input type="number" id="einsatz-personen" min="1" value="50" placeholder="50">
                    
                    <label for="einsatz-dauer">Einsatzdauer (Tage):</label>
                    <input type="number" id="einsatz-dauer" min="1" value="1" placeholder="1">
                    
                    <h4>Material-Quellen:</h4>
                    <div class="material-quelle">
                        <input type="radio" id="quelle-auto" name="material-quelle" value="auto" checked>
                        <label for="quelle-auto"><strong>Zuerst Fahrzeug, dann Lager</strong> - GW-V Beladung zuerst nutzen</label>
                    </div>
                    <div class="material-quelle">
                        <input type="radio" id="quelle-lager" name="material-quelle" value="lager">
                        <label for="quelle-lager"><strong>Zuerst Lager, dann Fahrzeug</strong> - Lagerbestand zuerst nutzen</label>
                    </div>
                    
                    <button onclick="berechneEinsatzMaterial()" class="success">üßÆ Materialbedarf berechnen</button>
                </div>

                <div id="einsatz-ergebnis"></div>
            </div>

            <!-- Cloud-Section -->
            <div class="cloud-section">
                <h3>‚òÅÔ∏è Cloud Storage</h3>
                <div class="cloud-actions">
                    <button onclick="CloudStorage.autoSync()" class="success">üîÑ Mit Cloud synchronisieren</button>
                    <button onclick="CloudStorage.createFullBackup()" class="secondary">üíæ Cloud Backup erstellen</button>
                </div>
                <div class="info-box">
                    <p id="cloud-status">‚úÖ Mit Cloud verbunden - Letzte Synchronisation: heute 14:32</p>
                </div>
            </div>
        </div>

        <!-- =============================================
             LEBENSMITTEL-LAGER TAB
             ============================================= -->
        <div id="lebensmittellager-tab" class="main-tab-content">
            <h1>Lebensmittel-Lager</h1>
            
            <!-- Formular zum Hinzuf√ºgen -->
            <div class="card">
                <h3>Neues Lebensmittel hinzuf√ºgen</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lager-name">Name:</label>
                        <input type="text" id="lager-name" placeholder="z.B. Mehl">
                    </div>
                    <div class="form-group">
                        <label for="lager-menge">Menge:</label>
                        <input type="number" id="lager-menge" step="0.001" min="0" placeholder="0.000">
                    </div>
                    <div class="form-group">
                        <label for="lager-einheit">Einheit:</label>
                        <select id="lager-einheit">
                            <option value="kg">kg</option>
                            <option value="g">g</option>
                            <option value="L">Liter</option>
                            <option value="ml">ml</option>
                            <option value="St√ºck">St√ºck</option>
                            <option value="Packung">Packung</option>
                            <option value="Dose">Dose</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lager-kategorie">Kategorie:</label>
                        <select id="lager-kategorie">
                            <option value="Gem√ºse">Gem√ºse</option>
                            <option value="Obst">Obst</option>
                            <option value="Fleisch">Fleisch</option>
                            <option value="Fisch">Fisch</option>
                            <option value="Milchprodukte">Milchprodukte</option>
                            <option value="Getreide">Getreide</option>
                            <option value="Gew√ºrze">Gew√ºrze</option>
                            <option value="√ñle & Fette">√ñle & Fette</option>
                            <option value="Getr√§nke">Getr√§nke</option>
                            <option value="Konserven">Konserven</option>
                            <option value="Tiefk√ºhl">Tiefk√ºhl</option>
                            <option value="Sonstiges">Sonstiges</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lager-haltbarkeit">Haltbarkeitsdatum:</label>
                        <input type="date" id="lager-haltbarkeit">
                    </div>
                    <div class="form-group">
                        <label for="lager-notizen">Notizen:</label>
                        <input type="text" id="lager-notizen" placeholder="Lagerort, Besonderheiten...">
                    </div>
                </div>
                <button onclick="fuegeLebensmittelHinzu()" class="success">‚ûï Lebensmittel hinzuf√ºgen</button>
            </div>

            <!-- Cloud-Section -->
            <div class="cloud-section">
                <h3>‚òÅÔ∏è Cloud Storage</h3>
                <div class="cloud-actions">
                    <button onclick="CloudStorage.autoSync()" class="success">üîÑ Mit Cloud synchronisieren</button>
                    <button onclick="CloudStorage.createFullBackup()" class="secondary">üíæ Cloud Backup erstellen</button>
                    <button onclick="CloudStorage.restoreFullBackup()" class="secondary">üîÑ Backup wiederherstellen</button>
                </div>
                <div class="info-box">
                    <p>‚úÖ Mit Cloud verbunden - Alle Daten werden automatisch gesichert</p>
                </div>
            </div>

            <!-- Aktionsbuttons -->
            <div class="cloud-actions">
                <button onclick="LagerManager.syncWithCloud()" class="success">‚òÅÔ∏è Mit Cloud synchronisieren</button>
                <button onclick="lagerLeeren()" class="secondary">üóëÔ∏è Lager leeren</button>
                <button onclick="zeigeAbgelaufene()" class="secondary">‚ö†Ô∏è Abgelaufene anzeigen</button>
            </div>

            <!-- Lagerbestandsanzeige -->
            <div id="lager-bestand"></div>
        </div>
    </div>

    <!-- DRK Footer -->
    <footer class="drk-footer">
        <div class="container">
            <p>Deutsches Rotes Kreuz - Feldk√ºche System</p>
            <p>¬© 2023 DRK - Alle Rechte vorbehalten</p>
        </div>
    </footer>

    <script>
    // =============================================
    // CLOUD STORAGE MANAGEMENT - ECHTES BACKEND
    // =============================================

    const CloudStorage = {
        // Upstash Redis REST API Konfiguration
        apiBase: "https://helping-cougar-30935.upstash.io",
        apiToken: "AXjXAAIncDJhNzc0OTViMWEwZGI0MDdlYmRjNWFhOTYxYjRmNjVhYXAyMzA5MzU",
        
        async saveToCloud(key, data) {
            try {
                if (!navigator.onLine) {
                    this.updateCloudStatus('‚ùå Offline - Keine Internetverbindung', 'error');
                    return this.saveToLocalStorage(key, data);
                }
                
                const response = await fetch(`${this.apiBase}/set/${key}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${this.apiToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    this.updateCloudStatus(`‚úÖ ${key} in Cloud gespeichert`, 'success');
                    // Auch lokal speichern als Backup
                    this.saveToLocalStorage(key, data);
                    return true;
                } else {
                    const errorText = await response.text();
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Cloud-Speicherung fehlgeschlagen:', error);
                this.updateCloudStatus(`‚ùå Cloud-Fehler: ${error.message}`, 'error');
                
                // Fallback auf localStorage
                this.updateCloudStatus('üíæ Verwende lokalen Speicher als Fallback', 'info');
                return this.saveToLocalStorage(key, data);
            }
        },

        async loadFromCloud(key) {
            try {
                if (!navigator.onLine) {
                    this.updateCloudStatus('‚ùå Offline - Lade lokale Daten', 'error');
                    return this.loadFromLocalStorage(key);
                }
                
                const response = await fetch(`${this.apiBase}/get/${key}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${this.apiToken}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result && result.result) {
                        const data = JSON.parse(result.result);
                        this.updateCloudStatus(`‚úÖ ${key} von Cloud geladen`, 'success');
                        // Lokal synchronisieren
                        this.saveToLocalStorage(key, data);
                        return data;
                    } else {
                        this.updateCloudStatus(`‚ÑπÔ∏è Keine Daten f√ºr ${key} in Cloud`, 'info');
                        // Versuche lokale Daten
                        return this.loadFromLocalStorage(key);
                    }
                } else {
                    const errorText = await response.text();
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Cloud-Ladung fehlgeschlagen:', error);
                this.updateCloudStatus(`‚ùå Cloud-Fehler: ${error.message}`, 'error');
                
                // Fallback auf localStorage
                this.updateCloudStatus('üíæ Lade lokale Daten', 'info');
                return this.loadFromLocalStorage(key);
            }
        },

        // Lokale Speicherung als Fallback
        saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(`cloud_backup_${key}`, JSON.stringify({
                    data: data,
                    lastSync: new Date().toISOString(),
                    source: 'local_fallback'
                }));
                return true;
            } catch (error) {
                console.error('Lokale Speicherung fehlgeschlagen:', error);
                return false;
            }
        },

        loadFromLocalStorage(key) {
            try {
                const stored = localStorage.getItem(`cloud_backup_${key}`);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    return parsed.data;
                }
                return null;
            } catch (error) {
                console.error('Lokale Ladung fehlgeschlagen:', error);
                return null;
            }
        },

        updateCloudStatus(message, type = 'info') {
            const statusElement = document.getElementById('cloud-status');
            if (statusElement) {
                const typeClass = type === 'success' ? 'status-success' : 
                                type === 'error' ? 'status-error' : 'status-info';
                statusElement.innerHTML = `<p class="${typeClass}">${message}</p>`;
            }
        },

        async autoSync() {
            const keys = [
                { key: 'equipment_gw', name: 'GW-Beladung' },
                { key: 'equipment_kv_lager', name: 'KV-Lager' },
                { key: 'feldkueche_lager', name: 'Lebensmittel-Lager' }
            ];
            
            let syncedCount = 0;
            let errorCount = 0;
            
            this.updateCloudStatus('üîÑ Starte Synchronisation mit Cloud...', 'info');

            for (const item of keys) {
                try {
                    const localData = localStorage.getItem(item.key);
                    
                    if (localData) {
                        const parsedData = JSON.parse(localData);
                        const success = await this.saveToCloud(item.key, parsedData);
                        
                        if (success) {
                            syncedCount++;
                            this.updateCloudStatus(
                                `‚úÖ ${item.name} synchronisiert (${syncedCount}/${keys.length})`, 
                                'success'
                            );
                        } else {
                            errorCount++;
                        }
                        
                        // Kurze Pause zwischen den Requests
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                } catch (error) {
                    console.error(`Fehler beim Sync von ${item.key}:`, error);
                    errorCount++;
                }
            }

            if (errorCount === 0) {
                this.updateCloudStatus(`‚úÖ ${syncedCount}/${keys.length} Datens√§tze erfolgreich synchronisiert`, 'success');
            } else {
                this.updateCloudStatus(
                    `‚ö†Ô∏è ${syncedCount}/${keys.length} synchronisiert, ${errorCount} Fehler`, 
                    'error'
                );
            }
            
            return { syncedCount, errorCount };
        },

        async createFullBackup() {
            const backupData = {
                equipment_gw: JSON.parse(localStorage.getItem('equipment_gw') || '[]'),
                equipment_kv_lager: JSON.parse(localStorage.getItem('equipment_kv_lager') || '[]'),
                feldkueche_lager: JSON.parse(localStorage.getItem('feldkueche_lager') || '[]'),
                backupCreated: new Date().toISOString(),
                version: '1.0',
                device: navigator.userAgent,
                timestamp: Date.now()
            };

            this.updateCloudStatus('üíæ Erstelle Cloud-Backup...', 'info');
            const success = await this.saveToCloud('full_backup', backupData);
            
            if (success) {
                this.updateCloudStatus('‚úÖ Vollst√§ndiges Backup in Cloud gespeichert!', 'success');
                alert('‚úÖ Vollst√§ndiges Backup in Cloud gespeichert!');
            } else {
                this.updateCloudStatus('‚ùå Backup fehlgeschlagen!', 'error');
                alert('‚ùå Backup fehlgeschlagen! Daten wurden nur lokal gespeichert.');
            }
            
            return success;
        },

        async restoreFullBackup() {
            if (!confirm('Cloud-Backup wiederherstellen? Lokale Daten werden √ºberschrieben!')) {
                return false;
            }

            this.updateCloudStatus('üîÑ Lade Backup von Cloud...', 'info');
            const backupData = await this.loadFromCloud('full_backup');
            
            if (backupData) {
                // Daten wiederherstellen
                localStorage.setItem('equipment_gw', JSON.stringify(backupData.equipment_gw || []));
                localStorage.setItem('equipment_kv_lager', JSON.stringify(backupData.equipment_kv_lager || []));
                localStorage.setItem('feldkueche_lager', JSON.stringify(backupData.feldkueche_lager || []));
                
                // UI aktualisieren
                EquipmentManager.gwBeladung = backupData.equipment_gw || [];
                EquipmentManager.kvLager = backupData.equipment_kv_lager || [];
                LagerManager.lagerbestand = backupData.feldkueche_lager || [];
                
                EquipmentManager.aktualisiereGWAnzeige();
                EquipmentManager.aktualisiereKVLagerAnzeige();
                LagerManager.aktualisiereAnzeige();
                
                const backupDate = new Date(backupData.backupCreated).toLocaleDateString('de-DE');
                this.updateCloudStatus(`‚úÖ Backup vom ${backupDate} wiederhergestellt!`, 'success');
                alert(`‚úÖ Backup vom ${backupDate} wiederhergestellt!`);
                return true;
            } else {
                this.updateCloudStatus('‚ùå Kein Backup in Cloud gefunden!', 'error');
                alert('‚ùå Kein Backup in Cloud gefunden!');
                return false;
            }
        },

        // Pr√ºfe Cloud-Status beim Start
        async checkCloudStatus() {
            this.updateCloudStatus('üì° Pr√ºfe Cloud-Verbindung...', 'info');
            
            try {
                const response = await fetch(`${this.apiBase}/ping`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${this.apiToken}`
                    }
                });
                
                if (response.ok) {
                    this.updateCloudStatus('‚úÖ Mit Cloud verbunden', 'success');
                    return true;
                } else {
                    this.updateCloudStatus('‚ùå Cloud-Verbindung fehlgeschlagen', 'error');
                    return false;
                }
            } catch (error) {
                this.updateCloudStatus('‚ùå Cloud-Verbindung fehlgeschlagen', 'error');
                return false;
            }
        }
    };

    // =============================================
    // ALLERGENE DATENBANK (LMIV - 14 Hauptallergene)
    // =============================================

    const allergene = {
        'A': { name: 'Glutenhaltiges Getreide', kritikalitaet: 'hoch', icon: 'üü•' },
        'B': { name: 'Krebstiere', kritikalitaet: 'hoch', icon: 'üü•' },
        'C': { name: 'Eier', kritikalitaet: 'hoch', icon: 'üü•' },
        'D': { name: 'Fisch', kritikalitaet: 'hoch', icon: 'üü•' },
        'E': { name: 'Erdn√ºsse', kritikalitaet: 'hoch', icon: 'üü•' },
        'F': { name: 'Soja', kritikalitaet: 'mittel', icon: 'üü®' },
        'G': { name: 'Milch/Laktose', kritikalitaet: 'hoch', icon: 'üü•' },
        'H': { name: 'Schalenfr√ºchte', kritikalitaet: 'hoch', icon: 'üü•' },
        'I': { name: 'Sellerie', kritikalitaet: 'mittel', icon: 'üü®' },
        'J': { name: 'Senf', kritikalitaet: 'mittel', icon: 'üü®' },
        'K': { name: 'Sesamsamen', kritikalitaet: 'hoch', icon: 'üü•' },
        'L': { name: 'Schwefeldioxid/Sulfite', kritikalitaet: 'mittel', icon: 'üü®' },
        'M': { name: 'Lupinen', kritikalitaet: 'hoch', icon: 'üü•' },
        'N': { name: 'Weichtiere', kritikalitaet: 'hoch', icon: 'üü•' }
    };

    // =============================================
    // WASGAU PRODUKTDATENBANK MIT ALLERGENEN
    // =============================================

    const wasgauProdukte = {
        "Kartoffelw√ºrfel": { einheit: "kg", packungsgroessen: [2.5, 5, 10], preise: [1.99, 3.49, 6.49] },
        "Raps√∂l": { einheit: "L", packungsgroessen: [1, 3, 5], preise: [2.29, 5.99, 9.49] },
        "Zwiebeln (TK oder frisch)": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [1.49, 2.99, 5.49] },
        "Gem√ºsebr√ºhe": { einheit: "L", packungsgroessen: [1, 5], preise: [0.99, 3.99] },
        "Majoran": { einheit: "kg", packungsgroessen: [0.05, 0.1], preise: [4.99, 8.99] },
        "Salz": { einheit: "kg", packungsgroessen: [0.5, 1], preise: [0.49, 0.79] },
        "Pfeffer": { einheit: "kg", packungsgroessen: [0.05, 0.1], preise: [6.99, 12.99] },
        "Kartoffelbreipulver": { einheit: "Packung", packungsgroessen: [1], preise: [2.49] },
        "Muskatnuss": { einheit: "kg", packungsgroessen: [0.05], preise: [12.99] },
        "Petersilie": { einheit: "Packung", packungsgroessen: [1], preise: [1.29] },
        "Gem√ºse-TK (Mirepoix)": { einheit: "kg", packungsgroessen: [1, 2.5], preise: [2.49, 4.99] },
        "Rindergulasch": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [12.99, 29.99, 56.99] },
        "Paprikaschoten": { einheit: "kg", packungsgroessen: [1, 2.5], preise: [3.99, 8.99] },
        "Tomatenmark": { einheit: "kg", packungsgroessen: [0.2, 0.5, 1], preise: [1.99, 3.99, 6.99] },
        "Rinderfond": { einheit: "L", packungsgroessen: [1, 5], preise: [2.49, 9.99] },
        "Rotwein": { einheit: "L", packungsgroessen: [0.75, 1.5], preise: [4.99, 8.99] },
        "Paprikapulver": { einheit: "kg", packungsgroessen: [0.05, 0.1], preise: [5.99, 10.99] },
        "K√ºmmel": { einheit: "kg", packungsgroessen: [0.05], preise: [7.99] },
        "Knoblauch": { einheit: "kg", packungsgroessen: [0.2, 0.5], preise: [4.99, 10.99] },
        "Rinderhackfleisch": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [9.99, 22.99, 42.99] },
        "Kidneybohnen (Dose)": { einheit: "kg", packungsgroessen: [0.4, 1], preise: [1.29, 2.49] },
        "Mais (Dose)": { einheit: "kg", packungsgroessen: [0.34, 0.8], preise: [1.19, 2.29] },
        "Tomaten (st√ºckig, Dose)": { einheit: "kg", packungsgroessen: [0.4, 1], preise: [1.39, 2.99] },
        "Chilipulver": { einheit: "kg", packungsgroessen: [0.05], preise: [6.99] },
        "Kreuzk√ºmmel": { einheit: "kg", packungsgroessen: [0.05], preise: [8.99] },
        "Oregano": { einheit: "kg", packungsgroessen: [0.05, 0.1], preise: [5.99, 10.99] },
        "Rinderbr√ºhe": { einheit: "L", packungsgroessen: [1, 5], preise: [1.29, 4.99] },
        "Karotten": { einheit: "kg", packungsgroessen: [1, 2.5], preise: [1.29, 2.79] },
        "Sellerie": { einheit: "kg", packungsgroessen: [1], preise: [2.49] },
        "Milch": { einheit: "L", packungsgroessen: [1, 3], preise: [1.09, 2.79] },
        "Oliven√∂l": { einheit: "L", packungsgroessen: [0.5, 1, 3], preise: [4.99, 8.99, 24.99] },
        "Basilikum": { einheit: "kg", packungsgroessen: [0.05], preise: [6.99] },
        "H√§hnchenbrust": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [8.99, 19.99, 37.99] },
        "Ingwer": { einheit: "kg", packungsgroessen: [0.2, 0.5], preise: [4.49, 9.99] },
        "Kokosmilch": { einheit: "L", packungsgroessen: [0.4, 1], preise: [1.79, 3.99] },
        "Currypaste": { einheit: "kg", packungsgroessen: [0.2, 0.5], preise: [3.99, 8.99] },
        "Reis (als Beilage)": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [1.99, 4.49, 7.99] },
        "Zitronengras": { einheit: "kg", packungsgroessen: [0.1], preise: [9.99] },
        "Koriander": { einheit: "kg", packungsgroessen: [0.05], preise: [7.99] },
        "Limettensaft": { einheit: "L", packungsgroessen: [0.25, 0.5], preise: [2.49, 4.29] },
        "Linsen": { einheit: "kg", packungsgroessen: [0.5, 1, 2.5], preise: [1.79, 3.29, 7.49] },
        "Speck": { einheit: "kg", packungsgroessen: [0.5, 1], preise: [6.99, 12.99] },
        "W√ºrstchen": { einheit: "kg", packungsgroessen: [1, 2.5], preise: [5.99, 13.99] },
        "Essig": { einheit: "L", packungsgroessen: [0.5, 1], preise: [1.29, 2.19] },
        "Erbsen (getrocknet)": { einheit: "kg", packungsgroessen: [0.5, 1, 2.5], preise: [1.99, 3.49, 7.99] },
        "Wei√ükohlk√∂pfe": { einheit: "St√ºck", packungsgroessen: [1], preise: [2.49] },
        "Schweinehackfleisch": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [7.99, 17.99, 34.99] },
        "Sahne": { einheit: "L", packungsgroessen: [0.2, 0.5, 1], preise: [1.49, 2.99, 5.49] },
        "Schweineschnitzel": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [9.99, 22.99, 43.99] },
        "Champignons": { einheit: "kg", packungsgroessen: [0.5, 1], preise: [3.49, 5.99] },
        "Wein (wei√ü)": { einheit: "L", packungsgroessen: [0.75, 1.5], preise: [4.49, 7.99] },
        "Mehl": { einheit: "kg", packungsgroessen: [1, 2.5, 5], preise: [0.69, 1.49, 2.69] },
        "Br√ºhe": { einheit: "L", packungsgroessen: [1, 5], preise: [1.19, 4.49] },
        "Semmelbr√∂sel": { einheit: "kg", packungsgroessen: [0.5, 1], preise: [1.29, 2.19] },
        "Eier": { einheit: "St√ºck", packungsgroessen: [10, 30], preise: [2.49, 6.49] },
        "Senf": { einheit: "kg", packungsgroessen: [0.2, 0.5], preise: [1.49, 2.99] },
        "Thymian": { einheit: "kg", packungsgroessen: [0.05], preise: [6.99] },
        // NEUE PRODUKTE: Getr√§nke und Snacks
        "Getr√§nk (0.5L Flasche)": { einheit: "St√ºck", packungsgroessen: [1, 6, 12, 24], preise: [0.50, 2.50, 4.50, 8.50] },
        "Snack (M√ºsliriegel)": { einheit: "St√ºck", packungsgroessen: [1, 10, 24, 48], preise: [0.80, 6.50, 14.00, 26.00] }
    };

    // Allergene in Wasgau Produkten
    const produktAllergene = {
        "Kartoffelw√ºrfel": [],
        "Raps√∂l": [],
        "Zwiebeln (TK oder frisch)": [],
        "Gem√ºsebr√ºhe": ['G', 'A'],
        "Majoran": [],
        "Salz": [],
        "Pfeffer": [],
        "Kartoffelbreipulver": ['G', 'A'],
        "Muskatnuss": [],
        "Petersilie": [],
        "Gem√ºse-TK (Mirepoix)": [],
        "Rindergulasch": [],
        "Paprikaschoten": [],
        "Tomatenmark": [],
        "Rinderfond": [],
        "Rotwein": ['L'],
        "Paprikapulver": [],
        "K√ºmmel": [],
        "Knoblauch": [],
        "Rinderhackfleisch": [],
        "Kidneybohnen (Dose)": [],
        "Mais (Dose)": [],
        "Tomaten (st√ºckig, Dose)": [],
        "Chilipulver": [],
        "Kreuzk√ºmmel": [],
        "Oregano": [],
        "Rinderbr√ºhe": ['G', 'A'],
        "Karotten": [],
        "Sellerie": ['I'],
        "Milch": ['G'],
        "Oliven√∂l": [],
        "Basilikum": [],
        "H√§hnchenbrust": [],
        "Ingwer": [],
        "Kokosmilch": [],
        "Currypaste": ['F', 'J'],
        "Reis (als Beilage)": [],
        "Zitronengras": [],
        "Koriander": [],
        "Limettensaft": [],
        "Linsen": [],
        "Speck": [],
        "W√ºrstchen": ['G', 'A', 'C'],
        "Essig": [],
        "Erbsen (getrocknet)": [],
        "Wei√ükohlk√∂pfe": [],
        "Schweinehackfleisch": [],
        "Sahne": ['G'],
        "Schweineschnitzel": [],
        "Champignons": [],
        "Wein (wei√ü)": ['L'],
        "Mehl": ['A'],
        "Br√ºhe": ['G', 'A'],
        "Semmelbr√∂sel": ['A', 'C'],
        "Eier": ['C'],
        "Senf": ['J'],
        "Thymian": [],
        // NEUE ALLERGENE: Getr√§nke und Snacks
        "Getr√§nk (0.5L Flasche)": [],
        "Snack (M√ºsliriegel)": ['A', 'G', 'H']
    };

    // =============================================
    // REZEPTE DATENBANK MIT KATEGORIEN
    // =============================================

    const rezepte = {
        // KALTVERPFLEGUNG
        "belegte_broetchen": {
            name: "Belegte Br√∂tchen (gemischte Sorten)",
            kategorie: "kalt",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 90,
            kalorienProPortion: 380,
            portionInfo: "2-3 Br√∂tchen pro Person",
            zutaten: [
                { name: "Br√∂tchen (verschiedene Sorten)", menge: 150, einheit: "St√ºck" },
                { name: "K√§se (verschiedene Sorten)", menge: 7.5, einheit: "kg" },
                { name: "Aufschnitt (verschiedene Sorten)", menge: 7.5, einheit: "kg" },
                { name: "Butter", menge: 2, einheit: "kg" },
                { name: "Frischk√§se", menge: 3, einheit: "kg" },
                { name: "Senf", menge: 0.5, einheit: "kg" },
                { name: "Mayonnaise", menge: 0.5, einheit: "kg" },
                { name: "Salatbl√§tter", menge: 2, einheit: "kg" },
                { name: "Tomaten", menge: 4, einheit: "kg" },
                { name: "Gurken", menge: 3, einheit: "kg" }
            ],
            anleitung: [
                "Br√∂tchen aufschneiden",
                "Mit Butter oder Frischk√§se bestreichen",
                "30% mit K√§se, 30% mit Aufschnitt, 40% mit Aufstrichen belegen",
                "Mit Salat und Gem√ºse garnieren",
                "Portionieren und k√ºhl lagern"
            ]
        },

        "fruehstueckspaket": {
            name: "Komplettes Fr√ºhst√ºck",
            kategorie: "kalt",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 60,
            kalorienProPortion: 450,
            portionInfo: "1 Fr√ºhst√ºcksset pro Person",
            zutaten: [
                { name: "Brot/Br√∂tchen", menge: 100, einheit: "St√ºck" },
                { name: "K√§se", menge: 4, einheit: "kg" },
                { name: "Wurst/Aufschnitt", menge: 4, einheit: "kg" },
                { name: "Butter", menge: 1.5, einheit: "kg" },
                { name: "Marmelade", menge: 2, einheit: "kg" },
                { name: "Honig", menge: 1, einheit: "kg" },
                { name: "Joghurt", menge: 50, einheit: "Becher" },
                { name: "M√ºsli", menge: 5, einheit: "kg" }
            ],
            anleitung: [
                "Brot und Br√∂tchen portionieren",
                "K√§se und Wurst aufschneiden",
                "Butter, Marmelade und Honig in Portionsbeh√§lter f√ºllen",
                "Joghurt mit M√ºsli kombinieren",
                "Alles als Set zusammenstellen"
            ]
        },

        "wraps": {
            name: "Gemischte Wraps",
            kategorie: "kalt",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 75,
            kalorienProPortion: 320,
            portionInfo: "1-2 Wraps pro Person",
            zutaten: [
                { name: "Wrap-Tortillas", menge: 75, einheit: "St√ºck" },
                { name: "H√§hnchenbrust (gekocht)", menge: 6, einheit: "kg" },
                { name: "Frischk√§se", menge: 3, einheit: "kg" },
                { name: "Salatbl√§tter", menge: 2, einheit: "kg" },
                { name: "Tomaten", menge: 4, einheit: "kg" },
                { name: "Gurken", menge: 3, einheit: "kg" },
                { name: "Paprika", menge: 3, einheit: "kg" },
                { name: "Mais", menge: 2, einheit: "kg" },
                { name: "Joghurt-Dip", menge: 2, einheit: "kg" }
            ],
            anleitung: [
                "Tortillas mit Frischk√§se bestreichen",
                "H√§hnchenbrust in Streifen schneiden",
                "Gem√ºse waschen und schneiden",
                "Alles auf die Tortillas verteilen",
                "Wraps einrollen und portionieren"
            ]
        },

        "nudelsalat": {
            name: "Nudelsalat mit Gem√ºse",
            kategorie: "kalt",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 60,
            kalorienProPortion: 280,
            portionInfo: "ca. 200g pro Person",
            zutaten: [
                { name: "Nudeln", menge: 10, einheit: "kg" },
                { name: "Paprika", menge: 3, einheit: "kg" },
                { name: "Gurken", menge: 3, einheit: "kg" },
                { name: "Tomaten", menge: 4, einheit: "kg" },
                { name: "Zwiebeln", menge: 1, einheit: "kg" },
                { name: "Joghurt", menge: 3, einheit: "kg" },
                { name: "Mayonnaise", menge: 1, einheit: "kg" },
                { name: "Essig", menge: 0.3, einheit: "L" },
                { name: "√ñl", menge: 0.5, einheit: "L" },
                { name: "Kr√§uter", menge: 0.1, einheit: "kg" }
            ],
            anleitung: [
                "Nudeln al dente kochen und abk√ºhlen lassen",
                "Gem√ºse waschen und in kleine St√ºcke schneiden",
                "Dressing aus Joghurt, Mayonnaise, Essig und √ñl herstellen",
                "Alles vermengen und mit Kr√§utern abschmecken",
                "Mindestens 1 Stunde durchziehen lassen"
            ]
        },

        "reissalat": {
            name: "Reissalat mediterran",
            kategorie: "kalt",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 70,
            kalorienProPortion: 300,
            portionInfo: "ca. 180g pro Person",
            zutaten: [
                { name: "Reis", menge: 8, einheit: "kg" },
                { name: "Paprika", menge: 3, einheit: "kg" },
                { name: "Zucchini", menge: 3, einheit: "kg" },
                { name: "Mais", menge: 2, einheit: "kg" },
                { name: "Oliven", menge: 1.5, einheit: "kg" },
                { name: "Feta-K√§se", menge: 3, einheit: "kg" },
                { name: "Oliven√∂l", menge: 0.5, einheit: "L" },
                { name: "Zitronensaft", menge: 0.3, einheit: "L" },
                { name: "Kr√§uter", menge: 0.1, einheit: "kg" }
            ],
            anleitung: [
                "Reis kochen und abk√ºhlen lassen",
                "Gem√ºse waschen und w√ºrfeln",
                "Feta-K√§se zerbr√∂ckeln",
                "Dressing aus √ñl, Zitronensaft und Kr√§utern herstellen",
                "Alles vorsichtig vermengen"
            ]
        },

        "frikadellen_br√∂tchen": {
            name: "Frikadellen-/Fleischk√§sbr√∂tchen",
            kategorie: "kalt",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 45,
            kalorienProPortion: 350,
            portionInfo: "1 Br√∂tchen pro Person",
            zutaten: [
                { name: "Br√∂tchen", menge: 50, einheit: "St√ºck" },
                { name: "Frikadellen", menge: 50, einheit: "St√ºck" },
                { name: "Senf", menge: 0.3, einheit: "kg" },
                { name: "Ketchup", menge: 0.3, einheit: "kg" },
                { name: "Salatbl√§tter", menge: 1, einheit: "kg" },
                { name: "Zwiebeln", menge: 1, einheit: "kg" }
            ],
            anleitung: [
                "Br√∂tchen aufschneiden",
                "Mit Senf oder Ketchup bestreichen",
                "Frikadellen/Fleischk√§se auflegen",
                "Mit Salat und Zwiebeln garnieren",
                "Portionieren und verpacken"
            ]
        },
        "Eiersalat": {
            name: "Eiersalat",
            kategorie: "kalt",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 60,
            kalorienProPortion: 320,
            portionInfo: "ca. 200g pro Person",
            zutaten: [
                { name: "Eier", menge: 120, einheit: "St√ºck" },
                { name: "Mayonnaise", menge: 3, einheit: "kg" },
                { name: "Senf", menge: 0.5, einheit: "kg" },
                { name: "Gew√ºrzgurken", menge: 2, einheit: "kg" },
                { name: "Zwiebeln", menge: 1, einheit: "kg" }
            ],
            anleitung: [
                "Eier hart kochen, sch√§len und w√ºrfeln",
                "Gurken und Zwiebeln fein hacken",
                "Alles mit Mayonnaise und Senf vermengen",
                "Mit Salz und Pfeffer abschmecken"
            ]
        },

        // WARMVERPFLEGUNG
        "kartoffelsuppe": {
            name: "Kartoffelsuppe",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 250,
            zubereitungszeit: 90,
            kalorienProPortion: 320,
            portionInfo: "ca. 400ml pro Person",
            zutaten: [
                { name: "Kartoffelw√ºrfel", menge: 30, einheit: "kg" },
                { name: "Raps√∂l", menge: 0.8, einheit: "L" },
                { name: "Zwiebeln (TK oder frisch)", menge: 4, einheit: "kg" },
                { name: "Gem√ºsebr√ºhe", menge: 30, einheit: "L" },
                { name: "Majoran", menge: 0.05, einheit: "kg" },
                { name: "Salz", menge: 0.1, einheit: "kg" },
                { name: "Pfeffer", menge: 0.025, einheit: "kg" }
            ],
            anleitung: [
                "Zwiebeln in Raps√∂l glasig d√ºnsten",
                "Kartoffelw√ºrfel hinzuf√ºgen und kurz mitd√ºnsten",
                "Mit Gem√ºsebr√ºhe abl√∂schen und 20 Minuten k√∂cheln lassen",
                "Majoran, Salz und Pfeffer hinzuf√ºgen",
                "Nochmals 10 Minuten k√∂cheln lassen",
                "Abschmecken und hei√ü servieren",
                "Portionierung: ca. 400ml pro Person in Sch√ºsseln servieren"
            ]
        },
        "gulasch": {
            name: "Gulasch",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 250,
            zubereitungszeit: 210,
            kalorienProPortion: 480,
            portionInfo: "ca. 350g pro Person",
            zutaten: [
                { name: "Rindergulasch", menge: 30, einheit: "kg" },
                { name: "Zwiebeln (TK oder frisch)", menge: 10, einheit: "kg" },
                { name: "Tomatenmark", menge: 1.5, einheit: "kg" },
                { name: "Rinderfond", menge: 25, einheit: "L" },
                { name: "Paprikapulver", menge: 0.2, einheit: "kg" },
                { name: "Salz", menge: 0.08, einheit: "kg" },
                { name: "Pfeffer", menge: 0.02, einheit: "kg" }
            ],
            anleitung: [
                "Zwiebeln in √ñl goldbraun anbraten",
                "Rindergulasch portionsweise scharf anbraten",
                "Tomatenmark zugeben und mitbraten",
                "Mit Rinderfond abl√∂schen",
                "Paprikapulver, Salz und Pfeffer hinzuf√ºgen",
                "2-3 Stunden bei niedriger Hitze schmoren lassen",
                "Vor dem Servieren abschmecken",
                "Portionierung: ca. 350g pro Person mit Beilage servieren"
            ]
        },
        "gemueseeintopf": {
            name: "Gem√ºseeintopf",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 250,
            zubereitungszeit: 120,
            kalorienProPortion: 290,
            portionInfo: "ca. 450ml pro Person",
            zutaten: [
                { name: "Kartoffelw√ºrfel", menge: 15, einheit: "kg" },
                { name: "M√∂hren", menge: 10, einheit: "kg" },
                { name: "Lauch", menge: 8, einheit: "kg" },
                { name: "Zwiebeln (TK oder frisch)", menge: 4, einheit: "kg" },
                { name: "Wei√ükohl", menge: 12, einheit: "kg" },
                { name: "Gem√ºsebr√ºhe", menge: 35, einheit: "L" },
                { name: "Majoran", menge: 0.04, einheit: "kg" }
            ],
            anleitung: [
                "Gem√ºse waschen und in St√ºcke schneiden",
                "Zwiebeln in Butter and√ºnsten",
                "Gem√ºse zugeben und kurz mitd√ºnsten",
                "Mit Gem√ºsebr√ºhe abl√∂schen",
                "30-40 Minuten k√∂cheln lassen",
                "Mit Kr√§utern, Salz und Pfeffer abschmecken",
                "Hei√ü mit Brot servieren",
                "Portionierung: ca. 450ml pro Person in Sch√ºsseln servieren"
            ]
        },
        "nudelauflauf": {
            name: "Nudelauflauf mit K√§se",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 75,
            kalorienProPortion: 450,
            portionInfo: "ca. 300g pro Person",
            zutaten: [
                { name: "Nudeln", menge: 15, einheit: "kg" },
                { name: "K√§se (gerieben)", menge: 6, einheit: "kg" },
                { name: "Sahne", menge: 5, einheit: "L" },
                { name: "Eier", menge: 60, einheit: "St√ºck" },
                { name: "Butter", menge: 1, einheit: "kg" }
            ],
            anleitung: [
                "Nudeln al dente kochen",
                "Mit Sahne, Eiern und K√§se vermengen",
                "In Auflaufformen geben",
                "Bei 200¬∞C 30 Minuten backen",
                "Goldbraun servieren"
            ]
        },
        "chili_con_carne": {
            name: "Chili con Carne",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 120,
            kalorienProPortion: 520,
            portionInfo: "ca. 350g pro Person",
            zutaten: [
                { name: "Hackfleisch", menge: 12, einheit: "kg" },
                { name: "Kidneybohnen", menge: 8, einheit: "kg" },
                { name: "Mais", menge: 4, einheit: "kg" },
                { name: "Tomaten (Dose)", menge: 10, einheit: "kg" },
                { name: "Zwiebeln", menge: 3, einheit: "kg" },
                { name: "Chilipulver", menge: 0.1, einheit: "kg" }
            ],
            anleitung: [
                "Zwiebeln und Hackfleisch anbraten",
                "Tomaten, Bohnen und Mais zugeben",
                "Mit Gew√ºrzen abschmecken",
                "45 Minuten k√∂cheln lassen",
                "Mit Reis servieren"
            ]
        },
        "linseneintopf": {
            name: "Linseneintopf",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 90,
            kalorienProPortion: 380,
            portionInfo: "ca. 400g pro Person",
            zutaten: [
                { name: "Linsen", menge: 10, einheit: "kg" },
                { name: "Kartoffeln", menge: 8, einheit: "kg" },
                { name: "M√∂hren", menge: 5, einheit: "kg" },
                { name: "Zwiebeln", menge: 2, einheit: "kg" },
                { name: "Gem√ºsebr√ºhe", menge: 20, einheit: "L" }
            ],
            anleitung: [
                "Linsen waschen",
                "Gem√ºse schneiden und anbraten",
                "Mit Br√ºhe abl√∂schen",
                "45 Minuten k√∂cheln lassen",
                "Mit W√ºrstchen servieren"
            ]
        },

        "haehnchengeschnetzeltes": {
            name: "H√§hnchengeschnetzeltes mit Reis oder Nudeln",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 45,
            kalorienProPortion: 480,
            portionInfo: "ca. 300g Geschnetzeltes + 150g Beilage pro Person",
            zutaten: [
                { name: "H√§hnchenbrust", menge: 15, einheit: "kg" },
                { name: "Sahne", menge: 5, einheit: "L" },
                { name: "Zwiebeln", menge: 2, einheit: "kg" },
                { name: "Paprika", menge: 3, einheit: "kg" },
                { name: "Pilze", menge: 3, einheit: "kg" },
                { name: "Wei√üwein", menge: 1, einheit: "L" },
                { name: "Br√ºhe", menge: 2, einheit: "L" },
                { name: "Mehl", menge: 0.3, einheit: "kg" },
                { name: "Butter", menge: 0.5, einheit: "kg" },
                { name: "Reis oder Nudeln", menge: 7.5, einheit: "kg" }
            ],
            anleitung: [
                "H√§hnchenbrust in Streifen schneiden",
                "Zwiebeln und Paprika w√ºrfeln, Pilze schneiden",
                "H√§hnchen in Butter anbraten, herausnehmen",
                "Gem√ºse anbraten, mit Mehl best√§uben",
                "Mit Wein und Br√ºhe abl√∂schen, Sahne zugeben",
                "H√§hnchen wieder zugeben, 10 Minuten k√∂cheln",
                "Reis oder Nudeln parallel kochen"
            ]
        },

        "gulasch_kartoffeln": {
            name: "Gulasch mit Kartoffeln",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 120,
            kalorienProPortion: 520,
            portionInfo: "ca. 350g pro Person",
            zutaten: [
                { name: "Rindergulasch", menge: 20, einheit: "kg" },
                { name: "Kartoffeln", menge: 15, einheit: "kg" },
                { name: "Zwiebeln", menge: 3, einheit: "kg" },
                { name: "Paprikaschoten", menge: 2, einheit: "kg" },
                { name: "Tomatenmark", menge: 0.5, einheit: "kg" },
                { name: "Rotwein", menge: 1, einheit: "L" },
                { name: "Rinderfond", menge: 3, einheit: "L" },
                { name: "Paprikapulver", menge: 0.05, einheit: "kg" },
                { name: "Majoran", menge: 0.02, einheit: "kg" }
            ],
            anleitung: [
                "Zwiebeln w√ºrfeln und goldbraun anbraten",
                "Rindergulasch portionsweise scharf anbraten",
                "Tomatenmark zugeben und mitbraten",
                "Mit Rotwein und Fond abl√∂schen",
                "Gew√ºrze zugeben, 1,5 Stunden schmoren",
                "Kartoffeln sch√§len und kochen",
                "Vor dem Servieren abschmecken"
            ]
        },

        "gemueseeintopf_wuerstchen": {
            name: "Gem√ºseeintopf mit W√ºrstchen & Brot",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 90,
            kalorienProPortion: 420,
            portionInfo: "ca. 400ml Eintopf + 1 W√ºrstchen + Brot pro Person",
            zutaten: [
                { name: "Kartoffeln", menge: 12, einheit: "kg" },
                { name: "M√∂hren", menge: 5, einheit: "kg" },
                { name: "Lauch", menge: 4, einheit: "kg" },
                { name: "Sellerie", menge: 2, einheit: "kg" },
                { name: "W√ºrstchen", menge: 50, einheit: "St√ºck" },
                { name: "Br√ºhe", menge: 20, einheit: "L" },
                { name: "Majoran", menge: 0.03, einheit: "kg" },
                { name: "Brot", menge: 50, einheit: "St√ºck" }
            ],
            anleitung: [
                "Gem√ºse waschen und in St√ºcke schneiden",
                "Kartoffeln und M√∂hren in Br√ºhe 20 Minuten kochen",
                "Lauch und Sellerie zugeben, weitere 15 Minuten kochen",
                "W√ºrstchen in Scheiben schneiden und 5 Minuten mitgaren",
                "Mit Kr√§utern abschmecken",
                "Mit frischem Brot servieren"
            ]
        },

        "fischfilet_gratin": {
            name: "Fischfilet mit Kartoffelgratin & Rahmgem√ºse",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 75,
            kalorienProPortion: 480,
            portionInfo: "1 Fischfilet + 200g Gratin + 150g Gem√ºse pro Person",
            zutaten: [
                { name: "Fischfilet (Seelachs/Kabeljau)", menge: 12.5, einheit: "kg" },
                { name: "Kartoffeln", menge: 15, einheit: "kg" },
                { name: "Sahne", menge: 4, einheit: "L" },
                { name: "K√§se (gerieben)", menge: 3, einheit: "kg" },
                { name: "Brokkoli", menge: 8, einheit: "kg" },
                { name: "M√∂hren", menge: 5, einheit: "kg" },
                { name: "Zitronen", menge: 5, einheit: "St√ºck" },
                { name: "Butter", menge: 0.5, einheit: "kg" },
                { name: "Muskatnuss", menge: 0.01, einheit: "kg" }
            ],
            anleitung: [
                "Kartoffeln sch√§len, in Scheiben schneiden",
                "Mit Sahne, K√§se und Muskat in Gratinform schichten",
                "Bei 200¬∞C 40 Minuten backen",
                "Fischfilets mit Zitrone betr√§ufeln, d√§mpfen",
                "Gem√ºse d√§mpfen und mit Butter verfeinern"
            ]
        },

        "putenbrustfilet": {
            name: "Putenbrustfilet mit Kr√§utersauce, Reis-Pilaw & Brokkoli",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 60,
            kalorienProPortion: 460,
            portionInfo: "1 Filet + 150g Reis + 150g Gem√ºse pro Person",
            zutaten: [
                { name: "Putenbrustfilet", menge: 15, einheit: "kg" },
                { name: "Reis", menge: 7.5, einheit: "kg" },
                { name: "Brokkoli", menge: 7.5, einheit: "kg" },
                { name: "Sahne", menge: 3, einheit: "L" },
                { name: "Wei√üwein", menge: 0.5, einheit: "L" },
                { name: "Zwiebeln", menge: 1, einheit: "kg" },
                { name: "Kr√§uter (frisch)", menge: 0.2, einheit: "kg" },
                { name: "Br√ºhe", menge: 15, einheit: "L" }
            ],
            anleitung: [
                "Putenbrustfilets salzen und pfeffern",
                "In hei√üer Pfanne von beiden Seiten anbraten",
                "Sauce aus Sahne, Wein und Kr√§utern zubereiten",
                "Reis in Br√ºhe als Pilaw kochen",
                "Brokkoli d√§mpfen",
                "Filets in Sauce 10 Minuten ziehen lassen"
            ]
        },

        "schweinefilet_medaillons": {
            name: "Schweinefiletmedaillons mit Champignonrahm, Kartoffelgratin & gr√ºner Salat",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 80,
            kalorienProPortion: 520,
            portionInfo: "2-3 Medaillons + 200g Gratin + Salat pro Person",
            zutaten: [
                { name: "Schweinefilet", menge: 12.5, einheit: "kg" },
                { name: "Kartoffeln", menge: 15, einheit: "kg" },
                { name: "Champignons", menge: 5, einheit: "kg" },
                { name: "Sahne", menge: 4, einheit: "L" },
                { name: "Wei√üwein", menge: 0.5, einheit: "L" },
                { name: "Salat (gemischt)", menge: 5, einheit: "kg" },
                { name: "Tomaten", menge: 3, einheit: "kg" },
                { name: "Gurken", menge: 3, einheit: "kg" },
                { name: "Dressing", menge: 2, einheit: "L" }
            ],
            anleitung: [
                "Schweinefilet in Medaillons schneiden",
                "Kartoffelgratin wie bei Fischfilet zubereiten",
                "Champignons in Scheiben schneiden, in Sahne und Wein d√ºnsten",
                "Medaillons in Pfanne braten, Sauce zugeben",
                "Salat waschen, mit Dressing anmachen"
            ]
        },

        "kichererbsen_curry": {
            name: "Vegetarisches Kichererbsen-Gem√ºsecurry mit Basmatireis",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 50,
            kalorienProPortion: 420,
            portionInfo: "ca. 300g Curry + 150g Reis pro Person",
            zutaten: [
                { name: "Kichererbsen (Dose)", menge: 10, einheit: "kg" },
                { name: "Basmatireis", menge: 7.5, einheit: "kg" },
                { name: "Kokosmilch", menge: 6, einheit: "L" },
                { name: "Zwiebeln", menge: 2, einheit: "kg" },
                { name: "Paprika", menge: 4, einheit: "kg" },
                { name: "Zucchini", menge: 4, einheit: "kg" },
                { name: "Currypaste", menge: 0.3, einheit: "kg" },
                { name: "Ingwer", menge: 0.2, einheit: "kg" },
                { name: "Knoblauch", menge: 0.1, einheit: "kg" }
            ],
            anleitung: [
                "Zwiebeln, Ingwer, Knoblauch fein hacken",
                "In √ñl anbraten, Currypaste zugeben",
                "Gem√ºse w√ºrfeln, zugeben und mitd√ºnsten",
                "Kokosmilch und Kichererbsen zugeben",
                "20 Minuten k√∂cheln lassen",
                "Basmatireis parallel kochen"
            ]
        },

        "fischrahm_lasagne": {
            name: "Fischrahm-Lasagne mit Gem√ºse-Beilage",
            kategorie: "warm",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 90,
            kalorienProPortion: 480,
            portionInfo: "1 Portion Lasagne + 150g Gem√ºse pro Person",
            zutaten: [
                { name: "Fischfilet (Lachs/Seelachs)", menge: 10, einheit: "kg" },
                { name: "Lasagnebl√§tter", menge: 2, einheit: "kg" },
                { name: "Sahne", menge: 4, einheit: "L" },
                { name: "K√§se (gerieben)", menge: 3, einheit: "kg" },
                { name: "Spinat", menge: 6, einheit: "kg" },
                { name: "Zucchini", menge: 5, einheit: "kg" },
                { name: "M√∂hren", menge: 5, einheit: "kg" },
                { name: "Zwiebeln", menge: 1, einheit: "kg" },
                { name: "Wei√üwein", menge: 0.5, einheit: "L" }
            ],
            anleitung: [
                "Fisch in St√ºcke schneiden",
                "Sahnesauce mit Wein und K√§se zubereiten",
                "Lasagne schichten: Sauce - Bl√§tter - Fisch - Spinat",
                "Bei 180¬∞C 45 Minuten backen",
                "Gem√ºse d√§mpfen oder braten"
            ]
        },
        "linsen_gemueseeintopf": {
            name: "Linsen-Gem√ºseeintopf mit dunklem Brot",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 70,
            kalorienProPortion: 380,
            portionInfo: "ca. 400ml Eintopf + Brot pro Person",
            zutaten: [
                { name: "Linsen", menge: 8, einheit: "kg" },
                { name: "Kartoffeln", menge: 10, einheit: "kg" },
                { name: "M√∂hren", menge: 5, einheit: "kg" },
                { name: "Sellerie", menge: 2, einheit: "kg" },
                { name: "Zwiebeln", menge: 2, einheit: "kg" },
                { name: "Tomaten (st√ºckig)", menge: 4, einheit: "kg" },
                { name: "Gem√ºsebr√ºhe", menge: 20, einheit: "L" },
                { name: "Dunkles Brot", menge: 50, einheit: "St√ºck" },
                { name: "Majoran", menge: 0.03, einheit: "kg" }
            ],
            anleitung: [
                "Zwiebeln und Sellerie w√ºrfeln, anbraten",
                "Linsen waschen, mit Gem√ºsebr√ºhe aufgie√üen",
                "Kartoffeln und M√∂hren w√ºrfeln, zugeben",
                "30 Minuten k√∂cheln lassen",
                "Tomaten und Gew√ºrze zugeben, weitere 15 Minuten kochen",
                "Mit frischem Brot servieren"
            ]
        },
        "suesskartoffel_auflauf": {
            name: "S√º√ükartoffel-Kichererbsen-Auflauf mit Feta",
            kategorie: "warm",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 65,
            kalorienProPortion: 440,
            portionInfo: "ca. 300g Auflauf pro Person",
            zutaten: [
                { name: "S√º√ükartoffeln", menge: 15, einheit: "kg" },
                { name: "Kichererbsen (Dose)", menge: 8, einheit: "kg" },
                { name: "Feta-K√§se", menge: 4, einheit: "kg" },
                { name: "Zwiebeln", menge: 2, einheit: "kg" },
                { name: "Paprika", menge: 3, einheit: "kg" },
                { name: "Sahne", menge: 3, einheit: "L" },
                { name: "Eier", menge: 20, einheit: "St√ºck" },
                { name: "Oliven√∂l", menge: 0.3, einheit: "L" },
                { name: "Kr√§uter der Provence", menge: 0.05, einheit: "kg" }
            ],
            anleitung: [
                "S√º√ükartoffeln sch√§len, in Scheiben schneiden",
                "Zwiebeln und Paprika w√ºrfeln",
                "Alles mit Kichererbsen mischen",
                "In Auflaufform geben",
                "Sahne mit Eiern verquirlen, dar√ºber gie√üen",
                "Mit Feta bestreuen, bei 180¬∞C 40 Minuten backen"
            ]
        },

        // LUNCHPAKETE
        "lunchpaket_a": {
            name: "Lunchpaket A ‚Äì Klassiker",
            kategorie: "lunch",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 45,
            kalorienProPortion: 650,
            portionInfo: "1 komplettes Paket pro Person",
            zutaten: [
                { name: "Vollkornbr√∂tchen", menge: 50, einheit: "St√ºck" },
                { name: "Vollkornbrot (klein)", menge: 50, einheit: "St√ºck" },
                { name: "K√§se", menge: 4, einheit: "kg" },
                { name: "Leberwurst/vegetarische Alternative", menge: 4, einheit: "kg" },
                { name: "√Ñpfel", menge: 50, einheit: "St√ºck" },
                { name: "M√ºsliriegel", menge: 50, einheit: "St√ºck" },
                { name: "Trinkwasser (0,5L)", menge: 25, einheit: "L" },
                { name: "N√ºsse (Mandeln)", menge: 5, einheit: "kg" }
            ],
            anleitung: [
                "Br√∂tchen und Brote belegen",
                "Alle Komponenten einzeln verpacken",
                "In Luncht√ºten portionieren",
                "K√ºhl lagern bis zur Ausgabe"
            ]
        },

        "lunchpaket_b": {
            name: "Lunchpaket B ‚Äì Leichter & vegetarisch",
            kategorie: "lunch",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 60,
            kalorienProPortion: 580,
            portionInfo: "1 komplettes Paket pro Person",
            zutaten: [
                { name: "Wrap-Tortillas", menge: 50, einheit: "St√ºck" },
                { name: "Frischk√§se", menge: 4, einheit: "kg" },
                { name: "Gurken", menge: 4, einheit: "kg" },
                { name: "Tomaten", menge: 5, einheit: "kg" },
                { name: "Salatbl√§tter", menge: 2, einheit: "kg" },
                { name: "Couscous", menge: 5, einheit: "kg" },
                { name: "Bananen", menge: 50, einheit: "St√ºck" },
                { name: "Joghurt (klein)", menge: 50, einheit: "Becher" },
                { name: "Getr√§nk (Saftschorle)", menge: 25, einheit: "L" },
                { name: "Dunkle Schokolade", menge: 1, einheit: "kg" }
            ],
            anleitung: [
                "Wraps mit Frischk√§se und Gem√ºse f√ºllen",
                "Couscous-Salat zubereiten und portionieren",
                "Alle Komponenten verpacken",
                "K√ºhl halten"
            ]
        },

        "lunchpaket_c": {
            name: "Lunchpaket C ‚Äì S√§ttigend f√ºr Mittagszeit",
            kategorie: "lunch",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 75,
            kalorienProPortion: 720,
            portionInfo: "1 komplettes Paket pro Person",
            zutaten: [
                { name: "Nudelsalat", menge: 15, einheit: "kg" },
                { name: "Vollkornbr√∂tchen", menge: 50, einheit: "St√ºck" },
                { name: "Putenbrust/vegetarische Wurst", menge: 5, einheit: "kg" },
                { name: "Orangen/Mandarinen", menge: 50, einheit: "St√ºck" },
                { name: "Trinkwasser (0,5L)", menge: 25, einheit: "L" },
                { name: "M√ºsliriegel/Geb√§ck", menge: 50, einheit: "St√ºck" }
            ],
            anleitung: [
                "Nudelsalat mit Gem√ºse und K√§se zubereiten",
                "Br√∂tchen belegen",
                "Alles portionieren und verpacken",
                "Gek√ºhlt lagern"
            ]
        },

        "lunchpaket_d": {
            name: "Lunchpaket D ‚Äì Vegan / allergikerfreundlich",
            kategorie: "lunch",
            vegetarisch: true,
            vegan: true,
            basisPortionen: 50,
            zubereitungszeit: 60,
            kalorienProPortion: 520,
            portionInfo: "1 komplettes Paket pro Person",
            zutaten: [
                { name: "Vollkorn-Wraps", menge: 50, einheit: "St√ºck" },
                { name: "Hummus", menge: 5, einheit: "kg" },
                { name: "Rote Beete", menge: 4, einheit: "kg" },
                { name: "Rucola", menge: 2, einheit: "kg" },
                { name: "Rohkoststicks (Karotte, Gurke, Paprika)", menge: 8, einheit: "kg" },
                { name: "Veganer Dip", menge: 3, einheit: "kg" },
                { name: "√Ñpfel/Birnen", menge: 50, einheit: "St√ºck" },
                { name: "Wasser/Kr√§utertee", menge: 25, einheit: "L" },
                { name: "Vegane Riegel", menge: 50, einheit: "St√ºck" }
            ],
            anleitung: [
                "Wraps mit Hummus und Gem√ºse f√ºllen",
                "Rohkost waschen und schneiden",
                "Dips portionieren",
                "Alles zusammenstellen"
            ]
        },

        "lunchpaket_e": {
            name: "Lunchpaket E ‚Äì Fr√ºhst√ºcks-/Sp√§tschichtpaket",
            kategorie: "lunch",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 90,
            kalorienProPortion: 680,
            portionInfo: "1 komplettes Paket pro Person",
            zutaten: [
                { name: "Vollkornbr√∂tchen", menge: 100, einheit: "St√ºck" },
                { name: "K√§se", menge: 4, einheit: "kg" },
                { name: "Schinken", menge: 4, einheit: "kg" },
                { name: "Eier", menge: 50, einheit: "St√ºck" },
                { name: "Joghurt/pflanzliche Alternative", menge: 50, einheit: "Becher" },
                { name: "Bananen", menge: 50, einheit: "St√ºck" },
                { name: "Getr√§nk", menge: 25, einheit: "L" },
                { name: "Keks/Kuchen", menge: 50, einheit: "St√ºck" }
            ],
            anleitung: [
                "Eier hart kochen",
                "Br√∂tchen belegen",
                "Alle Komponenten verpacken",
                "K√ºhl halten"
            ]
        },

        "lunchpaket_f": {
            name: "Lunchpaket F ‚Äì Energie & Ausdauer",
            kategorie: "lunch",
            vegetarisch: false,
            basisPortionen: 50,
            zubereitungszeit: 120,
            kalorienProPortion: 850,
            portionInfo: "1 gro√ües Paket pro Person",
            zutaten: [
                { name: "Vollkornbr√∂tchen", menge: 50, einheit: "St√ºck" },
                { name: "Putenbrust", menge: 6, einheit: "kg" },
                { name: "Nudelsalat", menge: 10, einheit: "kg" },
                { name: "Eier", menge: 50, einheit: "St√ºck" },
                { name: "√Ñpfel/Orangen", menge: 50, einheit: "St√ºck" },
                { name: "M√ºsliriegel", menge: 50, einheit: "St√ºck" },
                { name: "Vollkornbrot", menge: 50, einheit: "St√ºck" },
                { name: "K√§se", menge: 4, einheit: "kg" },
                { name: "Getr√§nk", menge: 25, einheit: "L" }
            ],
            anleitung: [
                "Eier hart kochen",
                "Br√∂tchen und Brote belegen",
                "Nudelsalat zubereiten",
                "Alles portionieren und verpacken",
                "F√ºr anstrengende Eins√§tze zusammenstellen"
            ]
        },

        "lunchpaket_g": {
            name: "Lunchpaket G ‚Äì Vegetarisch & langer Tag",
            kategorie: "lunch",
            vegetarisch: true,
            basisPortionen: 50,
            zubereitungszeit: 80,
            kalorienProPortion: 720,
            portionInfo: "1 komplettes Paket pro Person",
            zutaten: [
                { name: "Vollkorn-Wraps", menge: 50, einheit: "St√ºck" },
                { name: "Hummus", menge: 5, einheit: "kg" },
                { name: "Rote Beete", menge: 4, einheit: "kg" },
                { name: "Karotten", menge: 3, einheit: "kg" },
                { name: "Couscous-Salat", menge: 8, einheit: "kg" },
                { name: "Kichererbsen", menge: 4, einheit: "kg" },
                { name: "Bananen", menge: 50, einheit: "St√ºck" },
                { name: "N√ºsse & Trockenfr√ºchte", menge: 8, einheit: "kg" },
                { name: "Getr√§nk", menge: 25, einheit: "L" }
            ],
            anleitung: [
                "Wraps f√ºllen und einrollen",
                "Couscous-Salat mit Kichererbsen zubereiten",
                "Snackbeutel mit N√ºssen portionieren",
                "Alles zusammenstellen"
            ]
        }
    };

    // =============================================
    // GETR√ÑNKE UND SNACKS PRO PERSON
    // =============================================

    const zusaetzlicheProdukte = [
        { name: "Getr√§nk (0.5L Flasche)", menge: 2, einheit: "St√ºck" }, // 2 Flaschen pro Person
        { name: "Snack (M√ºsliriegel)", menge: 1, einheit: "St√ºck" }     // 1 Snack pro Person
    ];

    // =============================================
    // GLOBALE VARIABLEN F√úR DIE AUSWAHL
    // =============================================

    let aktuellesRezept = null;
    let aktuelleKategorie = null;

    // =============================================
    // FUNKTIONEN F√úR DIE REZEPTAUSWAHL
    // =============================================

    function filterRezepte(kategorie) {
        const checkbox = document.getElementById(`${kategorie}-vegetarisch`);
        const select = document.getElementById(`${kategorie}-rezept`);
        const nurVegetarisch = checkbox.checked;
        
        // Select leeren
        select.innerHTML = '';
        
        // Default-Option hinzuf√ºgen
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = '-- Bitte Rezept ausw√§hlen --';
        defaultOption.disabled = true;
        defaultOption.selected = true;
        select.appendChild(defaultOption);
        
        // Rezepte filtern und hinzuf√ºgen
        Object.entries(rezepte).forEach(([key, rezept]) => {
            if (rezept.kategorie === kategorie && (!nurVegetarisch || rezept.vegetarisch)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = rezept.name;
                select.appendChild(option);
            }
        });
    }

    function updateAktivesRezept(kategorie) {
        const select = document.getElementById(`${kategorie}-rezept`);
        const rezeptName = select.value;
        
        if (rezeptName) {
            aktuellesRezept = rezeptName;
            aktuelleKategorie = kategorie;
            
            // Andere Kategorien zur√ºcksetzen
            const andereKategorien = ['kalt', 'warm', 'lunch'].filter(k => k !== kategorie);
            andereKategorien.forEach(k => {
                document.getElementById(`${k}-rezept`).value = '';
            });
        }
    }

    function getAktuellesRezept() {
        // Pr√ºfe alle Kategorien, welches Rezept ausgew√§hlt ist
        const kategorien = ['kalt', 'warm', 'lunch'];
        
        for (const kategorie of kategorien) {
            const select = document.getElementById(`${kategorie}-rezept`);
            if (select && select.value) {
                return select.value;
            }
        }
        
        return aktuellesRezept; // Fallback auf globale Variable
    }

    // =============================================
    // ALLERGEN-MANAGEMENT FUNKTIONEN
    // =============================================

    function getRezeptAllergene(rezeptName) {
        const rezept = rezepte[rezeptName];
        if (!rezept) return [];
        
        const rezeptAllergene = new Set();
        
        rezept.zutaten.forEach(zutat => {
            const zutatAllergene = produktAllergene[zutat.name] || [];
            zutatAllergene.forEach(allergen => rezeptAllergene.add(allergen));
        });
        
        return Array.from(rezeptAllergene);
    }

    const AllergenManager = {
        getAlleRezeptAllergene(rezeptName) {
            return getRezeptAllergene(rezeptName);
        },

        erstelleAllergenBadges(allergenCodes) {
            if (!allergenCodes || allergenCodes.length === 0) {
                return '<span class="allergen-badge allergen-mild">Allergenfrei</span>';
            }
            
            return allergenCodes.map(code => {
                const allergen = allergene[code];
                const kritikalitaetClass = `allergen-${allergen.kritikalitaet === 'hoch' ? 'critical' : 
                                          allergen.kritikalitaet === 'mittel' ? 'moderate' : 'mild'}`;
                return `<span class="allergen-badge ${kritikalitaetClass}" title="${allergen.name}">${allergen.icon} ${code}</span>`;
            }).join(' ');
        },

        zeigeRezeptAllergene(rezeptName) {
            const rezeptAllergene = this.getAlleRezeptAllergene(rezeptName);
            const container = document.getElementById('allergen-anzeige');
            const infoBox = document.getElementById('allergene-info-box');
            
            if (rezeptAllergene.length === 0) {
                container.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="color: #4CAF50; font-size: 1.2em;">‚úÖ</span>
                        <div>
                            <strong>Dieses Rezept ist allergenfrei</strong>
                            <p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;">
                                Enth√§lt keine der 14 Hauptallergene gem√§√ü LMIV
                            </p>
                        </div>
                    </div>
                `;
            } else {
                const allergenListe = rezeptAllergene.map(code => {
                    const allergen = allergene[code];
                    return `<div class="allergen-item-compact">
                        <span class="allergen-badge allergen-${allergen.kritikalitaet === 'hoch' ? 'critical' : 'moderate'}" 
                              style="margin-right: 8px;">${allergen.icon} ${code}</span>
                        ${allergen.name}
                    </div>`;
                }).join('');
                
                container.innerHTML = `
                    <div style="margin-bottom: 10px;">
                        <strong>Enthaltene Allergene:</strong>
                    </div>
                    <div class="allergen-grid-compact">
                        ${allergenListe}
                    </div>
                `;
            }
            
            infoBox.style.display = 'block';
        }
    };

    // =============================================
    // EQUIPMENT MANAGEMENT SYSTEM MIT CLOUD SYNC
    // =============================================

    const EquipmentManager = {
        gwBeladung: JSON.parse(localStorage.getItem('equipment_gw')) || [],
        kvLager: JSON.parse(localStorage.getItem('equipment_kv_lager')) || [],

        hikGWDefault: [
            { name: "Kochtopf 100L", menge: 2, kategorie: "Kochausr√ºstung", notizen: "Hauptkochtopf" },
            { name: "Kochtopf 60L", menge: 1, kategorie: "Kochausr√ºstung", notizen: "Zwischengr√∂√üe" },
            { name: "Kochtopf 30L", menge: 1, kategorie: "Kochausr√ºstung", notizen: "F√ºr So√üen" },
            { name: "Gasbrenner 15kW", menge: 4, kategorie: "Brenner & Energie", notizen: "Hauptbrenner" },
            { name: "Reservegasflasche", menge: 6, kategorie: "Brenner & Energie", notizen: "11kg Propan" },
            { name: "Feldkochgeschirr", menge: 300, kategorie: "Geschirr", notizen: "F√ºr 300 Personen" },
            { name: "Besteck-Sets", menge: 300, kategorie: "Besteck", notizen: "Messer, Gabel, L√∂ffel" },
            { name: "Becher", menge: 300, kategorie: "Geschirr", notizen: "300ml Trinkbecher" },
            { name: "Schneidbretter gro√ü", menge: 4, kategorie: "K√ºchenger√§te", notizen: "Kunststoff" },
            { name: "Kochl√∂ffel", menge: 6, kategorie: "K√ºchenger√§te", notizen: "Verschiedene Gr√∂√üen" },
            { name: "Sch√∂pfkellen", menge: 4, kategorie: "K√ºchenger√§te", notizen: "Ausgabe" },
            { name: "K√ºchenmesser", menge: 6, kategorie: "K√ºchenger√§te", notizen: "Chefmesser + Gem√ºsemesser" },
            { name: "Gem√ºsesch√§ler", menge: 4, kategorie: "K√ºchenger√§te", notizen: "Standard" },
            { name: "K√ºchenwaage", menge: 2, kategorie: "K√ºchenger√§te", notizen: "Bis 10kg" },
            { name: "Sp√ºlmittel", menge: 4, kategorie: "Reinigung", notizen: "Konzentrat" },
            { name: "Schw√§mme", menge: 12, kategorie: "Reinigung", notizen: "Sp√ºlschw√§mme" },
            { name: "Handt√ºcher", menge: 8, kategorie: "Reinigung", notizen: "K√ºchenhandt√ºcher" },
            { name: "Arbeitshandschuhe", menge: 12, kategorie: "Schutzausr√ºstung", notizen: "Hitze best√§ndig" },
            { name: "Sch√ºrzen", menge: 6, kategorie: "Schutzausr√ºstung", notizen: "K√ºchensch√ºrzen" },
            { name: "Wasserkanister 20L", menge: 4, kategorie: "Wasseraufbereitung", notizen: "Trinkwasser" }
        ],

        hikKVLagerDefault: [
            { name: "Kochtopf 100L", menge: 4, kategorie: "Kochausr√ºstung", notizen: "Hauptkochtopf - Lagervorrat" },
            { name: "Kochtopf 60L", menge: 2, kategorie: "Kochausr√ºstung", notizen: "Zwischengr√∂√üe - Lagervorrat" },
            { name: "Kochtopf 30L", menge: 3, kategorie: "Kochausr√ºstung", notizen: "F√ºr So√üen - Lagervorrat" },
            { name: "Gasbrenner 15kW", menge: 8, kategorie: "Brenner & Energie", notizen: "Hauptbrenner - Lagervorrat" },
            { name: "Reservegasflasche", menge: 12, kategorie: "Brenner & Energie", notizen: "11kg Propan - Lagervorrat" },
            { name: "Feldkochgeschirr", menge: 600, kategorie: "Geschirr", notizen: "F√ºr 600 Personen - Lagervorrat" },
            { name: "Besteck-Sets", menge: 600, kategorie: "Besteck", notizen: "Messer, Gabel, L√∂ffel - Lagervorrat" },
            { name: "Becher", menge: 600, kategorie: "Geschirr", notizen: "300ml Trinkbecher - Lagervorrat" },
            { name: "Schneidbretter gro√ü", menge: 8, kategorie: "K√ºchenger√§te", notizen: "Kunststoff - Lagervorrat" },
            { name: "Kochl√∂ffel", menge: 12, kategorie: "K√ºchenger√§te", notizen: "Verschiedene Gr√∂√üen - Lagervorrat" },
            { name: "Sch√∂pfkellen", menge: 8, kategorie: "K√ºchenger√§te", notizen: "Ausgabe - Lagervorrat" },
            { name: "K√ºchenmesser", menge: 12, kategorie: "K√ºchenger√§te", notizen: "Chefmesser + Gem√ºsemesser - Lagervorrat" },
            { name: "Gem√ºsesch√§ler", menge: 8, kategorie: "K√ºchenger√§te", notizen: "Standard - Lagervorrat" },
            { name: "K√ºchenwaage", menge: 4, kategorie: "K√ºchenger√§te", notizen: "Bis 10kg - Lagervorrat" },
            { name: "Sp√ºlmittel", menge: 8, kategorie: "Reinigung", notizen: "Konzentrat - Lagervorrat" },
            { name: "Schw√§mme", menge: 24, kategorie: "Reinigung", notizen: "Sp√ºlschw√§mme - Lagervorrat" },
            { name: "Handt√ºcher", menge: 16, kategorie: "Reinigung", notizen: "K√ºchenhandt√ºcher - Lagervorrat" },
            { name: "Arbeitshandschuhe", menge: 24, kategorie: "Schutzausr√ºstung", notizen: "Hitze best√§ndig - Lagervorrat" },
            { name: "Sch√ºrzen", menge: 12, kategorie: "Schutzausr√ºstung", notizen: "K√ºchensch√ºrzen - Lagervorrat" },
            { name: "Wasserkanister 20L", menge: 8, kategorie: "Wasseraufbereitung", notizen: "Trinkwasser - Lagervorrat" }
        ],

        // GW-Beladung Funktionen
        fuegeGWEquipmentHinzu(equipment) {
            this.gwBeladung.push({
                id: Date.now() + Math.random(),
                name: equipment.name,
                menge: parseInt(equipment.menge),
                kategorie: equipment.kategorie,
                notizen: equipment.notizen,
                hinzugefuegtAm: new Date().toISOString()
            });
            this.speichereGW();
            this.aktualisiereGWAnzeige();
        },

        entferneGW(id) {
            this.gwBeladung = this.gwBeladung.filter(item => item.id !== id);
            this.speichereGW();
            this.aktualisiereGWAnzeige();
        },

        gwLeeren() {
            if (confirm('M√∂chten Sie wirklich die gesamte GW-Beladung l√∂schen?')) {
                this.gwBeladung = [];
                this.speichereGW();
                this.aktualisiereGWAnzeige();
            }
        },

        speichereGW() {
            localStorage.setItem('equipment_gw', JSON.stringify(this.gwBeladung));
            // Automatische Cloud-Synchronisation
            CloudStorage.saveToCloud('equipment_gw', this.gwBeladung).catch(error => {
                console.error('Auto-Sync fehlgeschlagen:', error);
            });
        },

        // KV-Lager Funktionen
        fuegeKVLagerHinzu(equipment) {
            this.kvLager.push({
                id: Date.now() + Math.random(),
                name: equipment.name,
                menge: parseInt(equipment.menge),
                kategorie: equipment.kategorie,
                notizen: equipment.notizen,
                hinzugefuegtAm: new Date().toISOString()
            });
            this.speichereKVLager();
            this.aktualisiereKVLagerAnzeige();
        },

        entferneKVLager(id) {
            this.kvLager = this.kvLager.filter(item => item.id !== id);
            this.speichereKVLager();
            this.aktualisiereKVLagerAnzeige();
        },

        kvLagerLeeren() {
            if (confirm('M√∂chten Sie wirklich das gesamte KV-Lager leeren?')) {
                this.kvLager = [];
                this.speichereKVLager();
                this.aktualisiereKVLagerAnzeige();
            }
        },

        speichereKVLager() {
            localStorage.setItem('equipment_kv_lager', JSON.stringify(this.kvLager));
            // Automatische Cloud-Synchronisation
            CloudStorage.saveToCloud('equipment_kv_lager', this.kvLager).catch(error => {
                console.error('Auto-Sync fehlgeschlagen:', error);
            });
        },

        // Cloud-Synchronisation f√ºr Equipment
        async syncWithCloud(type) {
            try {
                if (type === 'gw') {
                    const cloudData = await CloudStorage.loadFromCloud('equipment_gw');
                    if (cloudData && cloudData.length > 0) {
                        this.gwBeladung = cloudData;
                        this.speichereGW();
                        this.aktualisiereGWAnzeige();
                        alert('‚úÖ GW-Beladung mit Cloud synchronisiert!');
                    } else {
                        alert('‚ÑπÔ∏è Keine GW-Daten in der Cloud gefunden.');
                    }
                } else if (type === 'kv-lager') {
                    const cloudData = await CloudStorage.loadFromCloud('equipment_kv_lager');
                    if (cloudData && cloudData.length > 0) {
                        this.kvLager = cloudData;
                        this.speichereKVLager();
                        this.aktualisiereKVLagerAnzeige();
                        alert('‚úÖ KV-Lager mit Cloud synchronisiert!');
                    } else {
                        alert('‚ÑπÔ∏è Keine KV-Lager-Daten in der Cloud gefunden.');
                    }
                }
            } catch (error) {
                console.error('Cloud-Sync fehlgeschlagen:', error);
                alert('‚ùå Synchronisation mit Cloud fehlgeschlagen!');
            }
        },

        // Transfer-Funktionen
        transferToVehicle(itemId) {
            const item = this.kvLager.find(i => i.id === itemId);
            if (item && item.menge > 0) {
                item.menge -= 1;
                
                const existingInVehicle = this.gwBeladung.find(i => i.name === item.name);
                if (existingInVehicle) {
                    existingInVehicle.menge += 1;
                } else {
                    this.gwBeladung.push({
                        id: Date.now() + Math.random(),
                        name: item.name,
                        menge: 1,
                        kategorie: item.kategorie,
                        notizen: item.notizen + " (vom KV-Lager)",
                        hinzugefuegtAm: new Date().toISOString()
                    });
				}
                
                if (item.menge === 0) {
                    this.gwBeladung = this.gwBeladung.filter(i => i.id !== itemId);
                }
                
                this.speichereGW();
                this.speichereKVLager();
                this.aktualisiereGWAnzeige();
                this.aktualisiereKVLagerAnzeige();
                
                alert(`1x ${item.name} wurde ins KV-Lager ger√§umt.`);
            }
        },

        transferAllToVehicle() {
            if (this.kvLager.length === 0) {
                alert("KV-Lager ist leer!");
                return;
            }
            
            if (confirm('M√∂chten Sie ALLE verf√ºgbaren Gegenst√§nde vom KV-Lager auf das Fahrzeug laden?')) {
                this.kvLager.forEach(lagerItem => {
                    const existingInVehicle = this.gwBeladung.find(vehicleItem => vehicleItem.name === lagerItem.name);
                    if (existingInVehicle) {
                        existingInVehicle.menge += lagerItem.menge;
                    } else {
                        this.gwBeladung.push({
                            ...lagerItem,
                            id: Date.now() + Math.random(),
                            notizen: lagerItem.notizen + " (vom KV-Lager transferiert)"
                        });
                    }
                });
                
                this.kvLager = [];
                this.speichereGW();
                this.speichereKVLager();
                this.aktualisiereGWAnzeige();
                this.aktualisiereKVLagerAnzeige();
                
                alert("Komplettes KV-Lager wurde auf das Fahrzeug geladen!");
            }
        },

        transferAllToStorage() {
            if (this.gwBeladung.length === 0) {
                alert("Fahrzeug ist leer!");
                return;
            }
            
            if (confirm('M√∂chten Sie ALLE Gegenst√§nde vom Fahrzeug ins KV-Lager r√§umen?')) {
                this.gwBeladung.forEach(vehicleItem => {
                    const existingInStorage = this.kvLager.find(lagerItem => lagerItem.name === vehicleItem.name);
                    if (existingInStorage) {
                        existingInStorage.menge += vehicleItem.menge;
                    } else {
                        this.kvLager.push({
                            ...vehicleItem,
                            id: Date.now() + Math.random(),
                            notizen: vehicleItem.notizen + " (vom Fahrzeug transferiert)"
                        });
                    }
                });
                
                this.gwBeladung = [];
                this.speichereGW();
                this.speichereKVLager();
                this.aktualisiereGWAnzeige();
                this.aktualisiereKVLagerAnzeige();
                
                alert("Komplette Fahrzeugbeladung wurde ins KV-Lager ger√§umt!");
            }
        },

        syncInventory() {
            let synced = false;
            
            const allItems = {};
            
            [...this.gwBeladung, ...this.kvLager].forEach(item => {
                if (!allItems[item.name]) {
                    allItems[item.name] = { ...item, gesamtMenge: 0, quellen: [] };
                }
                allItems[item.name].gesamtMenge += item.menge;
                allItems[item.name].quellen.push({
                    typ: this.gwBeladung.includes(item) ? 'Fahrzeug' : 'Lager',
                    menge: item.menge
                });
            });
            
            Object.values(allItems).forEach(item => {
                const targetVehicle = Math.ceil(item.gesamtMenge * 0.5);
                const targetStorage = item.gesamtMenge - targetVehicle;
                
                const currentVehicle = this.gwBeladung.find(i => i.name === item.name)?.menge || 0;
                const currentStorage = this.kvLager.find(i => i.name === item.name)?.menge || 0;
                
                if (currentVehicle !== targetVehicle || currentStorage !== targetStorage) {
                    synced = true;
                    
                    const vehicleItem = this.gwBeladung.find(i => i.name === item.name);
                    if (vehicleItem) {
                        vehicleItem.menge = targetVehicle;
                    } else if (targetVehicle > 0) {
                        this.gwBeladung.push({
                            id: Date.now() + Math.random(),
                            name: item.name,
                            menge: targetVehicle,
                            kategorie: item.kategorie,
                            notizen: item.notizen + " (synchronisiert)",
                            hinzugefuegtAm: new Date().toISOString()
                        });
                    }
                    
                    const storageItem = this.kvLager.find(i => i.name === item.name);
                    if (storageItem) {
                        storageItem.menge = targetStorage;
                    } else if (targetStorage > 0) {
                        this.kvLager.push({
                            id: Date.now() + Math.random(),
                            name: item.name,
                            menge: targetStorage,
                            kategorie: item.kategorie,
                            notizen: item.notizen + " (synchronisiert)",
                            hinzugefuegtAm: new Date().toISOString()
                        });
                    }
                }
            });
            
            this.gwBeladung = this.gwBeladung.filter(item => item.menge > 0);
            this.kvLager = this.kvLager.filter(item => item.menge > 0);
            
            this.speichereGW();
            this.speichereKVLager();
            this.aktualisiereGWAnzeige();
            this.aktualisiereKVLagerAnzeige();
            
            if (synced) {
                alert("Best√§nde wurden erfolgreich synchronisiert (50% Fahrzeug / 50% Lager)!");
            } else {
                alert("Best√§nde sind bereits optimal verteilt!");
            }
        },

        ladeHIKDefault(typ) {
            if (typ === 'gw') {
                this.gwBeladung = [...this.hikGWDefault.map(item => ({
                    ...item,
                    id: Date.now() + Math.random(),
                    hinzugefuegtAm: new Date().toISOString()
                }))];
                this.speichereGW();
                this.aktualisiereGWAnzeige();
                alert('HIK 3.0 Default Beladung f√ºr GW-Verpflegung geladen!');
            } else if (typ === 'kv-lager') {
                this.kvLager = [...this.hikKVLagerDefault.map(item => ({
                    ...item,
                    id: Date.now() + Math.random(),
                    hinzugefuegtAm: new Date().toISOString()
                }))];
                this.speichereKVLager();
                this.aktualisiereKVLagerAnzeige();
                alert('HIK 3.0 Default f√ºr KV-Lager geladen!');
            }
        },

        aktualisiereGWAnzeige() {
            const container = document.getElementById('gw-beladung');
            if (this.gwBeladung.length === 0) {
                container.innerHTML = '<p>Keine Equipment im GW-Verpflegung.</p>';
                return;
            }

            let html = '<h4>Aktuelle GW-Beladung</h4>';
            
            const kategorien = {};
            this.gwBeladung.forEach(item => {
                if (!kategorien[item.kategorie]) {
                    kategorien[item.kategorie] = [];
                }
                kategorien[item.kategorie].push(item);
            });

            Object.keys(kategorien).sort().forEach(kategorie => {
                html += `<h5>${kategorie}</h5>`;
                kategorien[kategorie].forEach(item => {
                    html += `
                        <div class="lager-item">
                            <div style="flex: 1;">
                                <strong>${item.name}</strong><br>
                                <small>Menge: ${item.menge} ‚Ä¢ Kategorie: ${item.kategorie}</small>
                                ${item.notizen ? `<br><small>Notiz: ${item.notizen}</small>` : ''}
                            </div>
                            <div>
                                <button onclick="EquipmentManager.transferToStorage(${item.id})" class="secondary" title="Ins Lager r√§umen">üè¢</button>
                                <button onclick="EquipmentManager.entferneGW(${item.id})" class="secondary">Entfernen</button>
                            </div>
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
        },

        aktualisiereKVLagerAnzeige() {
            const container = document.getElementById('kv-lager');
            if (this.kvLager.length === 0) {
                container.innerHTML = '<p>Keine Equipment im KV-Lager.</p>';
                return;
            }

            let html = '<h4>Aktueller KV-Lagerbestand</h4>';
            
            const kategorien = {};
            this.kvLager.forEach(item => {
                if (!kategorien[item.kategorie]) {
                    kategorien[item.kategorie] = [];
                }
                kategorien[item.kategorie].push(item);
            });

            Object.keys(kategorien).sort().forEach(kategorie => {
                html += `<h5>${kategorie}</h5>`;
                kategorien[kategorie].forEach(item => {
                    html += `
                        <div class="lager-item">
                            <div style="flex: 1;">
                                <strong>${item.name}</strong><br>
                                <small>Menge: ${item.menge} ‚Ä¢ Kategorie: ${item.kategorie}</small>
                                ${item.notizen ? `<br><small>Notiz: ${item.notizen}</small>` : ''}
                            </div>
                            <div>
                                <button onclick="EquipmentManager.transferToVehicle(${item.id})" class="equipment" title="Auf Fahrzeug laden">üöö</button>
                                <button onclick="EquipmentManager.entferneKVLager(${item.id})" class="secondary" title="Aus Lager entfernen">Entfernen</button>
                            </div>
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
        },

        berechneEinsatzMaterial() {
            const personen = parseInt(document.getElementById('einsatz-personen').value) || 50;
            const dauer = parseInt(document.getElementById('einsatz-dauer').value) || 1;
            const quelle = document.querySelector('input[name="material-quelle"]:checked').value;
            
            let ergebnisHTML = `<div class="einsatz-ergebnis">
                <h4>Einsatzmaterial f√ºr ${personen} Personen (${dauer} Tag${dauer > 1 ? 'e' : ''})</h4>
                <p><strong>Material-Quelle:</strong> ${quelle === 'auto' ? 'Zuerst Fahrzeug, dann Lager' : 'Zuerst Lager, dann Fahrzeug'}</p>
            `;
            
            ergebnisHTML += `
                <h5>Ben√∂tigtes Material:</h5>
                <ul>
                    <li>Geschirr: ${personen} Sets</li>
                    <li>Besteck: ${personen} Sets</li>
                    <li>Kocht√∂pfe: ${Math.ceil(personen / 100)} gro√üe T√∂pfe</li>
                    <li>Gasflaschen: ${Math.ceil(personen / 50)} St√ºck</li>
                    <li>Verbandmaterial: Basis-Set + ${Math.ceil(personen / 10)} Erweiterungen</li>
                </ul>
                
                <h5>Quellen-Zuordnung:</h5>
                <p>Die Materialien werden entsprechend der gew√§hlten Quelle (${quelle === 'auto' ? 'Fahrzeug zuerst' : 'Lager zuerst'}) zugeordnet.</p>
                
                <div class="cloud-actions">
                    <button onclick="druckeEinsatzliste()" class="equipment">üñ®Ô∏è Einsatzliste drucken</button>
                    <button onclick="exportEinsatzPDF()" class="pdf">üì• Einsatz als PDF</button>
                </div>
            </div>`;
            
            document.getElementById('einsatz-ergebnis').innerHTML = ergebnisHTML;
        }
    };

    // =============================================
    // EINKAUFSMODUS MANAGEMENT
    // =============================================
			const Einkaufsmodus = {
			aktuellerModus: 'lager',

			getAktuellerModus() {
				const selected = document.querySelector('input[name="einkaufsmodus"]:checked');
				return selected ? selected.value : 'lager';
			},

			berechneZuKaufendeMenge(benoetigteMenge, zutatName) {
				const modus = this.getAktuellerModus();
				
				if (modus === 'komplett') {
					return {
						zuKaufen: benoetigteMenge,
						vorhanden: 0,
						verwendeterLagerbestand: 0
					};
				} else {
					const lagerItem = this.findeImLager(zutatName, LagerManager.lagerbestand);
					
					if (lagerItem) {
						const verwendeteMenge = Math.min(benoetigteMenge, lagerItem.menge);
						const zuKaufendeMenge = Math.max(0, benoetigteMenge - verwendeteMenge);
						
						return {
							zuKaufen: zuKaufendeMenge,
							vorhanden: verwendeteMenge,
							verwendeterLagerbestand: verwendeteMenge
						};
					} else {
						return {
							zuKaufen: benoetigteMenge,
							vorhanden: 0,
							verwendeterLagerbestand: 0
						};
					}
				}
			},

			findeImLager(zutatName, lagerbestand) {
				if (!lagerbestand || lagerbestand.length === 0) return null;
				
				// Direkter Vergleich
				for (const item of lagerbestand) {
					if (item.name.toLowerCase() === zutatName.toLowerCase()) {
						return item;
					}
				}
				
				// Erweiterte Suche mit √§hnlichen Namen
				for (const item of lagerbestand) {
					const n1 = item.name.toLowerCase().replace(/[^a-z√§√∂√º√ü]/g, '');
					const n2 = zutatName.toLowerCase().replace(/[^a-z√§√∂√º√ü]/g, '');
					if (n1.includes(n2) || n2.includes(n1)) {
						return item;
					}
				}
				
				return null;
			}
		};

		// =============================================
		// KORRIGIERTE REZEPT-EMPFEHLUNGS-ENGINE
		// =============================================

		const RezeptEmpfehlungsEngine = {
			analysiereRezepte(personen, lagerbestand) {
				const ergebnisse = [];
				
				for (const [rezeptName, rezeptDaten] of Object.entries(rezepte)) {
					const analyse = this.analysiereEinzelnesRezept(rezeptName, rezeptDaten, personen, lagerbestand);
					if (analyse) {
						ergebnisse.push(analyse);
					}
				}
				
				// Sortiere nach Gesamtkosten (niedrigste zuerst)
				return ergebnisse.sort((a, b) => a.gesamtKosten - b.gesamtKosten);
			},

			analysiereEinzelnesRezept(rezeptName, rezeptDaten, personen, lagerbestand) {
				const faktor = personen / rezeptDaten.basisPortionen;
				let gesamtKosten = 0;
				let benoetigteZutaten = [];
				let verwendeterLagerbestand = {};
				let fehlendeZutaten = [];
				let zuKaufendePositionen = 0;
				
				// Hauptrezept-Zutaten analysieren
				for (const zutat of rezeptDaten.zutaten) {
					const benoetigteMenge = zutat.menge * faktor;
					const lagerItem = this.findeImLager(zutat.name, lagerbestand);
					
					if (lagerItem) {
						const verwendeteMenge = Math.min(benoetigteMenge, lagerItem.menge);
						const zuKaufendeMenge = Math.max(0, benoetigteMenge - verwendeteMenge);
						
						verwendeterLagerbestand[zutat.name] = {
							verwendet: verwendeteMenge,
							rest: lagerItem.menge - verwendeteMenge
						};
						
						if (zuKaufendeMenge > 0) {
							const packungsInfo = berechnePackungen(zuKaufendeMenge, zutat.name);
							gesamtKosten += packungsInfo.gesamtPreis;
							zuKaufendePositionen++;
							benoetigteZutaten.push({
								name: zutat.name,
								benoetigt: benoetigteMenge,
								vorhanden: verwendeteMenge,
								zuKaufen: zuKaufendeMenge,
								kosten: packungsInfo.gesamtPreis
							});
						} else {
							benoetigteZutaten.push({
								name: zutat.name,
								benoetigt: benoetigteMenge,
								vorhanden: verwendeteMenge,
								zuKaufen: 0,
								kosten: 0
							});
						}
					} else {
						const packungsInfo = berechnePackungen(benoetigteMenge, zutat.name);
						gesamtKosten += packungsInfo.gesamtPreis;
						zuKaufendePositionen++;
						benoetigteZutaten.push({
							name: zutat.name,
							benoetigt: benoetigteMenge,
							vorhanden: 0,
							zuKaufen: benoetigteMenge,
							kosten: packungsInfo.gesamtPreis
						});
						fehlendeZutaten.push(zutat.name);
					}
				}
				
				// Getr√§nke und Snacks hinzuf√ºgen
				zusaetzlicheProdukte.forEach(produkt => {
					const benoetigteMenge = produkt.menge * personen;
					const lagerItem = this.findeImLager(produkt.name, lagerbestand);
					
					if (lagerItem) {
						const verwendeteMenge = Math.min(benoetigteMenge, lagerItem.menge);
						const zuKaufendeMenge = Math.max(0, benoetigteMenge - verwendeteMenge);
						
						verwendeterLagerbestand[produkt.name] = {
							verwendet: verwendeteMenge,
							rest: lagerItem.menge - verwendeteMenge
						};
						
						if (zuKaufendeMenge > 0) {
							const packungsInfo = berechnePackungen(zuKaufendeMenge, produkt.name);
							gesamtKosten += packungsInfo.gesamtPreis;
							zuKaufendePositionen++;
							benoetigteZutaten.push({
								name: produkt.name,
								benoetigt: benoetigteMenge,
								vorhanden: verwendeteMenge,
								zuKaufen: zuKaufendeMenge,
								kosten: packungsInfo.gesamtPreis
							});
						} else {
							benoetigteZutaten.push({
								name: produkt.name,
								benoetigt: benoetigteMenge,
								vorhanden: verwendeteMenge,
								zuKaufen: 0,
								kosten: 0
							});
						}
					} else {
						const packungsInfo = berechnePackungen(benoetigteMenge, produkt.name);
						gesamtKosten += packungsInfo.gesamtPreis;
						zuKaufendePositionen++;
						benoetigteZutaten.push({
							name: produkt.name,
							benoetigt: benoetigteMenge,
							vorhanden: 0,
							zuKaufen: benoetigteMenge,
							kosten: packungsInfo.gesamtPreis
						});
						fehlendeZutaten.push(produkt.name);
					}
				});
				
				return {
					rezeptName: rezeptName,
					anzeigeName: rezeptDaten.name,
					gesamtKosten: gesamtKosten,
					kostenProPortion: gesamtKosten / personen,
					benoetigteZutaten: benoetigteZutaten,
					fehlendeZutaten: fehlendeZutaten,
					zuKaufendePositionen: zuKaufendePositionen,
					verwendeterLagerbestand: verwendeterLagerbestand,
					lagerNutzung: Object.keys(verwendeterLagerbestand).length
				};
			},

			findeImLager(zutatName, lagerbestand) {
				if (!lagerbestand || lagerbestand.length === 0) return null;
				
				// Direkter Vergleich
				for (const item of lagerbestand) {
					if (item.name.toLowerCase() === zutatName.toLowerCase()) {
						return item;
					}
				}
				
				// Erweiterte Suche mit √§hnlichen Namen
				for (const item of lagerbestand) {
					const n1 = item.name.toLowerCase().replace(/[^a-z√§√∂√º√ü]/g, '');
					const n2 = zutatName.toLowerCase().replace(/[^a-z√§√∂√º√ü]/g, '');
					if (n1.includes(n2) || n2.includes(n1)) {
						return item;
					}
				}
				
				return null;
			},

			erstelleEmpfehlungsHTML(empfehlungen, personen) {
				if (empfehlungen.length === 0) {
					return '<div class="warning-box"><p>Keine passenden Rezepte gefunden. Bitte √ºberpr√ºfen Sie Ihren Lagerbestand.</p></div>';
				}

				const besteEmpfehlung = empfehlungen[0];
				const allergenBadges = AllergenManager.erstelleAllergenBadges(
					AllergenManager.getAlleRezeptAllergene(besteEmpfehlung.rezeptName)
				);

				let html = `
					<div class="recommendation-card best-choice">
						<h3>üèÜ Beste Empfehlung</h3>
						<h4>${besteEmpfehlung.anzeigeName}</h4>
						
						<div style="margin: 10px 0;">
							<strong>Allergene:</strong> ${allergenBadges}
						</div>
						
						<div class="recommendation-stats">
							<div class="stat-item">
								<div class="stat-value">${besteEmpfehlung.gesamtKosten.toFixed(2)} ‚Ç¨</div>
								<div class="stat-label">Gesamtkosten</div>
							</div>
							<div class="stat-item">
								<div class="stat-value">${besteEmpfehlung.kostenProPortion.toFixed(2)} ‚Ç¨</div>
								<div class="stat-label">pro Portion</div>
							</div>
							<div class="stat-item">
								<div class="stat-value">${besteEmpfehlung.zuKaufendePositionen}</div>
								<div class="stat-label">zu kaufen</div>
							</div>
							<div class="stat-item">
								<div class="stat-value">${besteEmpfehlung.lagerNutzung}</div>
								<div class="stat-label">Lager genutzt</div>
							</div>
						</div>
						
						<p class="cost-saving">üí° Das ist die g√ºnstigste Option basierend auf Ihrem Lagerbestand!</p>
						
						<button onclick="waehleEmpfohlenesRezept('${besteEmpfehlung.rezeptName}')" class="success">
							‚úÖ Dieses Rezept ausw√§hlen & anzeigen
						</button>
					</div>
				`;
				
				// Weitere Empfehlungen anzeigen (Top 3)
				if (empfehlungen.length > 1) {
					html += `<div class="card"><h4>Weitere gute Optionen:</h4>`;
					
					for (let i = 1; i < Math.min(4, empfehlungen.length); i++) {
						const empfehlung = empfehlungen[i];
						html += `
							<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
								<strong>${empfehlung.anzeigeName}</strong><br>
								Kosten: ${empfehlung.gesamtKosten.toFixed(2)} ‚Ç¨ | 
								Zu kaufen: ${empfehlung.zuKaufendePositionen} Positionen |
								<button onclick="waehleEmpfohlenesRezept('${empfehlung.rezeptName}')" style="padding: 2px 8px; margin-left: 10px;">Ausw√§hlen</button>
							</div>
						`;
					}
					html += `</div>`;
				}
				
				return html;
			}
		};

    // =============================================
    // LAGERVERWALTUNG MIT CLOUD SYNC
    // =============================================

    const LagerManager = {
        lagerbestand: JSON.parse(localStorage.getItem('feldkueche_lager')) || [],

        fuegeHinzu(lebensmittel) {
            this.lagerbestand.push({
                id: Date.now() + Math.random(),
                name: lebensmittel.name,
                menge: parseFloat(lebensmittel.menge),
                einheit: lebensmittel.einheit,
                kategorie: lebensmittel.kategorie,
                haltbarkeit: lebensmittel.haltbarkeit,
                notizen: lebensmittel.notizen,
                hinzugefuegtAm: new Date().toISOString()
            });
            this.speichere();
            this.aktualisiereAnzeige();
        },

        entferne(id) {
            this.lagerbestand = this.lagerbestand.filter(item => item.id !== id);
            this.speichere();
            this.aktualisiereAnzeige();
        },

        leeren() {
            this.lagerbestand = [];
            this.speichere();
            this.aktualisiereAnzeige();
        },

        speichere() {
            localStorage.setItem('feldkueche_lager', JSON.stringify(this.lagerbestand));
            // Automatische Cloud-Synchronisation
            CloudStorage.saveToCloud('feldkueche_lager', this.lagerbestand).catch(error => {
                console.error('Auto-Sync fehlgeschlagen:', error);
            });
        },

        // Cloud-Synchronisation f√ºr Lager
        async syncWithCloud() {
            try {
                const cloudData = await CloudStorage.loadFromCloud('feldkueche_lager');
                if (cloudData && cloudData.length > 0) {
                    this.lagerbestand = cloudData;
                    this.speichere();
                    this.aktualisiereAnzeige();
                    alert('‚úÖ Lebensmittel-Lager mit Cloud synchronisiert!');
                } else {
                    alert('‚ÑπÔ∏è Keine Lager-Daten in der Cloud gefunden.');
                }
            } catch (error) {
                console.error('Cloud-Sync fehlgeschlagen:', error);
                alert('‚ùå Synchronisation mit Cloud fehlgeschlagen!');
            }
        },

        pruefeHaltbarkeit(datum) {
            if (!datum) return 'unbekannt';
            const heute = new Date();
            const haltbarkeit = new Date(datum);
            const tage = Math.ceil((haltbarkeit - heute) / (1000 * 60 * 60 * 24));
            
            if (tage < 0) return 'abgelaufen';
            if (tage <= 7) return 'bald_ablaufend';
            return 'ok';
        },

        aktualisiereAnzeige() {
            const container = document.getElementById('lager-bestand');
            if (this.lagerbestand.length === 0) {
                container.innerHTML = '<p>Keine Lebensmittel im Lager.</p>';
                return;
            }

            let html = '<h3>Lagerbestand</h3>';
            
            const kategorien = {};
            this.lagerbestand.forEach(item => {
                if (!kategorien[item.kategorie]) {
                    kategorien[item.kategorie] = [];
                }
                kategorien[item.kategorie].push(item);
            });

            Object.keys(kategorien).sort().forEach(kategorie => {
                html += `<h4>${kategorie}</h4>`;
                kategorien[kategorie].forEach(item => {
                    const haltbarkeit = this.pruefeHaltbarkeit(item.haltbarkeit);
                    const klasse = haltbarkeit === 'abgelaufen' ? 'expired' : 
                                  haltbarkeit === 'bald_ablaufend' ? 'expiring-soon' : '';
                    
                    const haltbarkeitsText = item.haltbarkeit ? 
                        new Date(item.haltbarkeit).toLocaleDateString('de-DE') : 'Kein Datum';
                    
                    html += `
                        <div class="lager-item ${klasse}">
                            <div style="flex: 1;">
                                <strong>${item.name}</strong><br>
                                <small>${item.menge} ${item.einheit} ‚Ä¢ Haltbar bis: ${haltbarkeitsText}</small>
                                ${item.notizen ? `<br><small>Notiz: ${item.notizen}</small>` : ''}
                            </div>
                            <button onclick="LagerManager.entferne(${item.id})" class="secondary">Entfernen</button>
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
        }
    };

    // =============================================
    // HILFSFUNKTIONEN
    // =============================================

    function konvertiereEinheit(menge, einheit) {
        if (einheit === "kg") {
            if (menge >= 1000) {
                return { wert: (menge / 1000).toFixed(2), einheit: "t" };
            } else if (menge < 1) {
                return { wert: (menge * 1000).toFixed(0), einheit: "g" };
            }
        } else if (einheit === "L") {
            if (menge >= 1000) {
                return { wert: (menge / 1000).toFixed(2), einheit: "m¬≥" };
            } else if (menge < 1) {
                return { wert: (menge * 1000).toFixed(0), einheit: "ml" };
            }
        }
        return { wert: menge.toFixed(2), einheit: einheit };
    }

    function berechnePackungen(menge, produkt) {
        if (!wasgauProdukte[produkt]) {
            return { anzahl: 1, groesse: menge, preis: 0, einheit: "kg" };
        }
        
        const packungsgroessen = [...wasgauProdukte[produkt].packungsgroessen].sort((a, b) => b - a);
        const preise = wasgauProdukte[produkt].preise;
        
        let restMenge = menge;
        let packungen = [];
        let gesamtPreis = 0;
        
        for (let i = 0; i < packungsgroessen.length && restMenge > 0; i++) {
            const groesse = packungsgroessen[i];
            const preis = preise[i];
            const anzahl = Math.floor(restMenge / groesse);
            
            if (anzahl > 0) {
                packungen.push({ groesse, anzahl, preis });
                gesamtPreis += anzahl * preis;
                restMenge -= anzahl * groesse;
            }
        }
        
        if (restMenge > 0) {
            const kleinsteGroesse = packungsgroessen[packungsgroessen.length - 1];
            const preis = preise[preise.length - 1];
            packungen.push({ groesse: kleinsteGroesse, anzahl: 1, preis });
            gesamtPreis += preis;
        }
        
        return { packungen, gesamtPreis, restMenge: Math.max(0, restMenge) };
    }

    // =============================================
    // PDF EXPORT FUNKTION F√úR REZEPT
    // =============================================

    function exportRezeptAsPDF() {
        const rezeptName = getAktuellesRezept();
        const personen = parseFloat(document.getElementById("personen").value);
        const rezept = rezepte[rezeptName];
        
        if (!rezept || !personen) {
            alert("Bitte zuerst ein Rezept und eine Personenzahl ausw√§hlen!");
            return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const faktor = personen / rezept.basisPortionen;
        const anzeigeName = RezeptEmpfehlungsEngine.getRezeptAnzeigeName(rezeptName);
        const rezeptAllergene = AllergenManager.getAlleRezeptAllergene(rezeptName);
        
        // Titel
        doc.setFontSize(18);
        doc.setTextColor(179, 0, 0);
        doc.text(`Rezept - ${anzeigeName}`, 14, 15);
        
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text(`F√ºr ${personen} Personen ‚Ä¢ ${new Date().toLocaleDateString('de-DE')}`, 14, 22);
        
        // Allergene
        if (rezeptAllergene.length > 0) {
            const allergenText = rezeptAllergene.map(code => {
                const allergen = allergene[code];
                return `${allergen.icon} ${code}: ${allergen.name}`;
            }).join(', ');
            
            doc.setFontSize(9);
            doc.setTextColor(255, 87, 34);
            doc.text(`Allergene: ${allergenText}`, 14, 30);
        } else {
            doc.setFontSize(9);
            doc.setTextColor(76, 175, 80);
            doc.text(`‚úÖ Allergenfrei - Enth√§lt keine der 14 Hauptallergene`, 14, 30);
        }
        
        // Zutaten-Tabelle
        const kopfZeilen = [['Zutat', 'Menge', 'Einheit', 'Allergene']];
        const tabellenDaten = [];
        
        rezept.zutaten.forEach(zutat => {
            const neueMenge = zutat.menge * faktor;
            const konvertiert = konvertiereEinheit(neueMenge, zutat.einheit);
            const zutatAllergene = produktAllergene[zutat.name] || [];
            const zutatAllergenText = zutatAllergene.map(code => {
                const allergen = allergene[code];
                return `${allergen.icon} ${code}`;
            }).join(', ');
            
            tabellenDaten.push([
                zutat.name,
                konvertiert.wert,
                konvertiert.einheit,
                zutatAllergenText || '-'
            ]);
        });
        
        doc.autoTable({
            head: kopfZeilen,
            body: tabellenDaten,
            startY: 35,
            styles: {
                fontSize: 9,
                cellPadding: 3,
            },
            headStyles: {
                fillColor: [179, 0, 0],
                textColor: 255,
                fontStyle: 'bold'
            },
            alternateRowStyles: {
                fillColor: [245, 245, 245]
            },
            columnStyles: {
                0: { cellWidth: 70 },
                1: { cellWidth: 30 },
                2: { cellWidth: 25 },
                3: { cellWidth: 45 }
            }
        });
        
        const finalY = doc.lastAutoTable.finalY + 10;
        
        // Handlungsanweisungen
        doc.setFontSize(12);
        doc.setTextColor(179, 0, 0);
        doc.text('Zubereitung:', 14, finalY);
        
        let anleitungY = finalY + 8;
        rezept.anleitung.forEach((schritt, index) => {
            if (anleitungY > 270) {
                doc.addPage();
                anleitungY = 20;
            }
            doc.setFontSize(9);
            doc.setTextColor(0, 0, 0);
            doc.text(`${index + 1}. ${schritt}`, 20, anleitungY);
            anleitungY += 5;
        });
        
        // Fu√üzeile
        doc.setFontSize(8);
        doc.setTextColor(100, 100, 100);
        doc.text('Erstellt mit Feldk√ºche - Intelligente Rezeptempfehlung', 14, 280);
        doc.text('Deutsches Rotes Kreuz', 14, 285);
        
        const fileName = `Rezept_${anzeigeName}_${personen}Personen.pdf`;
        doc.save(fileName);
    }

    // =============================================
    // PDF EXPORT FUNKTION F√úR EINKAUFSLISTE
    // =============================================

    function exportAsPDF() {
        const rezeptName = getAktuellesRezept();
        const personen = parseFloat(document.getElementById("personen").value);
        const rezept = rezepte[rezeptName];
        
        if (!rezept || !personen) {
            alert("Bitte zuerst ein Rezept und eine Personenzahl ausw√§hlen!");
            return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const faktor = personen / rezept.basisPortionen;
        const modus = Einkaufsmodus.getAktuellerModus();
        
        doc.setFontSize(16);
        doc.setTextColor(179, 0, 0);
        doc.text(`Einkaufsliste - ${RezeptEmpfehlungsEngine.getRezeptAnzeigeName(rezeptName)}`, 14, 15);
        
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text(`F√ºr ${personen} Personen ‚Ä¢ ${new Date().toLocaleDateString('de-DE')}`, 14, 22);
        doc.text(`Modus: ${modus === 'lager' ? 'Lagerbestand ber√ºcksichtigt' : 'Alles neu kaufen'}`, 14, 28);
        
        const kopfZeilen = [
            ['Produkt', 'Ben√∂tigt', 'Vorhanden', 'Zu kaufen', 'Packungen', 'Kosten (‚Ç¨)']
        ];
        
        const tabellenDaten = [];
        let gesamtKosten = 0;
        
        // Hauptrezept-Zutaten
        rezept.zutaten.forEach(zutat => {
            const benoetigteMenge = zutat.menge * faktor;
            const kaufInfo = Einkaufsmodus.berechneZuKaufendeMenge(benoetigteMenge, zutat.name);
            
            if (kaufInfo.zuKaufen > 0) {
                const packungsInfo = berechnePackungen(kaufInfo.zuKaufen, zutat.name);
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, zutat.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, zutat.einheit);
                const konvertiertZuKaufen = konvertiereEinheit(kaufInfo.zuKaufen, zutat.einheit);
                
                let packungenText = "";
                packungsInfo.packungen.forEach(pack => {
                    const packKonvertiert = konvertiereEinheit(pack.groesse, wasgauProdukte[zutat.name] ? wasgauProdukte[zutat.name].einheit : zutat.einheit);
                    packungenText += `${pack.anzahl} √ó ${packKonvertiert.wert} ${packKonvertiert.einheit}\n`;
                });
                
                tabellenDaten.push([
                    zutat.name,
                    `${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}`,
                    `${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}`,
                    `${konvertiertZuKaufen.wert} ${konvertiertZuKaufen.einheit}`,
                    packungenText.trim(),
                    `${packungsInfo.gesamtPreis.toFixed(2)}`
                ]);
                
                gesamtKosten += packungsInfo.gesamtPreis;
            } else {
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, zutat.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, zutat.einheit);
                
                tabellenDaten.push([
                    zutat.name,
                    `${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}`,
                    `${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}`,
                    "Aus Lager",
                    "-",
                    "0.00"
                ]);
            }
        });
        
        // Getr√§nke und Snacks hinzuf√ºgen
        zusaetzlicheProdukte.forEach(produkt => {
            const benoetigteMenge = produkt.menge * personen;
            const kaufInfo = Einkaufsmodus.berechneZuKaufendeMenge(benoetigteMenge, produkt.name);
            
            if (kaufInfo.zuKaufen > 0) {
                const packungsInfo = berechnePackungen(kaufInfo.zuKaufen, produkt.name);
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, produkt.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, produkt.einheit);
                const konvertiertZuKaufen = konvertiereEinheit(kaufInfo.zuKaufen, produkt.einheit);
                
                let packungenText = "";
                packungsInfo.packungen.forEach(pack => {
                    const packKonvertiert = konvertiereEinheit(pack.groesse, wasgauProdukte[produkt.name] ? wasgauProdukte[produkt.name].einheit : produkt.einheit);
                    packungenText += `${pack.anzahl} √ó ${packKonvertiert.wert} ${packKonvertiert.einheit}\n`;
                });
                
                tabellenDaten.push([
                    produkt.name,
                    `${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}`,
                    `${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}`,
                    `${konvertiertZuKaufen.wert} ${konvertiertZuKaufen.einheit}`,
                    packungenText.trim(),
                    `${packungsInfo.gesamtPreis.toFixed(2)}`
                ]);
                
                gesamtKosten += packungsInfo.gesamtPreis;
            } else {
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, produkt.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, produkt.einheit);
                
                tabellenDaten.push([
                    produkt.name,
                    `${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}`,
                    `${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}`,
                    "Aus Lager",
                    "-",
                    "0.00"
                ]);
            }
        });
        
        doc.autoTable({
            head: kopfZeilen,
            body: tabellenDaten,
            startY: 35,
            styles: {
                fontSize: 9,
                cellPadding: 3,
            },
            headStyles: {
                fillColor: [179, 0, 0],
                textColor: 255,
                fontStyle: 'bold'
            },
            alternateRowStyles: {
                fillColor: [245, 245, 245]
            },
            columnStyles: {
                0: { cellWidth: 45 },
                1: { cellWidth: 25 },
                2: { cellWidth: 25 },
                3: { cellWidth: 25 },
                4: { cellWidth: 40 },
                5: { cellWidth: 20 }
            }
        });
        
        const finalY = doc.lastAutoTable.finalY + 10;
        
        doc.setFillColor(232, 244, 232);
        doc.rect(14, finalY, 182, 25, 'F');
        
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text('Kosten√ºbersicht', 20, finalY + 8);
        
        doc.setFontSize(10);
        doc.text(`Gesamtkosten: ${gesamtKosten.toFixed(2)} ‚Ç¨`, 20, finalY + 15);
        doc.text(`Kosten pro Portion: ${(gesamtKosten / personen).toFixed(2)} ‚Ç¨`, 20, finalY + 21);
        
        doc.setFontSize(8);
        doc.setTextColor(100, 100, 100);
        doc.text('Erstellt mit Feldk√ºche - Intelligente Rezeptempfehlung', 14, 280);
        doc.text(`Wasgau C+C Einkaufsliste`, 14, 285);
        
        const fileName = `Einkaufsliste_${RezeptEmpfehlungsEngine.getRezeptAnzeigeName(rezeptName)}_${personen}Personen.pdf`;
        doc.save(fileName);
    }

    // =============================================
    // EQUIPMENT UI FUNKTIONEN
    // =============================================

    function switchSubTab(subTabName) {
        document.querySelectorAll('.sub-tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.sub-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.getElementById(subTabName + '-subtab').classList.add('active');
        document.querySelector(`.sub-tab[onclick="switchSubTab('${subTabName}')"]`).classList.add('active');
        
        if (subTabName === 'gw-beladung') {
            EquipmentManager.aktualisiereGWAnzeige();
        } else if (subTabName === 'kv-lager') {
            EquipmentManager.aktualisiereKVLagerAnzeige();
        }
    }

    function fuegeGWEquipmentHinzu() {
        const name = document.getElementById('gw-name').value.trim();
        const menge = document.getElementById('gw-menge').value;
        const kategorie = document.getElementById('gw-kategorie').value;
        const notizen = document.getElementById('gw-notizen').value.trim();

        if (!name || !menge) {
            alert('Bitte Bezeichnung und Menge eingeben!');
            return;
        }

        EquipmentManager.fuegeGWEquipmentHinzu({
            name,
            menge: parseInt(menge),
            kategorie,
            notizen
        });

        document.getElementById('gw-name').value = '';
        document.getElementById('gw-menge').value = '1';
        document.getElementById('gw-notizen').value = '';
    }

    function fuegeKVLagerHinzu() {
        const name = document.getElementById('kv-lager-name').value.trim();
        const menge = document.getElementById('kv-lager-menge').value;
        const kategorie = document.getElementById('kv-lager-kategorie').value;
        const notizen = document.getElementById('kv-lager-notizen').value.trim();

        if (!name || !menge) {
            alert('Bitte Bezeichnung und Menge eingeben!');
            return;
        }

        EquipmentManager.fuegeKVLagerHinzu({
            name,
            menge: parseInt(menge),
            kategorie,
            notizen
        });

        document.getElementById('kv-lager-name').value = '';
        document.getElementById('kv-lager-menge').value = '1';
        document.getElementById('kv-lager-notizen').value = '';
    }

    function berechneEinsatzMaterial() {
        EquipmentManager.berechneEinsatzMaterial();
    }

    function druckeEinsatzliste() {
        window.print();
    }

    function exportEinsatzPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(16);
        doc.setTextColor(179, 0, 0);
        doc.text('Einsatzmaterial-Liste', 14, 15);
        
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text(`Erstellt am: ${new Date().toLocaleDateString('de-DE')}`, 14, 22);
        
        doc.text('Einsatzmaterial-Liste wird generiert...', 14, 40);
        
        const fileName = `Einsatzmaterial_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);
    }

    // =============================================
    // UI-FUNKTIONEN
    // =============================================

    function zeigeRezeptEmpfehlungen() {
        const personen = parseInt(document.getElementById('empfohlen-personen').value);
        
        if (!personen || personen <= 0) {
            alert('Bitte eine g√ºltige Personenzahl eingeben!');
            return;
        }

        // Hier wird direkt das beste Rezept ausgew√§hlt, ohne Zwischenschritt
        const bestesRezept = "kartoffelsuppe"; // Beispielhaft Kartoffelsuppe als bestes Rezept
        
        // Setze das beste Rezept in der Auswahl
        document.getElementById('warm-rezept').value = bestesRezept;
        document.getElementById('personen').value = personen;
        
        // Update globale Variablen
        aktuellesRezept = bestesRezept;
        aktuelleKategorie = 'warm';
        
        // Zeige das Rezept direkt an
        zeigeRezept();
        
        // Kurze Best√§tigung anzeigen
        setTimeout(() => {
            alert(`Das beste Rezept f√ºr ${personen} Personen wurde automatisch ausgew√§hlt: ${RezeptEmpfehlungsEngine.getRezeptAnzeigeName(bestesRezept)}`);
        }, 100);
    }

    function waehleRezept(rezeptName) {
        document.getElementById('warm-rezept').value = rezeptName;
        document.getElementById('personen').value = document.getElementById('empfohlen-personen').value;
        aktuellesRezept = rezeptName;
        aktuelleKategorie = 'warm';
        zeigeRezept();
        alert(`Rezept "${RezeptEmpfehlungsEngine.getRezeptAnzeigeName(rezeptName)}" wurde ausgew√§hlt!`);
    }

    function zeigeRezept() {
        const rezeptName = getAktuellesRezept();
        const personen = parseFloat(document.getElementById("personen").value);

        if (!rezeptName) {
            alert("Bitte w√§hlen Sie ein Rezept aus!");
            return;
        }

        if (isNaN(personen) || personen <= 0) {
            alert("Bitte eine g√ºltige Personenzahl eingeben!");
            return;
        }

        const rezept = rezepte[rezeptName];
        if (!rezept) {
            document.getElementById("ausgabe").innerHTML = "<p style='color:red;'>Rezept nicht gefunden!</p>";
            return;
        }

        const faktor = personen / rezept.basisPortionen;

        let html = `<h2>${personen} Portionen ‚Äì ${rezept.name}</h2>`;
        html += `<p><strong>Kategorie:</strong> ${rezept.kategorie === 'kalt' ? 'ü•ó Kaltverpflegung' : rezept.kategorie === 'warm' ? 'üç≤ Warmverpflegung' : 'üéí Lunchpaket'} | <strong>Vegetarisch:</strong> ${rezept.vegetarisch ? '‚úÖ Ja' : '‚ùå Nein'}</p>`;
        html += `<p><strong>Basisrezept f√ºr ${rezept.basisPortionen} Portionen</strong></p>`;
        
        // Zwei-Spalten-Layout f√ºr Zutaten und Anleitung
        html += `<div class="rezept-container">`;
        
        // Linke Spalte: Zutaten
        html += `<div class="zutaten-tabelle">`;
        html += `<h3>Zutaten</h3>`;
        html += `<table><tr><th>Zutat</th><th>Menge</th><th>Einheit</th><th>Allergene</th></tr>`;

        rezept.zutaten.forEach(zutat => {
            const neueMenge = zutat.menge * faktor;
            const konvertiert = konvertiereEinheit(neueMenge, zutat.einheit);
            const zutatAllergene = produktAllergene[zutat.name] || [];
            const zutatAllergenBadges = AllergenManager.erstelleAllergenBadges(zutatAllergene);
            
            html += `<tr>
                <td>${zutat.name}</td>
                <td>${konvertiert.wert}</td>
                <td>${konvertiert.einheit}</td>
                <td>${zutatAllergenBadges}</td>
            </tr>`;
        });

        html += "</table>";
        html += `</div>`; // Ende Zutaten-Tabelle
        
        // Rechte Spalte: Handlungsanweisung
        html += `<div class="anleitung">`;
        html += `<h3>Zubereitung</h3>`;
        html += `<ol>`;
        
        rezept.anleitung.forEach(schritt => {
            html += `<li>${schritt}</li>`;
        });
        
        html += `</ol>`;
        html += `</div>`; // Ende Anleitung
        
        html += `</div>`; // Ende Rezept-Container
        
        // Info-Bl√∂cke unter Allergenen
        html += `<div class="info-grid">`;
        
        // Zubereitungszeit
        html += `<div class="info-card">`;
        html += `<h4>‚è±Ô∏è Zubereitungszeit</h4>`;
        html += `<div class="info-value">${rezept.zubereitungszeit} Min.</div>`;
        html += `<div class="info-label">Gesamte Vorbereitungs- und Kochzeit</div>`;
        html += `</div>`;
        
        // Kalorien pro Portion
        html += `<div class="info-card">`;
        html += `<h4>üî• Kalorien pro Portion</h4>`;
        html += `<div class="info-value">${rezept.kalorienProPortion} kcal</div>`;
        html += `<div class="info-label">Gesch√§tzte Energiemenge pro Person</div>`;
        html += `</div>`;
        
        html += `</div>`; // Ende Info-Grid
        
        // Portionsinfo
        html += `<div class="info-box">`;
        html += `<h4>üçΩÔ∏è Portionsinformation</h4>`;
        html += `<p><strong>${rezept.portionInfo}</strong></p>`;
        html += `<p>Die angegebenen Mengen sind f√ºr ${personen} Personen berechnet.</p>`;
        html += `</div>`;
        
        document.getElementById("ausgabe").innerHTML = html;

        AllergenManager.zeigeRezeptAllergene(rezeptName);
        erstelleEinkaufsliste(rezept, faktor, personen);
		aktualisiereEinkaufslisteTab();
    }
	function aktualisiereEinkaufslisteTab() {
		const rezeptName = getAktuellesRezept();
		const personenInput = document.getElementById("personen");
		const personen = personenInput ? parseFloat(personenInput.value) : 50; // Fallback auf 50
		
		console.log("Aktualisiere Einkaufsliste:", { rezeptName, personen }); // Debug log

		if (!rezeptName) {
			document.getElementById("einkaufsliste").innerHTML = `
				<div class="info-box">
					<p>‚ìò Bitte w√§hlen Sie zuerst ein Rezept im Rezept-Tab aus und klicken Sie auf "Rezept & Einkaufsliste anzeigen".</p>
				</div>
			`;
			return;
		}

		const rezept = rezepte[rezeptName];
		if (!rezept) {
			document.getElementById("einkaufsliste").innerHTML = `
				<div class="warning-box">
					<p>‚ùå Rezept nicht gefunden!</p>
				</div>
			`;
			return;
		}

		const faktor = personen / rezept.basisPortionen;
		const modus = Einkaufsmodus.getAktuellerModus();
		const modusText = modus === 'lager' ? ' (Lagerbestand ber√ºcksichtigt)' : ' (Alles neu kaufen)';
		
		let einkaufslisteHTML = `<h2>Einkaufsliste f√ºr ${personen} Portionen ‚Äì ${rezept.name}${modusText}</h2>`;
		einkaufslisteHTML += `<table><tr><th>Produkt</th><th>Ben√∂tigte Menge</th><th>Vorhanden</th><th>Zu kaufen</th><th>Packungen</th><th>Kosten (‚Ç¨)</th></tr>`;
		
		let gesamtKosten = 0;

		// Hauptrezept-Zutaten
		rezept.zutaten.forEach(zutat => {
			const benoetigteMenge = zutat.menge * faktor;
			const kaufInfo = Einkaufsmodus.berechneZuKaufendeMenge(benoetigteMenge, zutat.name);
			
			if (kaufInfo.zuKaufen > 0) {
				const packungsInfo = berechnePackungen(kaufInfo.zuKaufen, zutat.name);
				const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, zutat.einheit);
				const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, zutat.einheit);
				const konvertiertZuKaufen = konvertiereEinheit(kaufInfo.zuKaufen, zutat.einheit);
				
				let packungenText = "";
				
				packungsInfo.packungen.forEach(pack => {
					const packKonvertiert = konvertiereEinheit(pack.groesse, wasgauProdukte[zutat.name] ? wasgauProdukte[zutat.name].einheit : zutat.einheit);
					const packungsText = pack.anzahl === 1 ? "Packung" : "Packungen";
					packungenText += `${pack.anzahl} ${packungsText} √† ${packKonvertiert.wert} ${packKonvertiert.einheit}<br>`;
				});
				
				const rowClass = modus === 'lager' ? 'lager-verwendung' : 'komplett-kauf';
				
				einkaufslisteHTML += `<tr class="${rowClass}">
					<td>${zutat.name}</td>
					<td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
					<td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
					<td>${konvertiertZuKaufen.wert} ${konvertiertZuKaufen.einheit}</td>
					<td class="packaging-details">${packungenText}</td>
					<td>${packungsInfo.gesamtPreis.toFixed(2)}</td>
				</tr>`;
				
				gesamtKosten += packungsInfo.gesamtPreis;
			} else {
				const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, zutat.einheit);
				const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, zutat.einheit);
				
				einkaufslisteHTML += `<tr class="lager-verwendung">
					<td>${zutat.name}</td>
					<td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
					<td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
					<td><em>Aus Lager</em></td>
					<td>-</td>
					<td>0.00</td>
				</tr>`;
			}
		});

		// Getr√§nke und Snacks hinzuf√ºgen
		zusaetzlicheProdukte.forEach(produkt => {
			const benoetigteMenge = produkt.menge * personen;
			const kaufInfo = Einkaufsmodus.berechneZuKaufendeMenge(benoetigteMenge, produkt.name);
			
			if (kaufInfo.zuKaufen > 0) {
				const packungsInfo = berechnePackungen(kaufInfo.zuKaufen, produkt.name);
				const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, produkt.einheit);
				const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, produkt.einheit);
				const konvertiertZuKaufen = konvertiereEinheit(kaufInfo.zuKaufen, produkt.einheit);
				
				let packungenText = "";
				
				packungsInfo.packungen.forEach(pack => {
					const packKonvertiert = konvertiereEinheit(pack.groesse, wasgauProdukte[produkt.name] ? wasgauProdukte[produkt.name].einheit : produkt.einheit);
					const packungsText = pack.anzahl === 1 ? "Packung" : "Packungen";
					packungenText += `${pack.anzahl} ${packungsText} √† ${packKonvertiert.wert} ${packKonvertiert.einheit}<br>`;
				});
				
				const rowClass = modus === 'lager' ? 'lager-verwendung' : 'komplett-kauf';
				
				einkaufslisteHTML += `<tr class="${rowClass}">
					<td>${produkt.name}</td>
					<td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
					<td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
					<td>${konvertiertZuKaufen.wert} ${konvertiertZuKaufen.einheit}</td>
					<td class="packaging-details">${packungenText}</td>
					<td>${packungsInfo.gesamtPreis.toFixed(2)}</td>
				</tr>`;
				
				gesamtKosten += packungsInfo.gesamtPreis;
			} else {
				const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, produkt.einheit);
				const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, produkt.einheit);
				
				einkaufslisteHTML += `<tr class="lager-verwendung">
					<td>${produkt.name}</td>
					<td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
					<td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
					<td><em>Aus Lager</em></td>
					<td>-</td>
					<td>0.00</td>
				</tr>`;
			}
		});

		einkaufslisteHTML += `</table>`;
		
		einkaufslisteHTML += `<div class="success-box">
			<h3>Kosten√ºbersicht</h3>
			<p><strong>Gesamtkosten: ${gesamtKosten.toFixed(2)} ‚Ç¨</strong></p>
			<p>Kosten pro Portion: ${(gesamtKosten / personen).toFixed(2)} ‚Ç¨</p>
			<p class="packaging-info">
				${modus === 'lager' 
					? 'Lagerbestand wird ber√ºcksichtigt - nur fehlende Mengen werden gekauft' 
					: 'Alles wird neu gekauft - Lagerbestand wird ignoriert'
				}
			</p>
		</div>`;
		
		document.getElementById("einkaufsliste").innerHTML = einkaufslisteHTML;
	}
    function erstelleEinkaufsliste(rezept, faktor, personen) {
        const modus = Einkaufsmodus.getAktuellerModus();
        const modusText = modus === 'lager' ? ' (Lagerbestand ber√ºcksichtigt)' : ' (Alles neu kaufen)';
        
        let einkaufslisteHTML = `<h2>Einkaufsliste f√ºr ${personen} Portionen ‚Äì Wasgau C+C${modusText}</h2>`;
        einkaufslisteHTML += `<table><tr><th>Produkt</th><th>Ben√∂tigte Menge</th><th>Vorhanden</th><th>Zu kaufen</th><th>Packungen</th><th>Kosten (‚Ç¨)</th></tr>`;
        
        let gesamtKosten = 0;

        // Hauptrezept-Zutaten
        rezept.zutaten.forEach(zutat => {
            const benoetigteMenge = zutat.menge * faktor;
            const kaufInfo = Einkaufsmodus.berechneZuKaufendeMenge(benoetigteMenge, zutat.name);
            
            if (kaufInfo.zuKaufen > 0) {
                const packungsInfo = berechnePackungen(kaufInfo.zuKaufen, zutat.name);
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, zutat.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, zutat.einheit);
                const konvertiertZuKaufen = konvertiereEinheit(kaufInfo.zuKaufen, zutat.einheit);
                
                let packungenText = "";
                
                packungsInfo.packungen.forEach(pack => {
                    const packKonvertiert = konvertiereEinheit(pack.groesse, wasgauProdukte[zutat.name] ? wasgauProdukte[zutat.name].einheit : zutat.einheit);
                    const packungsText = pack.anzahl === 1 ? "Packung" : "Packungen";
                    packungenText += `${pack.anzahl} ${packungsText} √† ${packKonvertiert.wert} ${packKonvertiert.einheit}<br>`;
                });
                
                const rowClass = modus === 'lager' ? 'lager-verwendung' : 'komplett-kauf';
                
                einkaufslisteHTML += `<tr class="${rowClass}">
                    <td>${zutat.name}</td>
                    <td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
                    <td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
                    <td>${konvertiertZuKaufen.wert} ${konvertiertZuKaufen.einheit}</td>
                    <td class="packaging-details">${packungenText}</td>
                    <td>${packungsInfo.gesamtPreis.toFixed(2)}</td>
                </tr>`;
                
                gesamtKosten += packungsInfo.gesamtPreis;
            } else {
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, zutat.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, zutat.einheit);
                
                einkaufslisteHTML += `<tr class="lager-verwendung">
                    <td>${zutat.name}</td>
                    <td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
                    <td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
                    <td><em>Aus Lager</em></td>
                    <td>-</td>
                    <td>0.00</td>
                </tr>`;
            }
        });

        // Getr√§nke und Snacks hinzuf√ºgen
        zusaetzlicheProdukte.forEach(produkt => {
            const benoetigteMenge = produkt.menge * personen;
            const kaufInfo = Einkaufsmodus.berechneZuKaufendeMenge(benoetigteMenge, produkt.name);
            
            if (kaufInfo.zuKaufen > 0) {
                const packungsInfo = berechnePackungen(kaufInfo.zuKaufen, produkt.name);
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, produkt.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, produkt.einheit);
                const konvertiertZuKaufen = konvertiereEinheit(kaufInfo.zuKaufen, produkt.einheit);
                
                let packungenText = "";
                
                packungsInfo.packungen.forEach(pack => {
                    const packKonvertiert = konvertiereEinheit(pack.groesse, wasgauProdukte[produkt.name] ? wasgauProdukte[produkt.name].einheit : produkt.einheit);
                    const packungsText = pack.anzahl === 1 ? "Packung" : "Packungen";
                    packungenText += `${pack.anzahl} ${packungsText} √† ${packKonvertiert.wert} ${packKonvertiert.einheit}<br>`;
                });
                
                const rowClass = modus === 'lager' ? 'lager-verwendung' : 'komplett-kauf';
                
                einkaufslisteHTML += `<tr class="${rowClass}">
                    <td>${produkt.name}</td>
                    <td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
                    <td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
                    <td>${konvertiertZuKaufen.wert} ${konvertiertZuKaufen.einheit}</td>
                    <td class="packaging-details">${packungenText}</td>
                    <td>${packungsInfo.gesamtPreis.toFixed(2)}</td>
                </tr>`;
                
                gesamtKosten += packungsInfo.gesamtPreis;
            } else {
                const konvertiertBenoetigt = konvertiereEinheit(benoetigteMenge, produkt.einheit);
                const konvertiertVorhanden = konvertiereEinheit(kaufInfo.vorhanden, produkt.einheit);
                
                einkaufslisteHTML += `<tr class="lager-verwendung">
                    <td>${produkt.name}</td>
                    <td>${konvertiertBenoetigt.wert} ${konvertiertBenoetigt.einheit}</td>
                    <td>${konvertiertVorhanden.wert} ${konvertiertVorhanden.einheit}</td>
                    <td><em>Aus Lager</em></td>
                    <td>-</td>
                    <td>0.00</td>
                </tr>`;
            }
        });

        einkaufslisteHTML += `</table>`;
        
        einkaufslisteHTML += `<div class="success-box">
            <h3>Kosten√ºbersicht</h3>
            <p><strong>Gesamtkosten: ${gesamtKosten.toFixed(2)} ‚Ç¨</strong></p>
            <p>Kosten pro Portion: ${(gesamtKosten / personen).toFixed(2)} ‚Ç¨</p>
            <p class="packaging-info">
                ${modus === 'lager' 
                    ? 'Lagerbestand wird ber√ºcksichtigt - nur fehlende Mengen werden gekauft' 
                    : 'Alles wird neu gekauft - Lagerbestand wird ignoriert'
                }
            </p>
        </div>`;
        
        document.getElementById("einkaufsliste").innerHTML = einkaufslisteHTML;
    }

    function aktualisiereEinkaufsliste() {
        const rezeptName = getAktuellesRezept();
        const personen = parseFloat(document.getElementById("personen").value);
        const rezept = rezepte[rezeptName];
        
        if (rezept && personen > 0) {
            const faktor = personen / rezept.basisPortionen;
            erstelleEinkaufsliste(rezept, faktor, personen);
        }
    }

	function switchMainTab(tabName) {
    // Alle Tabs ausblenden
    document.querySelectorAll('.main-tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.main-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Gew√§hlten Tab anzeigen
    document.getElementById(tabName + '-tab').classList.add('active');
    document.querySelector(`.main-tab[onclick="switchMainTab('${tabName}')"]`).classList.add('active');
    
    if (tabName === 'lebensmittellager') {
        LagerManager.aktualisiereAnzeige();
    } else if (tabName === 'materiallager') {
        EquipmentManager.aktualisiereGWAnzeige();
    } else if (tabName === 'einkauf') {
        // Einkaufsliste automatisch aktualisieren wenn Tab gewechselt wird
        aktualisiereEinkaufslisteTab();
    }
}
    function fuegeLebensmittelHinzu() {
        const name = document.getElementById('lager-name').value.trim();
        const menge = document.getElementById('lager-menge').value;
        const einheit = document.getElementById('lager-einheit').value;
        const kategorie = document.getElementById('lager-kategorie').value;
        const haltbarkeit = document.getElementById('lager-haltbarkeit').value;
        const notizen = document.getElementById('lager-notizen').value.trim();

        if (!name || !menge) {
            alert('Bitte Name und Menge eingeben!');
            return;
        }

        LagerManager.fuegeHinzu({
            name,
            menge: parseFloat(menge),
            einheit,
            kategorie,
            haltbarkeit: haltbarkeit || null,
            notizen
        });

        document.getElementById('lager-name').value = '';
        document.getElementById('lager-menge').value = '';
        document.getElementById('lager-notizen').value = '';
    }

    function lagerLeeren() {
        if (confirm('M√∂chten Sie wirklich den gesamten Lagerbestand l√∂schen?')) {
            LagerManager.leeren();
        }
    }

    function zeigeAbgelaufene() {
        const abgelaufene = LagerManager.lagerbestand.filter(item => 
            LagerManager.pruefeHaltbarkeit(item.haltbarkeit) === 'abgelaufen'
        );
        
        if (abgelaufene.length === 0) {
            alert('Keine abgelaufenen Lebensmittel gefunden.');
        } else {
            alert(`Abgelaufene Lebensmittel: ${abgelaufene.map(item => item.name).join(', ')}`);
        }
    }

    // =============================================
    // INITIALISIERUNG BEIM START
    // =============================================

    async function initializeApp() {
        await CloudStorage.checkCloudStatus();
        
        try {
            const [cloudGW, cloudKVLager, cloudLager] = await Promise.allSettled([
                CloudStorage.loadFromCloud('equipment_gw'),
                CloudStorage.loadFromCloud('equipment_kv_lager'),
                CloudStorage.loadFromCloud('feldkueche_lager')
            ]);

            EquipmentManager.gwBeladung = cloudGW.status === 'fulfilled' && cloudGW.value 
                ? cloudGW.value 
                : JSON.parse(localStorage.getItem('equipment_gw') || '[]');
                
            EquipmentManager.kvLager = cloudKVLager.status === 'fulfilled' && cloudKVLager.value 
                ? cloudKVLager.value 
                : JSON.parse(localStorage.getItem('equipment_kv_lager') || '[]');
                
            LagerManager.lagerbestand = cloudLager.status === 'fulfilled' && cloudLager.value 
                ? cloudLager.value 
                : JSON.parse(localStorage.getItem('feldkueche_lager') || '[]');

        } catch (error) {
            console.log('Cloud-Daten konnten nicht geladen werden, verwende lokale Daten');
            EquipmentManager.gwBeladung = JSON.parse(localStorage.getItem('equipment_gw') || '[]');
            EquipmentManager.kvLager = JSON.parse(localStorage.getItem('equipment_kv_lager') || '[]');
            LagerManager.lagerbestand = JSON.parse(localStorage.getItem('feldkueche_lager') || '[]');
        }

        EquipmentManager.aktualisiereGWAnzeige();
        EquipmentManager.aktualisiereKVLagerAnzeige();
        LagerManager.aktualisiereAnzeige();
        
        // Dropdown-Men√ºs initialisieren
        filterRezepte('kalt');
        filterRezepte('warm');
        filterRezepte('lunch');
        
        // Standard-Rezept ausw√§hlen
        document.getElementById('warm-rezept').value = 'kartoffelsuppe';
        aktuellesRezept = 'kartoffelsuppe';
        aktuelleKategorie = 'warm';
        
        setTimeout(() => {
            CloudStorage.autoSync();
        }, 2000);
    }

    // Event-Listener
    document.addEventListener('DOMContentLoaded', function() {
        initializeApp();
        
        document.getElementById('personen').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') zeigeRezept();
        });
        
        document.getElementById('empfohlen-personen').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') zeigeRezeptEmpfehlungen();
        });
        
        // Erstes Rezept anzeigen
        setTimeout(() => zeigeRezept(), 100);
    });
    </script>
</body>
</html>
