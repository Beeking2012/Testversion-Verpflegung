<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feldküche - Militärische Verpflegung</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            background-color: #f5f5f5;
            color: #333;
        }

        /* Kopfleiste */
        .navbar {
            background: #2c3e50;
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .nav-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            background-color: #34495e;
        }

        /* Hauptinhalt */
        .content {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Filter-Sektion */
        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: bold;
            font-size: 0.9rem;
        }

        select, input[type="number"] {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .personen-input {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .personen-input label {
            font-weight: bold;
            margin-right: 1rem;
        }

        .personen-input input {
            width: 120px;
        }

        /* Rezepte Grid */
        .rezepte-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .rezept-karte {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }

        .rezept-karte:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .rezept-karte.ausgewaehlt {
            border-color: #3498db;
            background-color: #f8f9fa;
        }

        .rezept-karte h4 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .rezept-info {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .rezept-beschreibung {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 0.5rem;
        }

        /* Rezept Details */
        .rezept-details {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .rezept-header {
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .rezept-header h3 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .rezept-meta {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
            color: #7f8c8d;
            flex-wrap: wrap;
        }

        .rezept-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 3rem;
        }

        .zutaten-section h4,
        .zubereitung-section h4,
        .portionierung-section h4 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .zutaten-section h4 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }

        .zutaten-section ul {
            list-style: none;
            padding: 0;
        }

        .zutaten-section li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #ecf0f1;
            font-size: 1rem;
        }

        .zutaten-section li:last-child {
            border-bottom: none;
        }

        .zubereitung-section ol {
            padding-left: 1.5rem;
        }

        .zubereitung-section li {
            padding: 0.75rem 0;
            margin-bottom: 0.5rem;
            line-height: 1.6;
            border-bottom: 1px solid #f8f9fa;
        }

        .portionierung-section {
            grid-column: 1 / -1;
            background: #e8f4f8;
            padding: 1.5rem;
            border-radius: 6px;
            margin-top: 1rem;
            border-left: 4px solid #3498db;
        }

        .portionierung-section h4 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .portionierung-section p {
            line-height: 1.6;
            margin: 0;
        }

        .rezept-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #ecf0f1;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        button:hover {
            background: #2980b9;
        }

        /* Einkaufsliste */
        .einkaufsliste-info {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .einkaufsliste-info p {
            margin: 0;
            font-size: 1.1rem;
        }

        .einkaufsliste-info p strong {
            color: #2c3e50;
        }

        .einkaufsliste-container {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .einkaufsliste-container h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 0.5rem;
        }

        .einkaufsliste-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #ecf0f1;
            align-items: center;
        }

        .einkaufsliste-item:last-child {
            border-bottom: none;
        }

        .einkaufsliste-item span:first-child {
            font-weight: 500;
        }

        .einkaufsliste-item span:last-child {
            color: #3498db;
            font-weight: bold;
        }

        .keine-rezepte {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            color: #666;
        }

        /* Seiten werden standardmäßig ausgeblendet */
        .page {
            display: none;
        }

        /* Nur die aktive Seite wird angezeigt */
        .page.active {
            display: block;
        }

        /* DRUCK-STYLES KORRIGIERT */
        @media print {
            /* Alles ausblenden */
            body * {
                visibility: hidden;
            }
            
            /* Nur die Druck-Container anzeigen */
            #druck-rezept-container,
            #druck-einkaufsliste-container,
            #druck-rezept-container *,
            #druck-einkaufsliste-container * {
                visibility: visible !important;
                display: block !important;
            }
            
            /* Druck-Container positionieren */
            #druck-rezept-container,
            #druck-einkaufsliste-container {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Alles andere komplett ausblenden */
            .navbar,
            .rezept-actions,
            .einkaufsliste-info,
            .filter-section,
            .personen-input,
            .rezepte-grid,
            .rezept-details,
            #einkaufsliste-content,
            .container {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Optimierungen für Druck */
            body {
                background: white !important;
                font-size: 10pt !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            h1, h2, h3 {
                color: #000 !important;
                page-break-after: avoid;
            }
            
            table {
                page-break-inside: avoid;
            }
            
            ol, ul {
                page-break-inside: avoid;
            }
        }

        /* Verbesserte Druck-Container */
        .druck-container {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .rezept-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .rezepte-grid {
                grid-template-columns: 1fr;
            }
            
            .einkaufsliste-info {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            
            .rezept-actions {
                flex-direction: column;
            }
            
            .rezept-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Kopfleiste -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">Feldküche</h1>
            <div class="nav-links">
                <a href="#rezepte" class="nav-link active" data-page="rezepte">Rezepte</a>
                <a href="#einkaufsliste" class="nav-link" data-page="einkaufsliste">Einkaufsliste</a>
            </div>
        </div>
    </nav>

    <main class="content">
        <!-- Rezept-Seite -->
        <div id="rezepte" class="page active">
            <div class="container">
                <h2>Rezeptauswahl</h2>
                
                <!-- Filter-Optionen -->
                <div class="filter-section">
                    <div class="filter-group">
                        <label>Verpflegungsart:</label>
                        <select id="verpflegungsart">
                            <option value="">Alle</option>
                            <option value="warm">Warmverpflegung</option>
                            <option value="kalt">Kaltverpflegung</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Verpflegungstyp:</label>
                        <select id="verpflegungstyp">
                            <option value="">Alle</option>
                            <option value="voll">Vollverpflegung</option>
                            <option value="hand">Handverpflegung</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="vegetarisch">
                            Nur vegetarische Rezepte
                        </label>
                    </div>
                </div>

                <!-- Personenanzahl -->
                <div class="personen-input">
                    <label for="personen">Personenanzahl:</label>
                    <input type="number" id="personen" min="1" max="400" value="100">
                    <small>Basis: 100 Personen für Feldküche</small>
                </div>

                <!-- Rezepte Grid -->
                <div class="rezepte-grid" id="rezepte-grid">
                    <!-- Rezepte werden hier dynamisch eingefügt -->
                </div>

                <!-- Ausgewähltes Rezept -->
                <div id="rezept-details" class="rezept-details" style="display: none;">
                    <div class="rezept-header">
                        <h3 id="rezept-titel"></h3>
                        <div class="rezept-meta">
                            <span id="rezept-kalorien"></span>
                            <span id="rezept-zubereitungszeit"></span>
                            <span id="rezept-art"></span>
                        </div>
                    </div>
                    
                    <div class="rezept-content">
                        <div class="zutaten-section">
                            <h4>Zutaten für <span id="zutaten-personen">100</span> Personen</h4>
                            <ul id="rezept-zutaten"></ul>
                        </div>
                        
                        <div class="zubereitung-section">
                            <h4>Zubereitung</h4>
                            <ol id="rezept-zubereitung"></ol>
                        </div>
                        
                        <div class="portionierung-section">
                            <h4>Portionierung</h4>
                            <p id="rezept-portionierung"></p>
                        </div>
                    </div>
                    
                    <div class="rezept-actions">
                        <button onclick="exportRezeptPDF()">Rezept als PDF exportieren</button>
                        <button onclick="zurEinkaufsliste()">Zur Einkaufsliste</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Einkaufsliste-Seite -->
        <div id="einkaufsliste" class="page">
            <div class="container">
                <h2>Einkaufsliste</h2>
                
                <div class="einkaufsliste-info">
                    <p>Für <span id="einkauf-personen">100</span> Personen | 
                       <strong id="einkauf-rezept-titel">Kein Rezept ausgewählt</strong>
                    </p>
                    <div>
                        <button onclick="exportEinkaufslistePDF()">Einkaufsliste als PDF exportieren</button>
                        <button onclick="showPage('rezepte')">Zurück zu Rezepten</button>
                    </div>
                </div>
                
                <div id="einkaufsliste-content">
                    <p>Bitte wähle zuerst ein Rezept auf der Rezept-Seite aus.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Versteckte Druck-Container -->
    <div id="druck-rezept-container" class="druck-container" style="display: none;"></div>
    <div id="druck-einkaufsliste-container" class="druck-container" style="display: none;"></div>

    <script>
        // Rezepte Daten - OHNE TL/EL, nur g/ml/kg/l - MIT BASISZEITEN
        const rezepteDaten = [
            {
                id: 1,
                titel: "Feldküchen-Eintopf",
                beschreibung: "Herzhafter Eintopf mit Gemüse und Tofu",
                verpflegungsart: "warm",
                verpflegungstyp: "voll",
                vegetarisch: true,
                kalorien: 450,
                basisZeit: 45, // Zeit für 100 Personen
                zutaten: [
                    { menge: 12500, einheit: "g", name: "Tofu, gewürfelt" },
                    { menge: 100, einheit: "", name: "Kartoffeln, gewürfelt" },
                    { menge: 50, einheit: "", name: "Karotten, in Scheiben" },
                    { menge: 25, einheit: "", name: "Zwiebel, gewürfelt" },
                    { menge: 300, einheit: "g", name: "Tomatenmark" },
                    { menge: 37.5, einheit: "l", name: "Gemüsebrühe" },
                    { menge: 100, einheit: "g", name: "Paprikapulver" },
                    { menge: 25, einheit: "Bund", name: "Petersilie, gehackt" },
                    { menge: 450, einheit: "ml", name: "Öl" },
                    { menge: 150, einheit: "g", name: "Salz" },
                    { menge: 75, einheit: "g", name: "Pfeffer" }
                ],
                zubereitung: [
                    "Zwiebel in einem großen Topf mit Öl glasig anschwitzen",
                    "Tomatenmark zugeben und kurz mitrösten bis es duftet",
                    "Kartoffeln und Karotten hinzufügen, 5 Minuten unter Rühren mitdünsten",
                    "Mit Gemüsebrühe ablöschen und kräftig aufkochen lassen",
                    "Hitze reduzieren und bei mittlerer Hitze 20 Minuten köcheln lassen",
                    "Tofu in Würfeln schneiden und zusammen mit den Gewürzen zugeben",
                    "Weitere 10 Minuten köcheln lassen bis die Kartoffeln weich sind",
                    "Mit frisch gehackter Petersilie bestreuen und heiß servieren"
                ],
                portionierung: "In feste Feldküchen-Schüsseln portionieren. Pro Person ca. 1,5 Liter Eintopf berechnen. Mit frischem Brot oder Knäckebrot servieren. Für Feldverhältnisse in Thermosbehälter abfüllen."
            },
            {
                id: 2,
                titel: "Militärischer Nudelauflauf",
                beschreibung: "Nährhafter Auflauf mit Käse und Gemüse",
                verpflegungsart: "warm",
                verpflegungstyp: "voll",
                vegetarisch: true,
                kalorien: 520,
                basisZeit: 35, // Zeit für 100 Personen
                zutaten: [
                    { menge: 10000, einheit: "g", name: "Nudeln (Fusilli oder Penne)" },
                    { menge: 5000, einheit: "g", name: "Gouda, gerieben" },
                    { menge: 25, einheit: "", name: "Brokkoli, in kleinen Röschen" },
                    { menge: 25, einheit: "", name: "Paprika, gewürfelt" },
                    { menge: 50, einheit: "", name: "Eier" },
                    { menge: 5000, einheit: "ml", name: "Sahne" },
                    { menge: 2500, einheit: "ml", name: "Milch" },
                    { menge: 25, einheit: "g", name: "Muskatnuss, frisch gerieben" },
                    { menge: 2500, einheit: "g", name: "Parmesan, gerieben" },
                    { menge: 300, einheit: "g", name: "Butter" },
                    { menge: 150, einheit: "g", name: "Salz" },
                    { menge: 75, einheit: "g", name: "Pfeffer" }
                ],
                zubereitung: [
                    "Nudeln in reichlich Salzwasser bissfest kochen, abgießen und abtropfen lassen",
                    "Brokkoli waschen, in Röschen teilen und 3 Minuten blanchieren",
                    "Ofen auf 200°C Umluft vorheizen",
                    "Eier mit Sahne, Milch und Gewürzen verquirlen",
                    "Butter in einer Auflaufform schmelzen, Nudeln und Gemüse einfüllen",
                    "Geriebenen Gouda unterheben und gleichmäßig verteilen",
                    "Eiermischung darüber gießen, alles gut durchmischen",
                    "Mit Parmesan bestreuen und im vorgeheizten Ofen 25-30 Minuten backen bis die Oberfläche goldbraun ist"
                ],
                portionierung: "In Auflaufformen portionieren. Pro Person 1/8 der Form. Mit frischem Feldsalat oder eingelegtem Gemüse servieren. Für Außeneinsätze in Aluschalen abfüllen."
            },
            {
                id: 3,
                titel: "Feld-Sandwiches",
                beschreibung: "Praktische Handverpflegung mit Gemüse",
                verpflegungsart: "kalt",
                verpflegungstyp: "hand",
                vegetarisch: true,
                kalorien: 380,
                basisZeit: 15, // Zeit für 100 Personen
                zutaten: [
                    { menge: 200, einheit: "Scheiben", name: "Vollkornbrot" },
                    { menge: 5000, einheit: "g", name: "Frischkäse, natur" },
                    { menge: 25, einheit: "", name: "Gurke, in dünnen Scheiben" },
                    { menge: 25, einheit: "", name: "Tomate, in dünnen Scheiben" },
                    { menge: 100, einheit: "Blätter", name: "Eisbergsalat" },
                    { menge: 25, einheit: "", name: "Avocado, reif" },
                    { menge: 300, einheit: "ml", name: "Zitronensaft" },
                    { menge: 25, einheit: "", name: "Rote Zwiebel, in dünnen Ringen" },
                    { menge: 75, einheit: "g", name: "Salz" },
                    { menge: 40, einheit: "g", name: "Pfeffer" },
                    { menge: 50, einheit: "g", name: "getrockneter Dill" }
                ],
                zubereitung: [
                    "Brot scheibenweise mit Frischkäse bestreichen",
                    "Avocado halbieren, Stein entfernen, Fruchtfleisch herauslöffeln",
                    "Avocado mit Zitronensaft, Salz und Pfeffer zerdrücken",
                    "Auf 4 Brotscheiben Salatblätter legen",
                    "Gurken- und Tomatenscheiben gleichmäßig darauf anordnen",
                    "Rote Zwiebelringe darüber verteilen",
                    "Avocadocreme gleichmäßig auf den belegten Scheiben verteilen",
                    "Mit getrocknetem Dill bestreuen",
                    "Mit restlichen Brotscheiben bedecken und leicht andrücken",
                    "Sandwiches diagonal durchschneiden für bessere Handhabung"
                ],
                portionierung: "Jedes Sandwich einzeln in Frischhaltefolie oder Butterbrotpapier wickeln. Pro Person 1 Sandwich (2 Dreiecke). Für längere Touren kühl transportieren. Mit Apfel oder Müsliriegel ergänzen."
            },
            {
                id: 4,
                titel: "Energie-Müsli",
                beschreibung: "Kaltes Müsli mit Nüssen und Trockenfrüchten",
                verpflegungsart: "kalt",
                verpflegungstyp: "hand",
                vegetarisch: true,
                kalorien: 420,
                basisZeit: 10, // Zeit für 100 Personen
                zutaten: [
                    { menge: 10000, einheit: "g", name: "Haferflocken, zart" },
                    { menge: 2500, einheit: "g", name: "Nüsse, gemischt (Walnüsse, Haselnüsse)" },
                    { menge: 2500, einheit: "g", name: "Trockenfrüchte (Rosinen, Aprikosen)" },
                    { menge: 1250, einheit: "g", name: "Sonnenblumenkerne" },
                    { menge: 1250, einheit: "g", name: "Kürbiskerne" },
                    { menge: 600, einheit: "g", name: "Honig" },
                    { menge: 100, einheit: "g", name: "Zimt" },
                    { menge: 75, einheit: "g", name: "Salz" },
                    { menge: 25, einheit: "l", name: "Milch oder Pflanzenmilch" }
                ],
                zubereitung: [
                    "Haferflocken in eine große Schüssel geben",
                    "Nüsse grob hacken und zu den Haferflocken geben",
                    "Trockenfrüchte klein schneiden und untermischen",
                    "Sonnenblumenkerne und Kürbiskerne hinzufügen",
                    "Honig, Zimt und eine Prise Salz unterrühren",
                    "Alles gut vermengen bis eine gleichmäßige Mischung entsteht",
                    "In verschließbare Behälter oder Beutel abfüllen"
                ],
                portionierung: "In wiederverschließbare Beutel oder Dosen portionieren. Pro Person 150g Müsli mit 250ml Milch. Trocken portioniert für Feldverpflegung geeignet. Mit frischen Beeren oder Bananen ergänzbar."
            },
            {
                id: 5,
                titel: "Gulasch mit Fleisch",
                beschreibung: "Klassisches Gulasch nach Feldküchenart",
                verpflegungsart: "warm",
                verpflegungstyp: "voll",
                vegetarisch: false,
                kalorien: 580,
                basisZeit: 90, // Zeit für 100 Personen
                zutaten: [
                    { menge: 20000, einheit: "g", name: "Rindergulasch" },
                    { menge: 75, einheit: "", name: "Zwiebeln, gewürfelt" },
                    { menge: 50, einheit: "", name: "Paprika, in Streifen" },
                    { menge: 450, einheit: "g", name: "Tomatenmark" },
                    { menge: 50, einheit: "l", name: "Rinderbrühe" },
                    { menge: 300, einheit: "g", name: "Paprikapulver, edelsüß" },
                    { menge: 150, einheit: "g", name: "Majoran" },
                    { menge: 300, einheit: "ml", name: "Öl" },
                    { menge: 150, einheit: "g", name: "Mehl" },
                    { menge: 50, einheit: "", name: "Lorbeerblätter" },
                    { menge: 75, einheit: "g", name: "Kümmel" },
                    { menge: 150, einheit: "g", name: "Salz" },
                    { menge: 75, einheit: "g", name: "Pfeffer" }
                ],
                zubereitung: [
                    "Fleisch trocken tupfen und in einem großen Gusseisentopf portionsweise scharf anbraten",
                    "Fleisch herausnehmen, Zwiebeln im Bratfond glasig dünsten",
                    "Tomatenmark einrühren und kurz mitrösten bis es dunkler wird",
                    "Paprikapulver zugeben und kurz mitdünsten (nicht verbrennen lassen!)",
                    "Fleisch zurück in den Topf geben, mit Mehl bestäuben und kurz mitrösten",
                    "Mit Rinderbrühe ablöschen, kräftig aufkochen lassen",
                    "Majoran, Lorbeerblätter und Kümmel zugeben",
                    "Bei kleiner Hitze 60 Minuten köcheln lassen, gelegentlich umrühren",
                    "Paprika in Streifen schneiden und zugeben, weitere 20 Minuten garen",
                    "Mit Salz und Pfeffer abschmecken, Lorbeerblätter entfernen"
                ],
                portionierung: "Mit Salzkartoffeln oder frischem Brot servieren. Pro Person 300g Gulasch mit Beilage. In Feldküchen-Töpfen warm halten. Für mobile Einsätze in Thermosbehältern transportieren."
            }
        ];

        // Globale Variablen
        let aktuellesRezept = null;
        let personenAnzahl = 100; // BASIS: 100 Personen

        // NEUE FUNKTION: Berechnet skalierte Zubereitungszeit
        function berechneZubereitungszeit(basisZeit, personenAnzahl) {
            // Basis: Zeit für 100 Personen
            const basisFaktor = 1.0; // 100 Personen = 100%
            
            // Nicht-lineare Skalierung für realistischere Zeiten:
            if (personenAnzahl <= 100) {
                // Bis 100 Personen: annähernd linear
                return Math.round(basisZeit * (personenAnzahl / 100));
            } else if (personenAnzahl <= 200) {
                // 100-200 Personen: reduzierte Skalierung
                const zusatzFaktor = 0.7; // Jede weitere Person nur 70% mehr Zeit
                return Math.round(basisZeit * (1 + ((personenAnzahl - 100) / 100) * zusatzFaktor));
            } else {
                // Über 200 Personen: weitere Reduzierung
                const zusatzFaktor = 0.5; // Jede weitere Person nur 50% mehr Zeit
                return Math.round(basisZeit * (2 + ((personenAnzahl - 200) / 100) * zusatzFaktor));
            }
        }

        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM geladen - starte Initialisierung');
            
            // Event Listener für Filter
            document.getElementById('verpflegungsart').addEventListener('change', filterRezepte);
            document.getElementById('verpflegungstyp').addEventListener('change', filterRezepte);
            document.getElementById('vegetarisch').addEventListener('change', filterRezepte);
            
            // Personenanzahl Event-Listener
            document.getElementById('personen').addEventListener('input', function() {
                personenAnzahl = parseInt(this.value) || 1;
                console.log('Personenanzahl geändert:', personenAnzahl);
                
                // Personenanzahl in der Rezept-Anzeige aktualisieren
                document.getElementById('zutaten-personen').textContent = personenAnzahl;
                document.getElementById('einkauf-personen').textContent = personenAnzahl;
                
                // Rezept neu anzeigen mit neuer Personenanzahl
                if (aktuellesRezept) {
                    zeigeAusgewaehltesRezept(aktuellesRezept.id);
                }
                
                // Einkaufsliste aktualisieren
                aktualisiereEinkaufsliste();
            });

            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });

            // Startseite anzeigen
            showPage('rezepte');
            
            // Browser Navigation behandeln
            window.addEventListener('popstate', function() {
                const hash = window.location.hash.replace('#', '') || 'rezepte';
                showPage(hash);
            });

            const initialPage = window.location.hash.replace('#', '') || 'rezepte';
            showPage(initialPage);
            
            // Rezepte initial laden
            filterRezepte();
        });

        // Seitenwechsel
        function showPage(pageId) {
            console.log('Wechsle zu Seite:', pageId);
            
            // Navigation aktualisieren
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('active');
                }
            });

            // Alle Seiten ausblenden
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });
            
            // Nur die gewünschte Seite anzeigen
            const aktiveSeite = document.getElementById(pageId);
            if (aktiveSeite) {
                aktiveSeite.classList.add('active');
                aktiveSeite.style.display = 'block';
            }

            // URL aktualisieren
            window.history.pushState(null, null, `#${pageId}`);

            // Spezielle Aktionen pro Seite
            if (pageId === 'rezepte') {
                filterRezepte();
            } else if (pageId === 'einkaufsliste') {
                aktualisiereEinkaufsliste();
            }
        }

        // Rezepte filtern und anzeigen
        function filterRezepte() {
            console.log('Filtere Rezepte...');
            const verpflegungsart = document.getElementById('verpflegungsart').value;
            const verpflegungstyp = document.getElementById('verpflegungstyp').value;
            const nurVegetarisch = document.getElementById('vegetarisch').checked;

            const gefilterteRezepte = rezepteDaten.filter(rezept => {
                if (verpflegungsart && rezept.verpflegungsart !== verpflegungsart) return false;
                if (verpflegungstyp && rezept.verpflegungstyp !== verpflegungstyp) return false;
                if (nurVegetarisch && !rezept.vegetarisch) return false;
                return true;
            });

            // Rezepte Grid füllen
            const grid = document.getElementById('rezepte-grid');
            
            if (gefilterteRezepte.length === 0) {
                grid.innerHTML = '<div class="keine-rezepte">Keine Rezepte gefunden, die den Filterkriterien entsprechen.</div>';
                return;
            }

            grid.innerHTML = gefilterteRezepte.map(rezept => `
                <div class="rezept-karte" onclick="zeigeAusgewaehltesRezept(${rezept.id})">
                    <h4>${rezept.titel}</h4>
                    <div class="rezept-info">
                        <span>${rezept.kalorien} kcal/Person</span>
                        <span>${rezept.basisZeit} min (100 Pers.)</span>
                        <span>${rezept.vegetarisch ? 'Vegetarisch' : 'Mit Fleisch'}</span>
                    </div>
                    <p class="rezept-beschreibung">${rezept.beschreibung}</p>
                </div>
            `).join('');

            // Rezept Details ausblenden
            document.getElementById('rezept-details').style.display = 'none';
            aktuellesRezept = null;
        }

        // Ausgewähltes Rezept anzeigen
        function zeigeAusgewaehltesRezept(rezeptId) {
            const rezept = rezepteDaten.find(r => r.id === rezeptId);
            aktuellesRezept = rezept;

            if (!rezept) {
                console.error('Rezept nicht gefunden:', rezeptId);
                return;
            }

            // Skalierte Zeit berechnen
            const skalierteZeit = berechneZubereitungszeit(rezept.basisZeit, personenAnzahl);

            // Alle Rezept-Karten zurücksetzen
            document.querySelectorAll('.rezept-karte').forEach(karte => {
                karte.classList.remove('ausgewaehlt');
            });

            // Aktuelle Karte markieren
            document.querySelectorAll('.rezept-karte').forEach(karte => {
                if (karte.querySelector('h4').textContent === rezept.titel) {
                    karte.classList.add('ausgewaehlt');
                }
            });

            // Personenanzahl anzeigen
            document.getElementById('zutaten-personen').textContent = personenAnzahl;

            // Details anzeigen
            document.getElementById('rezept-titel').textContent = rezept.titel;
            document.getElementById('rezept-kalorien').textContent = `${rezept.kalorien} kcal pro Portion`;
            document.getElementById('rezept-zubereitungszeit').textContent = `${skalierteZeit} min Zubereitung`;
            document.getElementById('rezept-art').textContent = `${rezept.verpflegungsart === 'warm' ? 'Warm' : 'Kalt'} • ${rezept.verpflegungstyp === 'voll' ? 'Voll' : 'Hand'} • ${rezept.vegetarisch ? 'Vegetarisch' : 'Mit Fleisch'}`;

            // Zutaten anzeigen (skaliert mit Feldküchen-Umrechnung)
            const zutatenListe = document.getElementById('rezept-zutaten');
            zutatenListe.innerHTML = rezept.zutaten.map(zutat => {
                const skalierteMenge = (zutat.menge / 100) * personenAnzahl;
                const { menge, einheit } = konvertiereZuFeldkueche(skalierteMenge, zutat.einheit, zutat.name);
                
                return `<li>${menge} ${einheit} ${zutat.name}</li>`;
            }).join('');

            // Zubereitung anzeigen
            const zubereitungListe = document.getElementById('rezept-zubereitung');
            zubereitungListe.innerHTML = rezept.zubereitung.map(schritt => 
                `<li>${schritt}</li>`
            ).join('');

            // Portionierung anzeigen
            document.getElementById('rezept-portionierung').textContent = rezept.portionierung;

            // Details einblenden
            document.getElementById('rezept-details').style.display = 'block';
        }

        // Zur Einkaufsliste navigieren
        function zurEinkaufsliste() {
            if (aktuellesRezept) {
                showPage('einkaufsliste');
            } else {
                alert('Bitte wähle zuerst ein Rezept aus!');
            }
        }

        // Einkaufsliste aktualisieren - OHNE GRUPPIERUNG
        function aktualisiereEinkaufsliste() {
            console.log('Aktualisiere Einkaufsliste für', personenAnzahl, 'Personen');
            
            // Personenanzahl in Einkaufsliste anzeigen
            document.getElementById('einkauf-personen').textContent = personenAnzahl;
            
            if (!aktuellesRezept) {
                document.getElementById('einkauf-rezept-titel').textContent = 'Kein Rezept ausgewählt';
                document.getElementById('einkaufsliste-content').innerHTML = '<p>Bitte wähle zuerst ein Rezept auf der Rezept-Seite aus.</p>';
                return;
            }

            document.getElementById('einkauf-rezept-titel').textContent = aktuellesRezept.titel;
            
            const container = document.getElementById('einkaufsliste-content');
            
            // Zutaten für Einkaufsliste OHNE Gruppierung
            if (aktuellesRezept.zutaten.length === 0) {
                container.innerHTML = '<p>Keine Zutaten gefunden.</p>';
                return;
            }
            
            // Einfache Liste ohne Kategorien
            container.innerHTML = `
                <div class="einkaufsliste-container">
                    <h3>Alle Zutaten</h3>
                    ${aktuellesRezept.zutaten.map(zutat => {
                        const skalierteMenge = (zutat.menge / 100) * personenAnzahl;
                        const { menge, einheit } = konvertiereZuFeldkueche(skalierteMenge, zutat.einheit, zutat.name);
                        
                        return `
                            <div class="einkaufsliste-item">
                                <span>${zutat.name}</span>
                                <span>${menge} ${einheit}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Automatische Umrechnung für Feldküchen-Mengen - OHNE TL/EL
        function konvertiereZuFeldkueche(menge, einheit, zutatName) {
            const name = zutatName.toLowerCase();
            
            // Für große Mengen (ab 1000) in kg/l umrechnen
            if (einheit === "g" && menge >= 1000) {
                return { menge: (menge / 1000).toFixed(1), einheit: "kg" };
            }
            if (einheit === "ml" && menge >= 1000) {
                return { menge: (menge / 1000).toFixed(1), einheit: "l" };
            }
            
            // Für spezifische Zutaten automatisch passende Einheiten
            if (einheit === "" || einheit === "Stück") {
                if (name.includes('kartoffel') || name.includes('karotte') || name.includes('zwiebel') || 
                    name.includes('tomate') || name.includes('gurke') || name.includes('brokkoli') ||
                    name.includes('paprika') || name.includes('avocado')) {
                    if (menge >= 10) {
                        return { menge: Math.round(menge), einheit: "kg" };
                    }
                }
            }
            
            // Standard: Einheit beibehalten, aber runden
            let angezeigteMenge = menge;
            if (menge % 1 !== 0) {
                angezeigteMenge = menge.toFixed(1);
            }
            
            // Für leere Einheiten "Stück" anzeigen
            const finaleEinheit = einheit === "" ? "Stück" : einheit;
            
            return { menge: angezeigteMenge, einheit: finaleEinheit };
        }

        // VERBESSERT: PDF Export für Rezept mit Tabelle - KOMPAKTE VERSION
        function exportRezeptPDF() {
            if (!aktuellesRezept) {
                alert('Bitte wähle zuerst ein Rezept aus!');
                return;
            }
        
            console.log('Starte PDF Export für:', aktuellesRezept.titel);
            
            // Skalierte Zeit für PDF berechnen
            const skalierteZeit = berechneZubereitungszeit(aktuellesRezept.basisZeit, personenAnzahl);
            
            const druckContainer = document.getElementById('druck-rezept-container');
            
            // Zutaten als Tabellenzeilen erstellen
            const zutatenTabelle = aktuellesRezept.zutaten.map(zutat => {
                const skalierteMenge = (zutat.menge / 100) * personenAnzahl;
                const { menge, einheit } = konvertiereZuFeldkueche(skalierteMenge, zutat.einheit, zutat.name);
                return `
                    <tr>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #ddd; font-size: 10pt;">${zutat.name}</td>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #ddd; text-align: right; font-weight: bold; font-size: 10pt;">${menge} ${einheit}</td>
                    </tr>
                `;
            }).join('');
        
            // Zubereitung als nummerierte Liste
            const zubereitungListe = aktuellesRezept.zubereitung.map((schritt, index) => 
                `<li style="margin-bottom: 6px; line-height: 1.3; font-size: 10pt;">${schritt}</li>`
            ).join('');
        
            // KOMPAKTE Druck-Container füllen
            druckContainer.innerHTML = `
                <div class="druck-rezept" style="font-family: Arial, sans-serif; max-width: 700px; margin: 0 auto; padding: 15px; font-size: 10pt;">
                    <!-- Kopfbereich -->
                    <div style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;">
                        <h1 style="color: #2c3e50; font-size: 16pt; margin-bottom: 8px; text-align: center;">${aktuellesRezept.titel}</h1>
                        <div style="display: flex; justify-content: center; gap: 15px; font-size: 9pt; color: #666; flex-wrap: wrap;">
                            <span><strong>${aktuellesRezept.kalorien * personenAnzahl} kcal</strong> gesamt</span>
                            <span><strong>${skalierteZeit} min</strong> Zubereitung</span>
                            <span>${aktuellesRezept.verpflegungsart === 'warm' ? 'Warm' : 'Kalt'} • ${aktuellesRezept.verpflegungstyp === 'voll' ? 'Voll' : 'Hand'} • ${aktuellesRezept.vegetarisch ? 'Vegetarisch' : 'Mit Fleisch'}</span>
                        </div>
                    </div>
                    
                    <!-- Zutaten Tabelle -->
                    <div style="margin-bottom: 20px;">
                        <h2 style="color: #2c3e50; font-size: 12pt; border-bottom: 1px solid #3498db; padding-bottom: 5px; margin-bottom: 10px;">
                            Zutaten für ${personenAnzahl} Personen
                        </h2>
                        <table style="width: 100%; border-collapse: collapse; font-size: 9pt;">
                            <thead>
                                <tr>
                                    <th style="padding: 6px 8px; border-bottom: 1px solid #3498db; text-align: left; background: #f8f9fa;">Zutat</th>
                                    <th style="padding: 6px 8px; border-bottom: 1px solid #3498db; text-align: right; background: #f8f9fa;">Menge</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${zutatenTabelle}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Zubereitung als nummerierte Liste -->
                    <div style="margin-bottom: 20px;">
                        <h2 style="color: #2c3e50; font-size: 12pt; border-bottom: 1px solid #3498db; padding-bottom: 5px; margin-bottom: 10px;">
                            Zubereitung
                        </h2>
                        <ol style="padding-left: 15px; font-size: 10pt; line-height: 1.3;">
                            ${zubereitungListe}
                        </ol>
                    </div>
                    
                    <!-- Portionierung -->
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 3px; margin-top: 15px; border-left: 3px solid #3498db;">
                        <h3 style="color: #2c3e50; font-size: 11pt; margin-bottom: 5px;">Portionierung</h3>
                        <p style="line-height: 1.3; margin: 0; font-size: 9pt;">${aktuellesRezept.portionierung}</p>
                    </div>
        
                    <!-- Footer -->
                    <div style="margin-top: 20px; padding-top: 10px; border-top: 1px solid #ddd; font-size: 8pt; color: #666; text-align: center;">
                        <p>Erstellt am: ${new Date().toLocaleString('de-DE')} | Quelle: Feldküche - Militärische Verpflegung</p>
                    </div>
                </div>
            `;
        
            // Container für Druck sichtbar machen
            druckContainer.style.display = 'block';
            
            console.log('Druck-Container gefüllt, starte Druck...');
            
            // Kurz warten dann drucken
            setTimeout(() => {
                window.print();
                
                // Nach Druck wieder ausblenden
                setTimeout(() => {
                    druckContainer.style.display = 'none';
                    druckContainer.innerHTML = '';
                    console.log('Druck abgeschlossen, Container geleert');
                }, 500);
            }, 100);
        }
        
        // PDF Export für Einkaufsliste - OHNE GRUPPIERUNG
        function exportEinkaufslistePDF() {
            if (!aktuellesRezept) {
                alert('Bitte wähle zuerst ein Rezept aus!');
                return;
            }
        
            const druckContainer = document.getElementById('druck-einkaufsliste-container');
            
            druckContainer.innerHTML = `
                <div style="font-family: Arial, sans-serif; max-width: 700px; margin: 0 auto; padding: 15px; font-size: 10pt;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h2 style="font-size: 16pt; margin-bottom: 5px;">Einkaufsliste</h2>
                        <p style="font-size: 10pt;"><strong>${aktuellesRezept.titel}</strong> für ${personenAnzahl} Personen</p>
                    </div>
                    
                    <div style="background: white; padding: 15px; margin-bottom: 12px; border-radius: 3px; border: 1px solid #eee;">
                        <h3 style="color: #2c3e50; font-size: 12pt; margin-bottom: 10px; border-bottom: 1px solid #ecf0f1; padding-bottom: 3px;">Alle Zutaten</h3>
                        ${aktuellesRezept.zutaten.map(zutat => {
                            const skalierteMenge = (zutat.menge / 100) * personenAnzahl;
                            const { menge, einheit } = konvertiereZuFeldkueche(skalierteMenge, zutat.einheit, zutat.name);
                            
                            return `
                                <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #f5f5f5; font-size: 10pt;">
                                    <span>${zutat.name}</span>
                                    <span style="color: #3498db; font-weight: bold;">${menge} ${einheit}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div style="margin-top: 20px; padding-top: 10px; border-top: 1px solid #ddd; font-size: 8pt; color: #666; text-align: center;">
                        <p>Erstellt am: ${new Date().toLocaleString('de-DE')} | Quelle: Feldküche - Militärische Verpflegung</p>
                    </div>
                </div>
            `;
        
            // Container für Druck sichtbar machen
            druckContainer.style.display = 'block';
            
            // Kurz warten dann drucken
            setTimeout(() => {
                window.print();
                
                // Nach Druck wieder ausblenden
                setTimeout(() => {
                    druckContainer.style.display = 'none';
                    druckContainer.innerHTML = '';
                }, 500);
            }, 100);
        }
    </script>
</body>
</html>
